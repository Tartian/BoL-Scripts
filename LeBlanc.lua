if myHero.charName:lower() ~= "leblanc" then return end
	_G.LeBlanc_Loaded = true
	_G.LeBlanc_ScriptVersion = 2.14
	_G.LeBlanc_Author = "Totally Legit"
	_G.LeBlanc_PerformAutoUpdate = true
	_G.LeBlanc_USEPACKETS = true

--[[



		Changelog
			* 1.99
				Improved Smart W
				Added Ignite Checks
				Added Overkill checks
				Fixed the combos
				Better TargetSelecting
				Better combo
				Better GapClosing

			* 2.00
				Script is now paid

			* 2.01
				Switched host
				Forced return W in harass

			* 2.02
				Multiple overkill checks
				Better way of detecting R
				Better gapclosing
				Faster combos
				Better targetselecting
				Message that tells whether you will die or not from ignite
				Auto Level
				Fixed the other killsteal options
				Better KillSteal in general
					Now takes Q buff in according

			* 2.03
				Bug fixes
				Small fix to W casting too fast
				Few more return checks for W

			* 2.04
				Small fixes

			* 2.10
				Improved Smart Combo
				Made more checks with W
					Added turret damage checking
					Added minion checks
				Fixed more stuff & added more checks to avoid possible script-caused crashes
				Added other combos
					GapClose combo
					Chain Combo
						Chains will maximize the slow/stun output
						Prioritizes E -> R over anything
						It'll do R -> Q if E isn't close to being up
				Improved Overkill checks

			* 2.11
				Minor fixes
				Added SPred

			* 2.12
				Updated to 5.15

			* 2.13
				Updated DP API
				Updated W values
				Fix'd minor bugs

			* 2.14
				Fixed compability with Dancing Shoes

--]]


assert(load(Base64Decode("ZnVuY3Rpb24gU2F5KGRkYSkNCiAgcHJpbnQoIjxmb250IGNvbG9yPVwiI0ZGMDAwMFwiPjxiPlRvdGFsbHkgTGVCbGFuYzo8L2I+PC9mb250PiA8Zm9udCBjb2xvcj1cIiNGRkZGRkZcIj4iIC4uIGRkYSAuLiAiPC9mb250PiIpDQplbmQNCmlmIG5vdCBWSVBfVVNFUiB0aGVuDQogIHJldHVybiBTYXkoIllvdSBuZWVkIHRvIGJlIFZJUCB0byB1c2UgdGhpcyBzY3JpcHQuIikNCmVuZA0KDQppZiBub3QgRmlsZUV4aXN0KExJQl9QQVRIIC4uICJWUHJlZGljdGlvbi5sdWEiKSBhbmQgKG5vdCBGaWxlRXhpc3QoTElCX1BBVEggLi4gIkRpdmluZVByZWQubHVhIikgb3Igbm90IEZpbGVFeGlzdChMSUJfUEFUSCAuLiAiRGl2aW5lUHJlZC5sdWFjIikpIGFuZCBub3QgRmlsZUV4aXN0KExJQl9QQVRIIC4uICJIUHJlZGljdGlvbi5sdWEiKSB0aGVuDQogIFNheSgiWW91IG5lZWQgYXQgbGVhc3Qgb25lIHByZWRpY3Rpb24gdG8gcnVuIHRoaXMgc2NyaXB0LiBIUHJlZGljdGlvbiB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgZG93bmxvYWRlZC4gUGxlYXNlIHdhaXQuLi4iKQ0KICBEb3dubG9hZEZpbGUoImh0dHBzOi8vcmF3LmdpdGh1Yi5jb20vQm9sSFRURi9Cb0wvbWFzdGVyL0hUVEYvQ29tbW9uL0hQcmVkaWN0aW9uLmx1YSIgLi4gIj9yYW5kPSIgLi4gbWF0aC5yYW5kb20oMSwgMTAwMDApLCBMSUJfUEFUSCAuLiAiSFByZWRpY3Rpb24ubHVhIiwgZnVuY3Rpb24oKQ0KICAgIFNheSgiU3VjY2VzZnVsbHkgaW5zdGFsbGVkIEhQcmVkaWN0aW9uLiBQbGVhc2UgcmVsb2FkIGJ5IHByZXNzaW5nIEY5IHR3aWNlLiIpDQogIGVuZCkNCiAgcmV0dXJuDQplbmQNCg0KU2F5KCJXZWxjb21lICIgLi4gR2V0VXNlcigpIC4uICI6IFBhaWQgdXNlciIpDQoNClNheSgiQ3JhY2tlZCBieSBrb2t1YW55dTIwMDIiKQ0KDQpfRy5MZWJsYW5jX2luaXRpYWxpemVkID0gdHJ1ZQ0KaWYgbm90IF9HLkxlQmxhbmNfVVNFUEFDS0VUUyB0aGVuDQogIGZ1bmN0aW9uIF9HLkxldmVsU3BlbGwoKQ0KICBlbmQNCmVuZA0KZnVuY3Rpb24gQXV0b1VwZGF0ZSgpDQogIGxvY2FsIGRkYSA9IHt9DQogIGRkYS5WZXJzaW9uID0gX0cuTGVCbGFuY19TY3JpcHRWZXJzaW9uDQogIGRkYS5Vc2VIdHRwcyA9IHRydWUNCiAgZGRhLkhvc3QgPSAicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSINCiAgZGRhLlZlcnNpb25QYXRoID0gIi9UYXJ0aWFuL0JvTC1TY3JpcHRzL21hc3Rlci9MZUJsYW5jLnZlcnNpb24iDQogIGRkYS5TY3JpcHRQYXRoID0gIi9UYXJ0aWFuL0JvTC1TY3JpcHRzL21hc3Rlci9MZUJsYW5jLmx1YSINCiAgZGRhLlNhdmVQYXRoID0gU0NSSVBUX1BBVEggLi4gR2V0Q3VycmVudEVudigpLkZJTEVfTkFNRQ0KICBmdW5jdGlvbiBkZGEuQ2FsbGJhY2tVcGRhdGUoX19iLCBhX2IpDQogICAgU2F5KCJTdWNjZXNmdWxseSB1cGRhdGVkICggIiAuLiBhX2IgLi4gIiA9PiAiIC4uIF9fYiAuLiAiKS4iKQ0KICBlbmQNCiAgZnVuY3Rpb24gZGRhLkNhbGxiYWNrTm9VcGRhdGUoX19iKQ0KICAgIFNheSgiTm8gVXBkYXRlcyBGb3VuZCIpDQogIGVuZA0KICBmdW5jdGlvbiBkZGEuQ2FsbGJhY2tOZXdWZXJzaW9uKF9fYikNCiAgICBTYXkoIk5ldyBWZXJzaW9uIGZvdW5kICgiIC4uIF9fYiAuLiAiKS4gUGxlYXNlIHdhaXQgdW50aWwgaXRzIGRvd25sb2FkZWQuIikNCiAgZW5kDQogIGZ1bmN0aW9uIGRkYS5DYWxsYmFja0Vycm9yKF9fYikNCiAgICBTYXkoIkVycm9yIHdoaWxlIERvd25sb2FkaW5nLiBQbGVhc2UgdHJ5IGFnYWluLiIpDQogIGVuZA0KICBTeFNjcmlwdFVwZGF0ZShkZGEuVmVyc2lvbiwgZGRhLlVzZUh0dHBzLCBkZGEuSG9zdCwgZGRhLlZlcnNpb25QYXRoLCBkZGEuU2NyaXB0UGF0aCwgZGRhLlNhdmVQYXRoLCBkZGEuQ2FsbGJhY2tVcGRhdGUsIGRkYS5DYWxsYmFja05vVXBkYXRlLCBkZGEuQ2FsbGJhY2tOZXdWZXJzaW9uLCBkZGEuQ2FsbGJhY2tFcnJvcikNCmVuZA0KbG9jYWwgZGJhLCBfY2EsIGFjYSwgYmNhLCBjY2EsIGRjYQ0Kc1ByZWRMb2FkZWQgPSBmYWxzZQ0KbG9jYWwgX2RhDQpsb2NhbCBhZGEsIGJkYSwgY2RhID0gZmFsc2UsIG5pbCwgbmlsDQppZiBGaWxlRXhpc3QoTElCX1BBVEggLi4gIlZQcmVkaWN0aW9uLmx1YSIpIHRoZW4NCiAgYWRhID0gdHJ1ZQ0KICByZXF1aXJlKCJWUHJlZGljdGlvbiIpDQplbmQNCmlmIFZJUF9VU0VSIGFuZCBGaWxlRXhpc3QoTElCX1BBVEggLi4gIkRpdmluZVByZWQubHVhIikgYW5kIEZpbGVFeGlzdChMSUJfUEFUSCAuLiAiRGl2aW5lUHJlZC5sdWFjIikgdGhlbg0KICBiY2EgPSB0cnVlDQogIHJlcXVpcmUoIkRpdmluZVByZWQiKQ0KZW5kDQppZiBGaWxlRXhpc3QoTElCX1BBVEggLi4gIkhQcmVkaWN0aW9uLmx1YSIpIHRoZW4NCiAgY2NhID0gdHJ1ZQ0KICByZXF1aXJlKCJIUHJlZGljdGlvbiIpDQplbmQNCmlmIEZpbGVFeGlzdChMSUJfUEFUSCAuLiAiU1ByZWRpY3Rpb24ubHVhIikgdGhlbg0KICBzUHJlZExvYWRlZCA9IHRydWUNCiAgcmVxdWlyZSgiU1ByZWRpY3Rpb24iKQ0KZW5kDQpmdW5jdGlvbiBEZWNsYXJlVmFyaWFibGVzKCkNCiAgUXJlYWR5LCBXcmVhZHksIEVyZWFkeSwgUnJlYWR5ID0gZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UNCiAgU3BlbGxzID0gew0KICAgIFAgPSB7DQogICAgICBuYW1lID0gIkxlQmxhbmNfQmFzZV9QX3Bvb2YudHJveSINCiAgICB9LA0KICAgIEFBID0gew0KICAgICAgcmFuZ2UgPSA1MjUsDQogICAgICBuYW1lID0gIkJhc2ljQXR0YWNrIg0KICAgIH0sDQogICAgUSA9IHsNCiAgICAgIG5hbWUgPSAiU2lnaWwgb2YgTWFsaWNlIiwNCiAgICAgIHNwZWxsbmFtZSA9ICJMZWJsYW5jQ2hhb3NPcmIiLA0KICAgICAgcmFuZ2UgPSA3MDAsDQogICAgICBzcGVlZCA9IDIwMDAsDQogICAgICBtYXJrVGltZXIgPSAzLjUsDQogICAgICBkZWxheSA9IDAsDQogICAgICBhY3RpdmF0ZWQgPSAwLA0KICAgICAgYnVmZlEgPSAiTGVibGFuY0NoYW9zT3JiIiwNCiAgICAgIGJ1ZmZSID0gIkxlYmxhbmNDaGFvc09yYk0iDQogICAgfSwNCiAgICBXID0gew0KICAgICAgbmFtZSA9ICJEaXN0b3J0aW9uIiwNCiAgICAgIHNwZWxsbmFtZSA9ICJMZWJsYW5jU2xpZGUiLA0KICAgICAgcmFuZ2UgPSA2NTAsDQogICAgICByYWRpdXMgPSAyNTAsDQogICAgICBzcGVlZCA9IDE0NTAsDQogICAgICBkZWxheSA9IDAuMjUsDQogICAgICBkdXJhdGlvbiA9IDQsDQogICAgICB0aW1lQWN0aXZhdGVkID0gMCwNCiAgICAgIGlzQWN0aXZhdGVkID0gZmFsc2UsDQogICAgICBzdGFydFBvcyA9IG15SGVyby5wb3MsDQogICAgICByYW5nZVNxciA9IDcyMjUwMA0KICAgIH0sDQogICAgRSA9IHsNCiAgICAgIG5hbWUgPSAiRXRoZXJlYWwgQ2hhaW5zIiwNCiAgICAgIHNwZWxsbmFtZSA9ICJMZWJsYW5jU291bFNoYWNrbGUiLA0KICAgICAgcmFuZ2UgPSA5NTAsDQogICAgICBzcGVlZCA9IDE2MDAsDQogICAgICBkZWxheSA9IDAuMjUsDQogICAgICByYWRpdXMgPSA1NSwNCiAgICAgIHByb2NUaW1lID0gMS41DQogICAgfSwNCiAgICBSID0gew0KICAgICAgbmFtZSA9ICJNaW1pYyIsDQogICAgICBzcGVsbG5hbWUgPSAiTGVibGFuY01pbWljIiwNCiAgICAgIFFuYW1lID0gIkxlYmxhbmNDaGFvc09yYk0iLA0KICAgICAgV25hbWUgPSAiTGVibGFuY1NsaWRlTSIsDQogICAgICBXcmV0dXJubmFtZSA9ICJsZWJsYW5jc2xpZGVyZXR1cm5tIiwNCiAgICAgIEVuYW1lID0gIkxlYmxhbmNTb3VsU2hhY2tsZU0iDQogICAgfSwNCiAgICBXUiA9IHsNCiAgICAgIGR1cmF0aW9uID0gNCwNCiAgICAgIHNwZWxsbmFtZSA9ICJMZWJsYW5jU2xpZGVNIiwNCiAgICAgIHRpbWVBY3RpdmF0ZWQgPSAwLA0KICAgICAgaXNBY3RpdmF0ZWQgPSBmYWxzZSwNCiAgICAgIHN0YXJ0UG9zID0gbXlIZXJvLnBvcw0KICAgIH0NCiAgfQ0KICBjdXJyZW50V2lkdGggPSBTcGVsbHMuRS5yYWRpdXMNCiAgY3VycmVudFJhbmdlID0gU3BlbGxzLkUucmFuZ2UNCiAgaUNhc3RlZEVUaW1lID0gb3MuY2xvY2soKQ0KICByU3BlbGxOYW1lID0gew0KICAgIExlYmxhbmNDaGFvc09yYk0gPSB0cnVlLA0KICAgIExlYmxhbmNTbGlkZU0gPSB0cnVlLA0KICAgIExlYmxhbmNTb3VsU2hhY2tsZU0gPSB0cnVlDQogIH0NCiAgSXRlbXMgPSB7DQogICAgQlJLID0gew0KICAgICAgaWQgPSAzMTUzLA0KICAgICAgcmFuZ2UgPSA0NTAsDQogICAgICByZXFUYXJnZXQgPSB0cnVlLA0KICAgICAgc2xvdCA9IG5pbA0KICAgIH0sDQogICAgQldDID0gew0KICAgICAgaWQgPSAzMTQ0LA0KICAgICAgcmFuZ2UgPSA0MDAsDQogICAgICByZXFUYXJnZXQgPSB0cnVlLA0KICAgICAgc2xvdCA9IG5pbA0KICAgIH0sDQogICAgSEdCID0gew0KICAgICAgaWQgPSAzMTQ2LA0KICAgICAgcmFuZ2UgPSA0MDAsDQogICAgICByZXFUYXJnZXQgPSB0cnVlLA0KICAgICAgc2xvdCA9IG5pbA0KICAgIH0sDQogICAgUlNIID0gew0KICAgICAgaWQgPSAzMDc0LA0KICAgICAgcmFuZ2UgPSAzNTAsDQogICAgICByZXFUYXJnZXQgPSBmYWxzZSwNCiAgICAgIHNsb3QgPSBuaWwNCiAgICB9LA0KICAgIFNURCA9IHsNCiAgICAgIGlkID0gMzEzMSwNCiAgICAgIHJhbmdlID0gMzUwLA0KICAgICAgcmVxVGFyZ2V0ID0gZmFsc2UsDQogICAgICBzbG90ID0gbmlsDQogICAgfSwNCiAgICBUTVQgPSB7DQogICAgICBpZCA9IDMwNzcsDQogICAgICByYW5nZSA9IDM1MCwNCiAgICAgIHJlcVRhcmdldCA9IGZhbHNlLA0KICAgICAgc2xvdCA9IG5pbA0KICAgIH0sDQogICAgWUdCID0gew0KICAgICAgaWQgPSAzMTQyLA0KICAgICAgcmFuZ2UgPSAzNTAsDQogICAgICByZXFUYXJnZXQgPSBmYWxzZSwNCiAgICAgIHNsb3QgPSBuaWwNCiAgICB9LA0KICAgIEJGVCA9IHsNCiAgICAgIGlkID0gMzE4OCwNCiAgICAgIHJhbmdlID0gNzUwLA0KICAgICAgcmVxVGFyZ2V0ID0gdHJ1ZSwNCiAgICAgIHNsb3QgPSBuaWwNCiAgICB9LA0KICAgIFJORCA9IHsNCiAgICAgIGlkID0gMzE0MywNCiAgICAgIHJhbmdlID0gMjc1LA0KICAgICAgcmVxVGFyZ2V0ID0gZmFsc2UsDQogICAgICBzbG90ID0gbmlsDQogICAgfQ0KICB9DQogIEFBZGlzYWJsZWQgPSBmYWxzZQ0KICBsYXN0QWN0aXZhdGVkID0gbmlsDQogIGNhc3RlZFRocm91Z2hIYXJhc3MgPSBmYWxzZQ0KICBLaWxsVGV4dCA9IHt9DQogIE9yYldhbGtlciA9IE9yYldhbGtlcigpDQogIGJkYSwgRFAgPSBuaWwsIG5pbA0KICBQcm9kVywgUHJvZEUgPSBuaWwsIG5pbA0KICBlU1MsIHdTUyA9IG5pbCwgbmlsDQogIGlnbml0ZSwgaGVhbCwgYmFycmllciwgSXJlYWR5LCBIcmVhZHksIEJyZWFkeSA9IGZhbHNlLCBuaWwsIG5pbCwgbmlsLCBuaWwsIG5pbA0KICBpZ25pdGVUaWNrID0ge30NCiAgZW5lbWllc0J1ZmZzID0ge30NCiAgaXNLaWxsZWQgPSB7fQ0KICBpc1N0dW5uZWQgPSB7fQ0KICBmb3IgZGRhLCBfX2IgaW4gcGFpcnMoR2V0RW5lbXlIZXJvZXMoKSkgZG8NCiAgICBpZiBfX2IgdGhlbg0KICAgICAgaWduaXRlVGlja1tfX2IubmV0d29ya0lEXSA9IHsNCiAgICAgICAgc3RhcnRUID0gb3MuY2xvY2soKSwNCiAgICAgICAgaGVhbHRoID0gX19iLmhlYWx0aCwNCiAgICAgICAgaXNJZ25pdGVkID0gZmFsc2UNCiAgICAgIH0NCiAgICAgIGVuZW1pZXNCdWZmc1tfX2IubmV0d29ya0lEXSA9IHsNCiAgICAgICAgcmVjZWl2ZWQgPSBmYWxzZSwNCiAgICAgICAgZW5kVGltZSA9IG9zLmNsb2NrKCkNCiAgICAgIH0NCiAgICAgIGlzS2lsbGVkW19fYi5uZXR3b3JrSURdID0gZmFsc2UNCiAgICAgIGlzU3R1bm5lZFtfX2IubmV0d29ya0lEXSA9IGZhbHNlDQogICAgZW5kDQogIGVuZA0KICBidWZmVHlwZXMgPSB7DQogICAgNSwNCiAgICAyNCwNCiAgICAyOQ0KICB9DQogIGxhc3RRQ2FzdCA9IHsNCiAgICB0YXJnZXQgPSBuaWwsDQogICAgZW5kVCA9IG9zLmNsb2NrKCkNCiAgfQ0KICBpZ25pdGVkVGFibGUgPSB7DQogICAgaWduaXRlZCA9IHRydWUsDQogICAgc291cmNlID0gbmlsLA0KICAgIHRpbWUgPSBvcy5jbG9jaygpLA0KICAgIGhhc1NhaWQgPSBmYWxzZSwNCiAgICB3aWxsS2lsbE1lID0gZmFsc2UNCiAgfQ0KICBhdXRvTGV2ZWxUYWJsZXMgPSB7DQogICAgew0KICAgICAgX1EsDQogICAgICBfVywNCiAgICAgIF9FLA0KICAgICAgX1EsDQogICAgICBfUSwNCiAgICAgIF9SLA0KICAgICAgX1EsDQogICAgICBfVywNCiAgICAgIF9RLA0KICAgICAgX1csDQogICAgICBfUiwNCiAgICAgIF9XLA0KICAgICAgX1csDQogICAgICBfRSwNCiAgICAgIF9FLA0KICAgICAgX1IsDQogICAgICBfRSwNCiAgICAgIF9FDQogICAgfSwNCiAgICB7DQogICAgICBfVywNCiAgICAgIF9RLA0KICAgICAgX0UsDQogICAgICBfVywNCiAgICAgIF9XLA0KICAgICAgX1IsDQogICAgICBfVywNCiAgICAgIF9RLA0KICAgICAgX1csDQogICAgICBfUSwNCiAgICAgIF9SLA0KICAgICAgX1EsDQogICAgICBfUSwNCiAgICAgIF9FLA0KICAgICAgX0UsDQogICAgICBfUiwNCiAgICAgIF9FLA0KICAgICAgX0UNCiAgICB9DQogIH0NCiAgbGFzdExldmVsID0gbXlIZXJvLmxldmVsIC0gMQ0KICBaaG9ueWFzU290ID0gbmlsDQogIFpoeW9uYXNSZWFkeSA9IGZhbHNlDQogIGFjdGl2ZU1pbmlvbnNBdHRhY2tzID0ge30NCiAgdHVycmV0Rm9jdXMgPSB7DQogICAgdHVycmV0ID0gbmlsLA0KICAgIHN0YXJ0VCA9IG9zLmNsb2NrKCksDQogICAgc3BlbGwgPSBuaWwsDQogICAgZm9jdXNlZCA9IGZhbHNlDQogIH0NCiAgZ2FwQ2xvc2VTZXR0aW5ncyA9IHsNCiAgICB0aW1lID0gb3MuY2xvY2soKQ0KICB9DQogIHRhcmdldCA9IG5pbA0KICB0cyA9IFRhcmdldFNlbGVjdG9yKFRBUkdFVF9MT1dfSFBfUFJJT1JJVFksIDcwMCkNCiAgdHMubmFtZSA9ICJUUyINCiAgdHNMb25nID0gVGFyZ2V0U2VsZWN0b3IoVEFSR0VUX0xPV19IUF9QUklPUklUWSwgMTUwMCkNCiAgdHNMb25nLm5hbWUgPSAiR2FwQ2xvc2UiDQogIGV4YW1wbGVUYXJnZXQgPSBuaWwNCiAgZm9yY2VkVGFyZ2V0ID0gbmlsDQogIGZvcmNlZFRhcmdldFRpbWUgPSBvcy5jbG9jaygpDQogIGVuZW15TWluaW9ucyA9IG1pbmlvbk1hbmFnZXIoTUlOSU9OX0VORU1ZLCBTcGVsbHMuVy5yYW5nZSwgbXlIZXJvLCBNSU5JT05fU09SVF9IRUFMVEhfREVDKQ0KICBfRy5vbGREcmF3Q2lyY2xlID0gcmF3Z2V0KF9HLCAiRHJhd0NpcmNsZSIpDQogIF9HLkRyYXdDaXJjbGUgPSBEcmF3Q2lyY2xlMg0KICBCYXNlQW5pbWF0aW9uVGltZSA9IHt9DQogIEJhc2VXaW5kVXBUaW1lID0ge30NCiAgaGFzUG90aW9uQWN0aXZlID0gZmFsc2UNCiAgcHJpb3JpdHlUYWJsZSA9IHsNCiAgICBBUCA9IHsNCiAgICAgICJBbm5pZSIsDQogICAgICAiQWhyaSIsDQogICAgICAiQWthbGkiLA0KICAgICAgIkFuaXZpYSIsDQogICAgICAiQW5uaWUiLA0KICAgICAgIkJyYW5kIiwNCiAgICAgICJDYXNzaW9wZWlhIiwNCiAgICAgICJEaWFuYSIsDQogICAgICAiRXZlbHlubiIsDQogICAgICAiRmlkZGxlU3RpY2tzIiwNCiAgICAgICJGaXp6IiwNCiAgICAgICJHcmFnYXMiLA0KICAgICAgIkhlaW1lcmRpbmdlciIsDQogICAgICAiS2FydGh1cyIsDQogICAgICAiS2Fzc2FkaW4iLA0KICAgICAgIkthdGFyaW5hIiwNCiAgICAgICJLYXlsZSIsDQogICAgICAiS2VubmVuIiwNCiAgICAgICJMZWJsYW5jIiwNCiAgICAgICJMaXNzYW5kcmEiLA0KICAgICAgIkx1eCIsDQogICAgICAiTWFsemFoYXIiLA0KICAgICAgIk1vcmRla2Fpc2VyIiwNCiAgICAgICJNb3JnYW5hIiwNCiAgICAgICJOaWRhbGVlIiwNCiAgICAgICJPcmlhbm5hIiwNCiAgICAgICJSeXplIiwNCiAgICAgICJTaW9uIiwNCiAgICAgICJTd2FpbiIsDQogICAgICAiU3luZHJhIiwNCiAgICAgICJUZWVtbyIsDQogICAgICAiVHdpc3RlZEZhdGUiLA0KICAgICAgIlZlaWdhciIsDQogICAgICAiVmlrdG9yIiwNCiAgICAgICJWbGFkaW1pciIsDQogICAgICAiWGVyYXRoIiwNCiAgICAgICJaaWdncyIsDQogICAgICAiWnlyYSIsDQogICAgICAiVmVsa296IiwNCiAgICAgICJFa2tvIg0KICAgIH0sDQogICAgU3VwcG9ydCA9IHsNCiAgICAgICJBbGlzdGFyIiwNCiAgICAgICJCbGl0emNyYW5rIiwNCiAgICAgICJKYW5uYSIsDQogICAgICAiS2FybWEiLA0KICAgICAgIkxlb25hIiwNCiAgICAgICJMdWx1IiwNCiAgICAgICJOYW1pIiwNCiAgICAgICJOdW51IiwNCiAgICAgICJTb25hIiwNCiAgICAgICJTb3Jha2EiLA0KICAgICAgIlRhcmljIiwNCiAgICAgICJUaHJlc2giLA0KICAgICAgIlppbGVhbiIsDQogICAgICAiQnJhdW0iDQogICAgfSwNCiAgICBUYW5rID0gew0KICAgICAgIkFtdW11IiwNCiAgICAgICJDaG9nYXRoIiwNCiAgICAgICJEck11bmRvIiwNCiAgICAgICJHYWxpbyIsDQogICAgICAiSGVjYXJpbSIsDQogICAgICAiTWFscGhpdGUiLA0KICAgICAgIk1hb2thaSIsDQogICAgICAiTmFzdXMiLA0KICAgICAgIlJhbW11cyIsDQogICAgICAiU2VqdWFuaSIsDQogICAgICAiTmF1dGlsdXMiLA0KICAgICAgIlNoZW4iLA0KICAgICAgIlNpbmdlZCIsDQogICAgICAiU2thcm5lciIsDQogICAgICAiVm9saWJlYXIiLA0KICAgICAgIldhcndpY2siLA0KICAgICAgIllvcmljayIsDQogICAgICAiWmFjIg0KICAgIH0sDQogICAgQURfQ2FycnkgPSB7DQogICAgICAiQXNoZSIsDQogICAgICAiQ2FpdGx5biIsDQogICAgICAiQ29ya2kiLA0KICAgICAgIkRyYXZlbiIsDQogICAgICAiRXpyZWFsIiwNCiAgICAgICJHcmF2ZXMiLA0KICAgICAgIkpheWNlIiwNCiAgICAgICJKaW54IiwNCiAgICAgICJLb2dNYXciLA0KICAgICAgIkx1Y2lhbiIsDQogICAgICAiTWFzdGVyWWkiLA0KICAgICAgIk1pc3NGb3J0dW5lIiwNCiAgICAgICJQYW50aGVvbiIsDQogICAgICAiUXVpbm4iLA0KICAgICAgIlNoYWNvIiwNCiAgICAgICJTaXZpciIsDQogICAgICAiVGFsb24iLA0KICAgICAgIlRyeW5kYW1lcmUiLA0KICAgICAgIlRyaXN0YW5hIiwNCiAgICAgICJUd2l0Y2giLA0KICAgICAgIlVyZ290IiwNCiAgICAgICJWYXJ1cyIsDQogICAgICAiVmF5bmUiLA0KICAgICAgIllhc3VvIiwNCiAgICAgICJaZWQiLA0KICAgICAgIkthbGlzdGEiDQogICAgfSwNCiAgICBCcnVpc2VyID0gew0KICAgICAgIkFhdHJveCIsDQogICAgICAiRGFyaXVzIiwNCiAgICAgICJFbGlzZSIsDQogICAgICAiRmlvcmEiLA0KICAgICAgIkdhbmdwbGFuayIsDQogICAgICAiR2FyZW4iLA0KICAgICAgIklyZWxpYSIsDQogICAgICAiSmFydmFuSVYiLA0KICAgICAgIkpheCIsDQogICAgICAiS2hheml4IiwNCiAgICAgICJMZWVTaW4iLA0KICAgICAgIk5vY3R1cm5lIiwNCiAgICAgICJPbGFmIiwNCiAgICAgICJQb3BweSIsDQogICAgICAiUmVuZWt0b24iLA0KICAgICAgIlJlbmdhciIsDQogICAgICAiUml2ZW4iLA0KICAgICAgIlJ1bWJsZSIsDQogICAgICAiU2h5dmFuYSIsDQogICAgICAiVHJ1bmRsZSIsDQogICAgICAiVWR5ciIsDQogICAgICAiVmkiLA0KICAgICAgIk1vbmtleUtpbmciLA0KICAgICAgIlhpblpoYW8iDQogICAgfQ0KICB9DQogIGNhbkNhc3RTcGVsbHMgPSB0cnVlDQogIFJTa2lsbCA9IG5pbA0KICBSU2tpbGxUaW1lID0gb3MuY2xvY2soKQ0KICBSU2tpbGxQb3MgPSBuaWwNCiAgY2FzdGVkV1Rocm91Z2hIYXJhc3MgPSB7DQogICAgYm9vbCA9IGZhbHNlLA0KICAgIHRpbWUgPSBvcy5jbG9jaygpDQogIH0NCiAgY2FzdGVkRSA9IGZhbHNlDQogIGNhc3RlZEVUaW1lID0gb3MuY2xvY2soKQ0KICBpZiBhZGEgdGhlbg0KICAgIGJkYSA9IFZQcmVkaWN0aW9uKCkNCiAgZW5kDQogIGlmIGJjYSB0aGVuDQogICAgTG9hZERpdmluZVByZWRpY3Rpb24oKQ0KICBlbmQNCiAgaWYgc1ByZWRMb2FkZWQgdGhlbg0KICAgIGNkYSA9IFNQcmVkaWN0aW9uKCkNCiAgZW5kDQogIGlmIGNjYSB0aGVuDQogICAgSFBfVywgSFBfRSA9IG5pbCwgbmlsDQogICAgX2RhID0gSFByZWRpY3Rpb24oKQ0KICAgIExvYWRIUHJlZGljdGlvbigpDQogIGVuZA0KICBjdXJyZW50UHJlZGljdGlvbiA9IG5pbA0KZW5kDQpmdW5jdGlvbiBSU3RhdGUoZGRhKQ0KICBsb2NhbCBfX2IgPSBteUhlcm86R2V0U3BlbGxEYXRhKF9SKS5uYW1lDQogIHJldHVybiBkZGEgYW5kIChkZGEgPT0gIlEiIGFuZCBfX2IgPT0gU3BlbGxzLlIuUW5hbWUgb3IgZGRhID09ICJXIiBhbmQgX19iID09IFNwZWxscy5SLlduYW1lIG9yIGRkYSA9PSAiRSIgYW5kIF9fYiA9PSBTcGVsbHMuUi5FbmFtZSkNCmVuZA0KZnVuY3Rpb24gTG9hZEhQcmVkaWN0aW9uKCkNCiAgSFBfRSA9IEhQU2tpbGxzaG90KHsNCiAgICB0eXBlID0gIkRlbGF5TGluZSIsDQogICAgZGVsYXkgPSAwLjI1LA0KICAgIHJhbmdlID0gOTUwLA0KICAgIHNwZWVkID0gMTYwMCwNCiAgICBjb2xsaXNpb25NID0gdHJ1ZSwNCiAgICBjb2xsaXNpb25IID0gdHJ1ZSwNCiAgICB3aWR0aCA9IDE0MA0KICB9KQ0KICBIUF9XID0gSFBTa2lsbHNob3Qoew0KICAgIHR5cGUgPSAiRGVsYXlDaXJjbGUiLA0KICAgIGRlbGF5ID0gU3BlbGxzLlcuZGVsYXksDQogICAgcmFuZ2UgPSBTcGVsbHMuVy5yYW5nZSArIDUwLA0KICAgIHNwZWVkID0gU3BlbGxzLlcuc3BlZWQsDQogICAgcmFkaXVzID0gU3BlbGxzLlcucmFkaXVzDQogIH0pDQplbmQNCmZ1bmN0aW9uIExvYWREaXZpbmVQcmVkaWN0aW9uKCkNCiAgaWYgYmNhIHRoZW4NCiAgICBEUCA9IERpdmluZVByZWQoKQ0KICAgIGVTUyA9IExpbmVTUyhTcGVsbHMuRS5zcGVlZCwgU3BlbGxzLkUucmFuZ2UsIFNwZWxscy5FLnJhZGl1cywgU3BlbGxzLkUuZGVsYXkgKiAxMDAwLCAwKQ0KICAgIHdTUyA9IENpcmNsZVNTKFNwZWxscy5XLnNwZWVkLCBTcGVsbHMuVy5yYW5nZSwgU3BlbGxzLlcucmFkaXVzLCBTcGVsbHMuVy5kZWxheSAqIDEwMDAsIG1hdGguaHVnZSkNCiAgICBEUDpiaW5kU1MoImVTa2lsbFNob3QiLCBlU1MsIDEpDQogICAgRFA6YmluZFNTKCJ3U2tpbGxTaG90Iiwgd1NTLCAxKQ0KICAgIHByZWRUaW1lciA9IFRpbWVyQyg1MDApDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBDaGVja09yYldhbGtlcigpDQogIGlmIF9HLlJlYm9ybl9Jbml0aWFsaXNlZCB0aGVuDQogICAgU0FDTG9hZGVkID0gdHJ1ZQ0KICAgIE1lbnUub3Jid2Fsa2VyOmFkZFBhcmFtKCJpbmZvNiIsICJEZXRlY3RlZCBTQUMiLCBTQ1JJUFRfUEFSQU1fSU5GTywgIiIpDQogICAgX0cuQXV0b0NhcnJ5LlNraWxsczpEaXNhYmxlQWxsKCkNCiAgICBTYXkoIlNBQyBEZXRlY3RlZC4iKQ0KICBlbHNlaWYgRmlsZUV4aXN0KExJQl9QQVRIIC4uICJTeE9yYldhbGsubHVhIikgdGhlbg0KICAgIHJlcXVpcmUoIlN4T3JiV2FsayIpDQogICAgZGJhID0gdHJ1ZQ0KICAgIF9HLlN4T3JiOkxvYWRUb01lbnUoTWVudS5vcmJ3YWxrZXIpDQogICAgU2F5KCJTeE9yYiBkZXRlY3RlZC4iKQ0KICBlbmQNCiAgaWYgU0FDTG9hZGVkIG9yIGRiYSB0aGVuDQogICAgb3JiV2Fsa0xvYWRlZCA9IHRydWUNCiAgZW5kDQogIGlmIG5vdCBvcmJXYWxrTG9hZGVkIHRoZW4NCiAgICBTYXkoIllvdSBuZWVkIGVpdGhlciBTQUMgb3IgU3hPcmJXYWxrIGZvciB0aGlzIHNjcmlwdC4gUGxlYXNlIGRvd25sb2FkIG9uZSBvZiB0aGVtLiIpDQogIGVsc2UNCiAgICBpZiBkYWEgdGhlbg0KICAgICAgU2F5KCJXZWxjb21lICIgLi4gR2V0VXNlcigpIC4uICI6IFByb21vdGlvbiAtIEZyZWUgRGF5IikNCiAgICBlbHNlaWYgYmFhIHRoZW4NCiAgICAgIFNheSgiV2VsY29tZSAiIC4uIEdldFVzZXIoKSAuLiAiOiBUcmlhbCB1c2VyIikNCiAgICBlbmQNCiAgICBpZiBjYWEgdGhlbg0KICAgICAgU2F5KCJXZWxjb21lICIgLi4gR2V0VXNlcigpIC4uICI6IFBhaWQgdXNlciIpDQogICAgZW5kDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBPbkxvYWQoKQ0KICBpZiBfRy5MZUJsYW5jX1BlcmZvcm1BdXRvVXBkYXRlIHRoZW4NCiAgICBBdXRvVXBkYXRlKCkNCiAgZW5kDQogIERlY2xhcmVWYXJpYWJsZXMoKQ0KICBTdW1tb25lcnMoKQ0KICBEZWxheUFjdGlvbihmdW5jdGlvbigpDQogICAgQ2hlY2tPcmJXYWxrZXIoKQ0KICBlbmQsIDEwKQ0KICBEcmF3TWVudSgpDQogIGN1cnJlbnRQcmVkaWN0aW9uID0gTWVudS5wcmVkaWN0aW9uLnVzZVByZWRpY3Rpb24NCiAgaWYgaGVyb01hbmFnZXIuaUNvdW50ID09IDEwIHRoZW4NCiAgICBhcnJhbmdlUHJpb3JpdHlzKCkNCiAgZWxzZWlmIGhlcm9NYW5hZ2VyLmlDb3VudCA9PSA2IHRoZW4NCiAgICBhcnJhbmdlUHJpb3JpdHlzVFQoKQ0KICBlbmQNCmVuZA0KZnVuY3Rpb24gT25EcmF3KCkNCiAgaWYgbXlIZXJvLmRlYWQgdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgaWYgTWVudS5kcmF3aW5ncy5kcmF3IHRoZW4NCiAgICBpZiBNZW51LmRyYXdpbmdzLmRyYXdRIGFuZCBDYW5EcmF3U3BlbGwoX1EpIHRoZW4NCiAgICAgIERyYXdDaXJjbGUobXlIZXJvLngsIG15SGVyby55LCBteUhlcm8ueiwgU3BlbGxzLlEucmFuZ2UsIFJHQigyNTUsIDEwMiwgMTAyKSkNCiAgICBlbmQNCiAgICBpZiBNZW51LmRyYXdpbmdzLmRyYXdXIGFuZCBDYW5EcmF3U3BlbGwoX1cpIHRoZW4NCiAgICAgIERyYXdDaXJjbGUobXlIZXJvLngsIG15SGVyby55LCBteUhlcm8ueiwgU3BlbGxzLlcucmFuZ2UsIFJHQigyNTUsIDUxLCAxNTMpKQ0KICAgIGVuZA0KICAgIGlmIE1lbnUuZHJhd2luZ3MuZHJhd1RhcmdldCBhbmQgdGFyZ2V0IGFuZCBWYWxpZFRhcmdldCh0YXJnZXQpIHRoZW4NCiAgICAgIGxvY2FsIGRkYSA9IFdvcmxkVG9TY3JlZW4oRDNEWFZFQ1RPUjModGFyZ2V0LngsIHRhcmdldC55LCB0YXJnZXQueikpDQogICAgICBsb2NhbCBfX2IgPSBkZGEueCAtIDM1DQogICAgICBsb2NhbCBhX2IgPSBkZGEueSAtIDQwDQogICAgICBpZiBmb3JjZWRUYXJnZXQgYW5kIGZvcmNlZFRhcmdldC5uZXR3b3JrSUQgPT0gdGFyZ2V0Lm5ldHdvcmtJRCB0aGVuDQogICAgICAgIERyYXdUZXh0KCJGb3JjZWQ6ICIgLi4gdGFyZ2V0LmNoYXJOYW1lIC4uICIgLSAiIC4uICJEaXN0YW5jZSA6ICIgLi4gbWF0aC5jZWlsKEdldERpc3RhbmNlKHRhcmdldCkpLCAxMiwgX19iLCBhX2IsIFJHQigyNTUsIDAsIDApKQ0KICAgICAgZWxzZQ0KICAgICAgICBEcmF3VGV4dCh0YXJnZXQuY2hhck5hbWUgLi4gIiAtICIgLi4gIkRpc3RhbmNlIDogIiAuLiBtYXRoLmNlaWwoR2V0RGlzdGFuY2UodGFyZ2V0KSksIDEyLCBfX2IsIGFfYiwgUkdCKDI1NSwgMCwgMCkpDQogICAgICBlbmQNCiAgICBlbmQNCiAgICBpZiBNZW51LmRyYXdpbmdzLmRyYXdFIGFuZCBDYW5EcmF3U3BlbGwoX0UpIHRoZW4NCiAgICAgIERyYXdDaXJjbGUobXlIZXJvLngsIG15SGVyby55LCBteUhlcm8ueiwgY3VycmVudFJhbmdlLCBSR0IoMjU1LCAxNTMsIDE1MykpDQogICAgZW5kDQogICAgaWYgTWVudS5jb21iby5lc2V0dGluZ3MuZHJhdyB0aGVuDQogICAgICBsb2NhbCBkZGEgPSBWZWN0b3IobXlIZXJvKSArIChWZWN0b3IobW91c2VQb3MpIC0gbXlIZXJvKTpub3JtYWxpemVkKCkgKiBjdXJyZW50UmFuZ2UNCiAgICAgIERyYXdMaW5lM0QobXlIZXJvLnBvcy54LCBteUhlcm8ucG9zLnksIG15SGVyby5wb3MueiwgZGRhLngsIGRkYS55LCBkZGEueiwgMTAsIFJHQigyNTUsIDMsIDE0KSkNCiAgICBlbmQNCiAgICBpZiBNZW51LmRyYXdpbmdzLmRyYXdLaWxsYWJsZSB0aGVuDQogICAgICBmb3IgZGRhLCBfX2IgaW4gcGFpcnMoR2V0RW5lbXlIZXJvZXMoKSkgZG8NCiAgICAgICAgaWYgX19iIGFuZCBWYWxpZFRhcmdldChfX2IsIDMwMDApIHRoZW4NCiAgICAgICAgICBsb2NhbCBhX2IgPSBXb3JsZFRvU2NyZWVuKEQzRFhWRUNUT1IzKF9fYi54LCBfX2IueSwgX19iLnopKQ0KICAgICAgICAgIGxvY2FsIGJfYiA9IGFfYi54IC0gMzUNCiAgICAgICAgICBsb2NhbCBjX2IgPSBhX2IueSAtIDUwDQogICAgICAgICAgRHJhd1RleHQoS2lsbFRleHRbX19iLm5ldHdvcmtJRF0sIE1lbnUuZHJhd2luZ3MuZHJhd0tpbGxhYmxlV2lkdGgsIGJfYiwgY19iLCBBUkdCKDI1NSwgMjU1LCAyMDQsIDApKQ0KICAgICAgICBlbmQNCiAgICAgIGVuZA0KICAgIGVuZA0KICBlbmQNCmVuZA0KZnVuY3Rpb24gQ2FuRHJhd1NwZWxsKGRkYSkNCiAgaWYgTWVudS5kcmF3aW5ncy5kcmF3U3BlbGxSZWFkeSB0aGVuDQogICAgaWYgZGRhID09IF9RIHRoZW4NCiAgICAgIGlmIG5vdCBRcmVhZHkgdGhlbg0KICAgICAgICByZXR1cm4gZmFsc2UNCiAgICAgIGVuZA0KICAgIGVsc2VpZiBkZGEgPT0gX1cgdGhlbg0KICAgICAgaWYgbm90IElzV1JlYWR5KCkgdGhlbg0KICAgICAgICByZXR1cm4gZmFsc2UNCiAgICAgIGVuZA0KICAgIGVsc2VpZiBkZGEgPT0gX0UgYW5kIG5vdCBFcmVhZHkgdGhlbg0KICAgICAgcmV0dXJuIGZhbHNlDQogICAgZW5kDQogIGVuZA0KICByZXR1cm4gdHJ1ZQ0KZW5kDQpmdW5jdGlvbiBDaGVja0ZvcmNlZFRhcmdldCgpDQogIGlmIGZvcmNlZFRhcmdldCB0aGVuDQogICAgaWYgZm9yY2VkVGFyZ2V0LmRlYWQgdGhlbg0KICAgICAgZm9yY2VkVGFyZ2V0ID0gbmlsDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBpZiBteUhlcm8uZGVhZCB0aGVuDQogICAgICBmb3JjZWRUYXJnZXQgPSBuaWwNCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIENvdW50RW5lbXlIZXJvSW5SYW5nZShHZXREaXN0YW5jZShmb3JjZWRUYXJnZXQpKSA9PSAxIHRoZW4NCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIEdldERpc3RhbmNlU3FyKGZvcmNlZFRhcmdldCkgPj0gNDAwMDAwMCB0aGVuDQogICAgICBTYXkoIkZvcmNlZCB0YXJnZXQgcmFuIG91dCBvZiByYW5nZS4iKQ0KICAgICAgU2F5KCJEZXNlbGVjdGVkOiAiIC4uIGZvcmNlZFRhcmdldC5jaGFyTmFtZSkNCiAgICAgIGZvcmNlZFRhcmdldCA9IG5pbA0KICAgICAgcmV0dXJuDQogICAgZWxzZWlmIGZvcmNlZFRhcmdldFRpbWUgKyAxNSA8IG9zLmNsb2NrKCkgdGhlbg0KICAgICAgU2F5KCJUaW1lIGV4cGlyZWQuIERlc2VsZWN0ZWQ6ICIgLi4gZm9yY2VkVGFyZ2V0LmNoYXJOYW1lKQ0KICAgICAgZm9yY2VkVGFyZ2V0ID0gbmlsDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIEF1dG9MZXZlbCgpDQogIGlmIG15SGVyby5sZXZlbCA+IGxhc3RMZXZlbCB0aGVuDQogICAgTGV2ZWxTcGVsbChhdXRvTGV2ZWxUYWJsZXNbTWVudS5taXNjLmF1dG9sZXZlbC5zZXF1ZW5jZV1bbXlIZXJvLmxldmVsXSkNCiAgICBsYXN0TGV2ZWwgPSBteUhlcm8ubGV2ZWwNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIENvbnRyb2xFUmFuZ2UoKQ0KICBsb2NhbCBkZGEgPSBNZW51LmNvbWJvLmVzZXR0aW5ncy5yYW5nZQ0KICBsb2NhbCBfX2IgPSBNZW51LmNvbWJvLmVzZXR0aW5ncy53aWR0aA0KICBsb2NhbCBhX2IgPSBmYWxzZQ0KICBpZiBjdXJyZW50UmFuZ2Ugfj0gZGRhIHRoZW4NCiAgICBhX2IgPSB0cnVlDQogICAgY3VycmVudFJhbmdlID0gZGRhDQogIGVuZA0KICBpZiBjdXJyZW50V2lkdGggfj0gX19iIHRoZW4NCiAgICBhX2IgPSB0cnVlDQogICAgY3VycmVudFdpZHRoID0gX19iDQogIGVuZA0KICBpZiBhX2IgdGhlbg0KICAgIGlmIGNjYSB0aGVuDQogICAgICBIUF9FID0gSFBTa2lsbHNob3Qoew0KICAgICAgICB0eXBlID0gIkRlbGF5TGluZSIsDQogICAgICAgIGRlbGF5ID0gMC4yNSwNCiAgICAgICAgcmFuZ2UgPSBjdXJyZW50UmFuZ2UsDQogICAgICAgIHNwZWVkID0gMTYwMCwNCiAgICAgICAgY29sbGlzaW9uTSA9IHRydWUsDQogICAgICAgIGNvbGxpc2lvbkggPSB0cnVlLA0KICAgICAgICB3aWR0aCA9IGN1cnJlbnRXaWR0aA0KICAgICAgfSkNCiAgICBlbmQNCiAgICBpZiBiY2EgdGhlbg0KICAgICAgTGluZVNTKFNwZWxscy5FLnNwZWVkLCBjdXJyZW50UmFuZ2UsIGN1cnJlbnRXaWR0aCwgU3BlbGxzLkUuZGVsYXkgKiAxMDAwLCAwKQ0KICAgIGVuZA0KICBlbmQNCmVuZA0KZnVuY3Rpb24gT25UaWNrKCkNCiAgaWYgbXlIZXJvLmRlYWQgdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgQ2hlY2tzKCkNCiAgQ2hlY2tJZ25pdGUoKQ0KICBJZ25pdGVXaWxsS2lsbE1lKCkNCiAgaWYgTWVudS5taXNjLmF1dG9sZXZlbC51c2VBdXRvTGV2ZWwgdGhlbg0KICAgIEF1dG9MZXZlbCgpDQogIGVuZA0KICBpZiBNZW51LmtleXNldHRpbmdzLnVzZUNvbWJvIG9yIE1lbnUua2V5c2V0dGluZ3MudXNlQ29tYm9HYXBDbG9zZSBvciBNZW51LmtleXNldHRpbmdzLnVzZUNvbWJvQ2hhaW4gdGhlbg0KICAgIENvbWJvKCkNCiAgZW5kDQogIGlmIE1lbnUuc2V0dGluZ3NXLnVzZU9wdGlvbmFsIHRoZW4NCiAgICBMZUJsYW5jU3BlY2lmaWNTcGVsbENoZWNrcygpDQogIGVuZA0KICBpZiBNZW51LmtleXNldHRpbmdzLnVzZUNvbWJvR2FwQ2xvc2Ugb3IgTWVudS5rZXlzZXR0aW5ncy51c2VDb21ib0NoYWluIHRoZW4NCiAgICBpZiB0YXJnZXQgdGhlbg0KICAgICAgT3JiV2Fsa2VyOk9yYndhbGsodGFyZ2V0KQ0KICAgIGVsc2UNCiAgICAgIE9yYldhbGtlcjpPcmJ3YWxrKCkNCiAgICBlbmQNCiAgZW5kDQogIGlmIE1lbnUua2V5c2V0dGluZ3MudXNlSGFyYXNzIHRoZW4NCiAgICBIYXJhc3MoKQ0KICBlbmQNCiAgaWYgTWVudS5rZXlzZXR0aW5ncy51c2VMYW5lQ2xlYXIgdGhlbg0KICAgIExhbmVDbGVhcigpDQogIGVuZA0KICBpZiBDYW5QZXJtZm9ybUtpbGxTdGVhbCgpIHRoZW4NCiAgICBLaWxsU3RlYWwoKQ0KICBlbmQNCiAgaWYgTWVudS5taXNjLnpob255YXMuemhvbnlhcyBhbmQgbm90IEluRm91bnRhaW4oKSB0aGVuDQogICAgWmhvbnlhcygpDQogIGVuZA0KICBpZiBpZ25pdGUgfj0gbmlsIGFuZCBNZW51Lm1pc2MuYXV0b2lnbml0ZS51c2VJZ25pdGUgdGhlbg0KICAgIFVzZUlnbml0ZSgpDQogIGVuZA0KICBpZiBub3Qgb3JiV2Fsa0xvYWRlZCB0aGVuDQogICAgcmV0dXJuDQogIGVuZA0KICBpZiBNZW51LmNvbWJvLmNvbWJvQUEgYW5kIChkYmEgYW5kIF9HLlN4T3JiOkdldE1vZGUoKSA9PSAxIG9yIFNBQ0xvYWRlZCBhbmQgX0cuQXV0b0NhcnJ5LktleXMuQXV0b0NhcnJ5KSBhbmQgQUFkaXNhYmxlZCB0aGVuDQogICAgaWYgZGJhIHRoZW4NCiAgICAgIF9HLlN4T3JiOkVuYWJsZUF0dGFja3MoKQ0KICAgIGVsc2VpZiBTQUNMb2FkZWQgdGhlbg0KICAgICAgX0cuQXV0b0NhcnJ5Lk15SGVybzpBdHRhY2tzRW5hYmxlZCh0cnVlKQ0KICAgIGVuZA0KICAgIEFBZGlzYWJsZWQgPSBmYWxzZQ0KICBlbmQNCiAgaWYgKGRiYSBhbmQgX0cuU3hPcmI6R2V0TW9kZSgpID09IDEgb3IgU0FDTG9hZGVkIGFuZCBfRy5BdXRvQ2FycnkuS2V5cy5BdXRvQ2FycnkpIGFuZCBub3QgTWVudS5jb21iby5jb21ib0FBIGFuZCBub3QgQUFkaXNhYmxlZCB0aGVuDQogICAgaWYgZGJhIHRoZW4NCiAgICAgIF9HLlN4T3JiOkRpc2FibGVBdHRhY2tzKCkNCiAgICBlbHNlaWYgU0FDTG9hZGVkIHRoZW4NCiAgICAgIF9HLkF1dG9DYXJyeS5NeUhlcm86QXR0YWNrc0VuYWJsZWQoZmFsc2UpDQogICAgZW5kDQogICAgQUFkaXNhYmxlZCA9IHRydWUNCiAgZW5kDQogIGlmIE1lbnUua2V5c2V0dGluZ3MudXNlRmFybSBhbmQgKGRiYSBhbmQgbm90IF9HLlN4T3JiOkdldE1vZGUoKSA9PSAxIGFuZCBub3QgX0cuU3hPcmI6R2V0TW9kZSgpID09IDIgYW5kIG5vdCBfRy5TeE9yYjpHZXRNb2RlKCkgPT0gMyBvciBTQUNMb2FkZWQgYW5kIG5vdCBfRy5BdXRvQ2FycnkuS2V5cy5BdXRvQ2FycnkgYW5kIG5vdCBfRy5BdXRvQ2FycnkuS2V5cy5NaXhlZE1vZGUgYW5kIG5vdCBfRy5BdXRvQ2FycnkuS2V5cy5MYW5lQ2xlYXIpIHRoZW4NCiAgICBGYXJtKCkNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIElzU3BlbGxSZWFkeShkZGEsIF9fYikNCiAgcmV0dXJuIGRkYTpHZXRTcGVsbERhdGEoX19iKS5sZXZlbCBhbmQgZGRhOkdldFNwZWxsRGF0YShfX2IpLmxldmVsID49IDEgYW5kIGRkYTpHZXRTcGVsbERhdGEoX19iKS5jdXJyZW50Q2QgYW5kIG1hdGguZmxvb3IoZGRhOkdldFNwZWxsRGF0YShfX2IpLmN1cnJlbnRDZCkgPT0gMA0KZW5kDQpmdW5jdGlvbiBUb29EYW5nZXJvdXMoZGRhKQ0KICBsb2NhbCBfX2IgPSAwDQogIGZvciBiX2IsIGNfYiBpbiBwYWlycyhHZXRFbmVteUhlcm9lcygpKSBkbw0KICAgIGlmIGNfYiBhbmQgY19iLnZpc2libGUgYW5kIG5vdCBjX2IuZGVhZCBhbmQgR2V0RGlzdGFuY2VTcXIoY19iKSA8PSA2NDAwMDAgdGhlbg0KICAgICAgZm9yIGRfYiwgX2FiIGluIHBhaXJzKHsNCiAgICAgICAgX1EsDQogICAgICAgIF9XLA0KICAgICAgICBfRSwNCiAgICAgICAgX1INCiAgICAgIH0pIGRvDQogICAgICAgIGlmIElzU3BlbGxSZWFkeShjX2IsIF9hYikgdGhlbg0KICAgICAgICAgIGxvY2FsIGFhYiA9IGNfYjpHZXRTcGVsbERhdGEoX2FiKS5yYW5nZQ0KICAgICAgICAgIGxvY2FsIGJhYiA9IGFhYiBhbmQgYWFiIG9yIDUwMA0KICAgICAgICAgIGlmIGJhYiBhbmQgdHlwZShiYWIpID09ICJudW1iZXIiIGFuZCBiYWIgPj0gR2V0RGlzdGFuY2UoY19iLCBkZGEpIHRoZW4NCiAgICAgICAgICAgIGxvY2FsIGNhYiA9IGdldERtZyhTcGVsbFRvU3RyaW5nKF9hYiksIG15SGVybywgY19iKQ0KICAgICAgICAgICAgaWYgbm90IGNhYiBvciBub3QgY2FiIHRoZW4NCiAgICAgICAgICAgICAgY2FiID0gMA0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBfX2IgPSBfX2IgKyBjYWINCiAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICBlbmQNCiAgICBlbmQNCiAgZW5kDQogIGxvY2FsIGFfYiA9IF9fYiAvIG15SGVyby5oZWFsdGggKiAxMDANCiAgYV9iID0gYV9iIGFuZCBtYXRoLmZsb29yKGFfYikgb3IgMA0KICBpZiBhX2IgdGhlbg0KICAgIGlmIGFfYiA+PSA3MDAgdGhlbg0KICAgICAgcmV0dXJuIDEwDQogICAgZWxzZWlmIGFfYiA+PSA2MDAgdGhlbg0KICAgICAgcmV0dXJuIDkNCiAgICBlbHNlaWYgYV9iID49IDUwMCB0aGVuDQogICAgICByZXR1cm4gOA0KICAgIGVsc2VpZiBhX2IgPj0gNDAwIHRoZW4NCiAgICAgIHJldHVybiA3DQogICAgZWxzZWlmIGFfYiA+PSAzMDAgdGhlbg0KICAgICAgcmV0dXJuIDYNCiAgICBlbHNlaWYgYV9iID49IDIwMCB0aGVuDQogICAgICByZXR1cm4gNQ0KICAgIGVsc2VpZiBhX2IgPj0gMTUwIHRoZW4NCiAgICAgIHJldHVybiA0DQogICAgZWxzZWlmIGFfYiA+PSAxMDAgdGhlbg0KICAgICAgcmV0dXJuIDMNCiAgICBlbHNlaWYgYV9iIDw9IDcwIGFuZCBhX2IgPj0gNTAgdGhlbg0KICAgICAgcmV0dXJuIDENCiAgICBlbHNlaWYgYV9iIDw9IDUwIHRoZW4NCiAgICAgIHJldHVybiAwDQogICAgZWxzZWlmIGFfYiA8PSAxMDAgdGhlbg0KICAgICAgcmV0dXJuIDINCiAgICBlbmQNCiAgZWxzZQ0KICAgIHJldHVybiAwDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBJc0tpbGxhYmxlKGRkYSkNCiAgbG9jYWwgX19iID0gMA0KICBsb2NhbCBhX2IgPSBkZGEuaGVhbHRoDQogIGZvciBiX2IsIGNfYiBpbiBwYWlycyh7DQogICAgX1EsDQogICAgX1csDQogICAgX0UsDQogICAgX1INCiAgfSkgZG8NCiAgICBpZiBjX2IgdGhlbg0KICAgICAgaWYgY19iID09IF9SIGFuZCBteUhlcm86Q2FuVXNlU3BlbGwoY19iKSA9PSBSRUFEWSB0aGVuDQogICAgICAgIF9fYiA9IF9fYiArIFNwZWxsRG1nQ2FsY3VsYXRpb25zKCJSUSIsIGRkYSkNCiAgICAgIGVsc2VpZiBjX2IgPT0gX1Igb3IgbXlIZXJvOkNhblVzZVNwZWxsKGNfYikgfj0gUkVBRFkgb3IgY19iID09IF9XIGFuZCB3VXNlZCgpIHRoZW4NCiAgICAgIGVsc2VpZiBjX2IgPT0gX1EgdGhlbg0KICAgICAgICBfX2IgPSBfX2IgKyBTcGVsbERtZ0NhbGN1bGF0aW9ucyhTcGVsbFRvU3RyaW5nKGNfYiksIGRkYSkNCiAgICAgICAgX19iID0gX19iICsgU3BlbGxEbWdDYWxjdWxhdGlvbnMoIlFQcm9jIiwgZGRhKQ0KICAgICAgZWxzZQ0KICAgICAgICBfX2IgPSBfX2IgKyBTcGVsbERtZ0NhbGN1bGF0aW9ucyhTcGVsbFRvU3RyaW5nKGNfYiksIGRkYSkNCiAgICAgIGVuZA0KICAgIGVuZA0KICBlbmQNCiAgaWYgbm90IGRhbWdlIG9yIG5vdCBfX2IgdGhlbg0KICAgIF9fYiA9IDANCiAgZW5kDQogIHJldHVybiBfX2IgYW5kIHR5cGUoX19iKSA9PSAibnVtYmVyIiBhbmQgYV9iIGFuZCB0eXBlKGFfYikgPT0gIm51bWJlciIgYW5kIGFfYiA8PSBfX2Igb3IgZmFsc2UNCmVuZA0KZnVuY3Rpb24gRGFtYWdlVG9NZShkZGEpDQogIGxvY2FsIF9fYiA9IDANCiAgZm9yIGFfYiwgYl9iIGluIHBhaXJzKHsNCiAgICBfUSwNCiAgICBfVywNCiAgICBfRSwNCiAgICBfUg0KICB9KSBkbw0KICAgIGlmIGJfYiBhbmQgZGRhOkNhblVzZVNwZWxsKGJfYikgPT0gUkVBRFkgdGhlbg0KICAgICAgX19iID0gX19iICsgZ2V0RG1nKFNwZWxsVG9TdHJpbmcoYl9iKSwgbXlIZXJvLCBkZGEpDQogICAgZW5kDQogIGVuZA0KICBfX2IgPSBkZGE6Q2FsY01hZ2ljRGFtYWdlKG15SGVybywgX19iKQ0KICBpZiBub3QgZGFtZ2Ugb3Igbm90IF9fYiB0aGVuDQogICAgX19iID0gMA0KICBlbmQNCiAgcmV0dXJuIF9fYiBhbmQgdHlwZShfX2IpID09ICJudW1iZXIiIGFuZCBoZWFsdGggYW5kIHR5cGUoaGVhbHRoKSA9PSAibnVtYmVyIiBhbmQgX19iIG9yIDANCmVuZA0KZnVuY3Rpb24gQ2hlY2tBRENUYXJnZXQoZGRhKQ0KICBsb2NhbCBfX2IgPSBmYWxzZQ0KICBsb2NhbCBhX2INCiAgZm9yIGJfYiwgY19iIGluIHBhaXJzKEdldEVuZW15SGVyb2VzKCkpIGRvDQogICAgaWYgY19iIGFuZCBjX2IudHlwZSBhbmQgY19iLnR5cGUgPT0gbXlIZXJvLnR5cGUgYW5kIEdldERpc3RhbmNlU3FyKGNfYikgPD0gY19iLnJhbmdlICogY19iLnJhbmdlIGFuZCB0YWJsZS5jb250YWlucyhwcmlvcml0eVRhYmxlLkFEX0NhcnJ5LCBjX2IuY2hhck5hbWUpIHRoZW4NCiAgICAgIF9fYiA9IHRydWUNCiAgICAgIGFfYiA9IGNfYg0KICAgICAgYnJlYWsNCiAgICBlbmQNCiAgZW5kDQogIGlmIF9fYiB0aGVuDQogICAgbG9jYWwgYl9iID0ge30NCiAgICBsb2NhbCBjX2IgPSBHZXRMYXRlbmN5KCkNCiAgICBmb3IgYmFiLCBjYWIgaW4gcGFpcnMoew0KICAgICAgX1EsDQogICAgICBfVywNCiAgICAgIF9FLA0KICAgICAgX1INCiAgICB9KSBkbw0KICAgICAgaWYgY2FiIGFuZCBteUhlcm86Q2FuVXNlU3BlbGwoY2FiKSA9PSBSRUFEWSB0aGVuDQogICAgICAgIHRhYmxlLmluc2VydChiX2IsIGNhYikNCiAgICAgIGVuZA0KICAgIGVuZA0KICAgIGxvY2FsIGRfYiA9IDANCiAgICBmb3IgYmFiLCBjYWIgaW4gcGFpcnMoYl9iKSBkbw0KICAgICAgbG9jYWwgZGFiID0gU3BlbGxzW1NwZWxsVG9TdHJpbmcoY2FiKV0uZGVsYXkNCiAgICAgIGxvY2FsIF9iYiA9IFNwZWxsc1tTcGVsbFRvU3RyaW5nKGNhYildLnNwZWVkDQogICAgICBpZiBkYWIgPT0gbmlsIHRoZW4NCiAgICAgICAgZGFiID0gMC4yDQogICAgICBlbmQNCiAgICAgIGlmIF9iYiA9PSBuaWwgdGhlbg0KICAgICAgICBfYmIgPSAxODAwDQogICAgICBlbmQNCiAgICAgIGRfYiA9IGRfYiArIGRhYiArIGNfYiAvIDIwMDAgKyBHZXREaXN0YW5jZShhX2IpIC8gX2JiDQogICAgZW5kDQogICAgbG9jYWwgX2FiID0gbWF0aC5jZWlsKG15SGVyby5oZWFsdGggLyBnZXREbWcoIkFEIiwgbXlIZXJvLCBhX2IpKQ0KICAgIGxvY2FsIGFhYiA9IDANCiAgICBpZiBCYXNlV2luZFVwVGltZVthX2IubmV0d29ya0lEXSBhbmQgQmFzZUFuaW1hdGlvblRpbWVbYV9iLm5ldHdvcmtJRF0gdGhlbg0KICAgICAgYWFiID0gKDEgLyAoYV9iLmF0dGFja1NwZWVkICogQmFzZVdpbmRVcFRpbWVbYV9iLm5ldHdvcmtJRF0pICsgMSAvIChhX2IuYXR0YWNrU3BlZWQgKiBCYXNlQW5pbWF0aW9uVGltZVthX2IubmV0d29ya0lEXSkgKyBjX2IgLyAyMDAwKSAqIF9hYg0KICAgIGVsc2UNCiAgICAgIGFhYiA9IF9hYiAvIGFfYi5hdHRhY2tTcGVlZA0KICAgIGVuZA0KICAgIGlmIGRfYiA8PSBhYWIgLyA1IHRoZW4NCiAgICAgIHJldHVybiB0cnVlDQogICAgZW5kDQogIGVuZA0KICByZXR1cm4gZmFsc2UNCmVuZA0KZnVuY3Rpb24gU3BlbGxUb1N0cmluZyhkZGEpDQogIHJldHVybiBkZGEgPT0gX1EgYW5kICJRIiBvciBkZGEgPT0gX1cgYW5kICJXIiBvciBkZGEgPT0gX0UgYW5kICJFIiBvciBkZGEgPT0gX1IgYW5kICJSIg0KZW5kDQpmdW5jdGlvbiBPbkFwcGx5QnVmZihkZGEsIF9fYiwgYV9iKQ0KICBpZiBfX2IgYW5kIF9fYi50eXBlID09IG15SGVyby50eXBlIGFuZCBhX2IgYW5kIGFfYi50eXBlIGFuZCBfX2IubmV0d29ya0lEIGFuZCB0YWJsZS5jb250YWlucyhidWZmVHlwZXMsIGFfYi50eXBlKSBhbmQgX19iLnZhbGlkIGFuZCBfX2IuYlRhcmdldGFibGUgdGhlbg0KICAgIGlzU3R1bm5lZFtfX2IubmV0d29ya0lEXSA9IHRydWUNCiAgZW5kDQogIGlmIGRkYSBhbmQgZGRhLmlzTWUgYW5kIF9fYiBhbmQgX19iLnRlYW0gYW5kIF9fYi50ZWFtIH49IG15SGVyby50ZWFtIGFuZCBfX2IudHlwZSBhbmQgX19iLnR5cGUgPT0gbXlIZXJvLnR5cGUgYW5kIG5vdCBfX2IuZGVhZCBhbmQgYV9iIGFuZCBhX2IubmFtZSB0aGVuDQogICAgaWYgYV9iLm5hbWU6ZmluZCgiTGVibGFuY1NvdWxTaGFja2xlIikgdGhlbg0KICAgICAgY2hhaW5UYXJnZXQgPSBfX2INCiAgICAgIGNhc3RlZEVUaW1lID0gb3MuY2xvY2soKQ0KICAgIGVuZA0KICAgIGlmIGFfYi5uYW1lOmZpbmQoU3BlbGxzLlEuYnVmZlEpIG9yIGFfYi5uYW1lOmZpbmQoU3BlbGxzLlEuYnVmZlIpIHRoZW4NCiAgICAgIGVuZW1pZXNCdWZmc1tfX2IubmV0d29ya0lEXS5yZWNlaXZlZCA9IHRydWUNCiAgICAgIGVuZW1pZXNCdWZmc1tfX2IubmV0d29ya0lEXS5lbmRUaW1lID0gb3MuY2xvY2soKSAqIDM1MDANCiAgICBlbmQNCiAgICBpZiBhX2IubmFtZTpsb3dlcigpOmZpbmQoInN1bW1vbmVyZG90IikgdGhlbg0KICAgICAgaWduaXRlVGlja1tfX2IubmV0d29ya0lEXS5pc0lnbml0ZWQgPSB0cnVlDQogICAgICBpZ25pdGVUaWNrW19fYi5uZXR3b3JrSURdLnN0YXJ0VCA9IG9zLmNsb2NrKCkNCiAgICBlbmQNCiAgZW5kDQogIGlmIF9fYiBhbmQgX19iLmlzTWUgYW5kIGFfYiBhbmQgYV9iLm5hbWUgPT0gIlJlZ2VuZXJhdGlvblBvdGlvbiIgdGhlbg0KICAgIGhhc1BvdGlvbkFjdGl2ZSA9IHRydWUNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIE9uUmVtb3ZlQnVmZihkZGEsIF9fYikNCiAgaWYgdGFyZ2V0IGFuZCB0YXJnZXQudHlwZSA9PSBteUhlcm8udHlwZSBhbmQgX19iIGFuZCBfX2IudHlwZSBhbmQgdGFyZ2V0Lm5ldHdvcmtJRCBhbmQgdGFibGUuY29udGFpbnMoYnVmZlR5cGVzLCBfX2IudHlwZSkgdGhlbg0KICAgIGlzU3R1bm5lZFt0YXJnZXQubmV0d29ya0lEXSA9IGZhbHNlDQogIGVuZA0KICBpZiBkZGEgYW5kIGRkYS50eXBlIGFuZCBkZGEudHlwZSA9PSBteUhlcm8udHlwZSBhbmQgX19iIGFuZCBfX2IubmFtZSB0aGVuDQogICAgaWYgY2hhaW5UYXJnZXQgYW5kIF9fYi5uYW1lOmZpbmQoIkxlYmxhbmNTb3VsU2hhY2tsZSIpIGFuZCBkZGEubmV0d29ya0lEID09IGNoYWluVGFyZ2V0Lm5ldHdvcmtJRCB0aGVuDQogICAgICBjaGFpblRhcmdldCA9IG5pbA0KICAgIGVuZA0KICAgIGlmIGlnbml0ZWRUYWJsZS5pZ25pdGVkIGFuZCBkZGEuaXNNZSBhbmQgX19iLm5hbWUgPT0gInN1bW1vbmVyZG90IiB0aGVuDQogICAgICBpZ25pdGVkVGFibGUuaWduaXRlZCA9IGZhbHNlDQogICAgICBpZ25pdGVkVGFibGUuc291cmNlID0gbmlsDQogICAgICBpZ25pdGVkVGFibGUuaGFzU2FpZCA9IGZhbHNlDQogICAgICBpZ25pdGVkVGFibGUud2lsbEtpbGxNZSA9IGZhbHNlDQogICAgZW5kDQogICAgaWYgZGRhLnRlYW0gYW5kIGRkYS50ZWFtIH49IG15SGVyby50ZWFtIGFuZCBpZ25pdGVUaWNrW2RkYS5uZXR3b3JrSURdLmlzSWduaXRlZCA9PSB0cnVlIGFuZCBfX2IubmFtZTpsb3dlcigpOmZpbmQoInN1bW1vbmVyZG90IikgdGhlbg0KICAgICAgaWduaXRlVGlja1tkZGEubmV0d29ya0lEXS5pc0lnbml0ZWQgPSBmYWxzZQ0KICAgIGVuZA0KICAgIGlmIGRkYS5pc01lIGFuZCBfX2IubmFtZSA9PSAiUmVnZW5lcmF0aW9uUG90aW9uIiBhbmQgaGFzUG90aW9uQWN0aXZlIHRoZW4NCiAgICAgIGhhc1BvdGlvbkFjdGl2ZSA9IGZhbHNlDQogICAgZW5kDQogICAgaWYgZGRhLnRlYW0gYW5kIGRkYS50ZWFtIH49IG15SGVyby50ZWFtIGFuZCBlbmVtaWVzQnVmZnNbZGRhLm5ldHdvcmtJRF0ucmVjZWl2ZWQgPT0gdHJ1ZSBhbmQgKF9fYi5uYW1lOmZpbmQoU3BlbGxzLlEuYnVmZlEpIG9yIF9fYi5uYW1lOmZpbmQoU3BlbGxzLlEuYnVmZlIpKSB0aGVuDQogICAgICBlbmVtaWVzQnVmZnNbZGRhLm5ldHdvcmtJRF0ucmVjZWl2ZWQgPSBmYWxzZQ0KICAgIGVuZA0KICBlbmQNCmVuZA0KZnVuY3Rpb24gU3BlbGxBdmFpbGFibGUoKQ0KICByZXR1cm4gUXJlYWR5IG9yIElzV1JlYWR5KCkgb3IgUnJlYWR5IG9yIEVyZWFkeQ0KZW5kDQpmdW5jdGlvbiBJZ25pdGVXaWxsS2lsbEVuZW15KGRkYSkNCiAgaWYgZGRhIGFuZCBkZGEudHlwZSBhbmQgZGRhLnR5cGUgPT0gbXlIZXJvLnR5cGUgYW5kIGRkYS5uZXR3b3JrSUQgdGhlbg0KICAgIGlmIGlnbml0ZSA9PSBuaWwgdGhlbg0KICAgICAgcmV0dXJuIGZhbHNlDQogICAgZW5kDQogICAgaWYgaWduaXRlVGlja1tkZGEubmV0d29ya0lEXS5pc0lnbml0ZWQgdGhlbg0KICAgICAgbG9jYWwgX19iID0gNSArIGlnbml0ZVRpY2tbZGRhLm5ldHdvcmtJRF0uc3RhcnRUIC0gb3MuY2xvY2soKQ0KICAgICAgaWYgX19iIDw9IDAgdGhlbg0KICAgICAgICBpZ25pdGVUaWNrW2RkYS5uZXR3b3JrSURdLmlzSWduaXRlZCA9IGZhbHNlDQogICAgICAgIHJldHVybiBmYWxzZQ0KICAgICAgZW5kDQogICAgICBsb2NhbCBhX2IgPSAxMCArIG15SGVyby5sZXZlbCAqIDQNCiAgICAgIGxvY2FsIGJfYiA9IF9fYiAqIGFfYg0KICAgICAgbG9jYWwgY19iID0gbXlIZXJvLmhlYWx0aCAvIG15SGVyby5tYXhIZWFsdGgNCiAgICAgIGlmIGJfYiA+IGRkYS5oZWFsdGggYW5kIGNfYiA+IDAuMiB0aGVuDQogICAgICAgIHJldHVybiB0cnVlDQogICAgICBlbmQNCiAgICBlbmQNCiAgZW5kDQogIHJldHVybiBmYWxzZQ0KZW5kDQpmdW5jdGlvbiBDb3VudE1pbmlvbnNBdHRhY2tpbmdtZSgpDQogIGxvY2FsIGRkYSA9IDANCiAgbG9jYWwgX19iID0gMA0KICBmb3IgYV9iLCBiX2IgaW4gcGFpcnMoYWN0aXZlTWluaW9uc0F0dGFja3MpIGRvDQogICAgaWYgYl9iIGFuZCBiX2IubWluaW9uIGFuZCBiX2IubWluaW9uLnRvdGFsRGFtYWdlIGFuZCBiX2IubWluaW9uLnZhbGlkIHRoZW4NCiAgICAgIGxvY2FsIGNfYiA9IDEwMCAvICgxMDAgKyBteUhlcm8uYXJtb3IpDQogICAgICBjX2IgPSBjX2Igb3IgMQ0KICAgICAgZGRhID0gZGRhICsgMQ0KICAgICAgX19iID0gYl9iLm1pbmlvbi50b3RhbERhbWFnZSAqIGNfYg0KICAgIGVuZA0KICBlbmQNCiAgcmV0dXJuIGRkYSwgX19iDQplbmQNCmZ1bmN0aW9uIE1pbmlvbnNBdHRhY2tpbmdNZSgpDQogIGZvciBkZGEsIF9fYiBpbiBwYWlycyhhY3RpdmVNaW5pb25zQXR0YWNrcykgZG8NCiAgICBsb2NhbCBhX2IgPSBmYWxzZQ0KICAgIGlmIF9fYiBhbmQgX19iLm1pbmlvbiBhbmQgX19iLm1pbmlvbi52YWxpZCB0aGVuDQogICAgICBpZiBfX2Iuc3BlbGwgYW5kIG5vdCBfX2IubWluaW9uLmRlYWQgdGhlbg0KICAgICAgICBpZiBWYWxpZFRhcmdldChfX2IubWluaW9uKSB0aGVuDQogICAgICAgICAgbG9jYWwgYl9iID0gX19iLnNwZWxsLndpbmRVcFRpbWUNCiAgICAgICAgICBiX2IgPSBiX2Igb3IgMA0KICAgICAgICAgIGxvY2FsIGNfYiA9IF9fYi5zcGVsbC5hbmltYXRpb25UaW1lDQogICAgICAgICAgY19iID0gY19iIG9yIDANCiAgICAgICAgICBsb2NhbCBkX2IgPSBfX2Iuc3RhcnRUICsgYl9iICsgR2V0TGF0ZW5jeSgpIC8gMjAwMCArIEdldERpc3RhbmNlKF9fYi5taW5pb24pIC8gbWF0aC5odWdlICsgY19iDQogICAgICAgICAgaWYgZF9iIDwgb3MuY2xvY2soKSB0aGVuDQogICAgICAgICAgICBhX2IgPSB0cnVlDQogICAgICAgICAgZW5kDQogICAgICAgIGVsc2UNCiAgICAgICAgICBhX2IgPSB0cnVlDQogICAgICAgIGVuZA0KICAgICAgZWxzZQ0KICAgICAgICBhX2IgPSB0cnVlDQogICAgICBlbmQNCiAgICBlbHNlDQogICAgICBhX2IgPSB0cnVlDQogICAgZW5kDQogICAgaWYgYV9iIHRoZW4NCiAgICAgIHRhYmxlLnJlbW92ZShhY3RpdmVNaW5pb25zQXR0YWNrcywgZGRhKQ0KICAgIGVuZA0KICBlbmQNCmVuZA0KZnVuY3Rpb24gT25Qcm9jZXNzU3BlbGwoZGRhLCBfX2IpDQogIGlmIGRkYSBhbmQgZGRhLnR5cGUgYW5kIGRkYS50eXBlID09IG15SGVyby50eXBlIGFuZCBkZGEudGVhbSBhbmQgZGRhLnRlYW0gfj0gbXlIZXJvLnRlYW0gYW5kIF9fYiBhbmQgX19iLm5hbWUgYW5kIF9fYi5uYW1lOmxvd2VyKCk6ZmluZCgiYXR0YWNrIikgdGhlbg0KICAgIEJhc2VBbmltYXRpb25UaW1lW2RkYS5uZXR3b3JrSURdID0gMSAvIChfX2IuYW5pbWF0aW9uVGltZSAqIGRkYS5hdHRhY2tTcGVlZCkNCiAgICBCYXNlV2luZFVwVGltZVtkZGEubmV0d29ya0lEXSA9IDEgLyAoX19iLndpbmRVcFRpbWUgKiBkZGEuYXR0YWNrU3BlZWQpDQogIGVuZA0KICBpZiBkZGEgYW5kIGRkYS50eXBlIGFuZCBkZGEudHlwZSA9PSAib2JqX0FJX1R1cnJldCIgYW5kIF9fYiBhbmQgX19iLnRhcmdldCBhbmQgX19iLnRhcmdldC5pc01lIHRoZW4NCiAgICB0dXJyZXRGb2N1cy5mb2N1c2VkID0gdHJ1ZQ0KICAgIHR1cnJldEZvY3VzLnN0YXJ0VCA9IG9zLmNsb2NrKCkNCiAgICB0dXJyZXRGb2N1cy50dXJyZXQgPSBkZGENCiAgICB0dXJyZXRGb2N1cy5zcGVsbCA9IF9fYg0KICBlbmQNCiAgaWYgZGRhIGFuZCBkZGEudHlwZSBhbmQgZGRhLnR5cGUgPT0gIm9ial9BSV9NaW5pb24iIGFuZCBkZGEudGVhbSB+PSBteUhlcm8udGVhbSBhbmQgX19iIGFuZCBfX2IudGFyZ2V0IGFuZCBfX2IudGFyZ2V0LmlzTWUgdGhlbg0KICAgIGZvciBhX2IsIGJfYiBpbiBwYWlycyhhY3RpdmVNaW5pb25zQXR0YWNrcykgZG8NCiAgICAgIGlmIGJfYiBhbmQgYl9iLm1pbmlvbiBhbmQgYl9iLm1pbmlvbi5uZXR3b3JrSUQgYW5kIGJfYi5taW5pb24ubmV0d29ya0lEID09IGRkYS5uZXR3b3JrSUQgdGhlbg0KICAgICAgICB0YWJsZS5yZW1vdmUoYWN0aXZlTWluaW9uc0F0dGFja3MsIGFfYikNCiAgICAgIGVuZA0KICAgIGVuZA0KICAgIHRhYmxlLmluc2VydChhY3RpdmVNaW5pb25zQXR0YWNrcywgew0KICAgICAgbWluaW9uID0gZGRhLA0KICAgICAgc3RhcnRUID0gb3MuY2xvY2soKSwNCiAgICAgIHNwZWxsID0gX19iDQogICAgfSkNCiAgZW5kDQogIGlmIGRkYSBhbmQgZGRhLnR5cGUgYW5kIGRkYS50eXBlID09IG15SGVyby50eXBlIGFuZCBkZGEudGVhbSBhbmQgZGRhLnRlYW0gfj0gbXlIZXJvLnRlYW0gYW5kIF9fYiBhbmQgX19iLm5hbWUgYW5kIF9fYi50YXJnZXQgYW5kIF9fYi50YXJnZXQuaXNNZSBhbmQgX19iLm5hbWUgPT0gInN1bW1vbmVyZG90IiB0aGVuDQogICAgaWYgZ2V0RG1nKCJJR05JVEUiLCBteUhlcm8sIGRkYSkgPj0gbXlIZXJvLmhlYWx0aCB0aGVuDQogICAgICBTYXkoZGRhLmNoYXJOYW1lIC4uICIgaWduaXRlZCBtZS4gSWduaXRlIFdJTEwga2lsbCBtZS4iKQ0KICAgICAgaWduaXRlZFRhYmxlLmhhc1NhaWQgPSB0cnVlDQogICAgICBpZ25pdGVkVGFibGUud2lsbEtpbGxNZSA9IHRydWUNCiAgICBlbHNlDQogICAgICBTYXkoZGRhLmNoYXJOYW1lIC4uICIgaWduaXRlZCBtZS4gSSB3aWxsIHN1cnZpdmUuIikNCiAgICBlbmQNCiAgICBpZ25pdGVkVGFibGUuaWduaXRlZCA9IHRydWUNCiAgICBpZ25pdGVkVGFibGUuc291cmNlID0gZGRhDQogICAgaWduaXRlZFRhYmxlLnRpbWUgPSBvcy5jbG9jaygpDQogIGVuZA0KICBpZiBkZGEgYW5kIGRkYS5pc01lIGFuZCBfX2IgYW5kIF9fYi5uYW1lIGFuZCBub3QgX19iLm5hbWU6bG93ZXIoKTpmaW5kKCJhdHRhY2siKSB0aGVuDQogICAgaWYgX19iLm5hbWUgPT0gU3BlbGxzLkUuc3BlbGxuYW1lIG9yIF9fYi5uYW1lID09IFNwZWxscy5SLkVuYW1lIHRoZW4NCiAgICAgIGlDYXN0ZWRFVGltZSA9IG9zLmNsb2NrKCkNCiAgICBlbmQNCiAgICBpZiAoY2FuQ2FzdFNwZWxscyA9PSBmYWxzZSBvciBSU2tpbGwgfj0gbmlsIG9yIGNhbkNhc3RTcGVsbHMgPT0gZmFsc2UgYW5kIFJTa2lsbCB+PSBuaWwpIGFuZCByU3BlbGxOYW1lW19fYi5uYW1lXSB+PSBuaWwgdGhlbg0KICAgICAgY2FuQ2FzdFNwZWxscyA9IHRydWUNCiAgICAgIFJTa2lsbCA9IG5pbA0KICAgICAgUlNraWxsUG9zID0gbmlsDQogICAgZW5kDQogICAgaWYgX19iLnRhcmdldCBhbmQgX19iLnRhcmdldC50eXBlIGFuZCBfX2IudGFyZ2V0LnR5cGUgPT0gbXlIZXJvLnR5cGUgYW5kIF9fYi50YXJnZXQudGVhbSB+PSBteUhlcm8udGVhbSBhbmQgX19iLnRhcmdldC5oZWFsdGggdGhlbg0KICAgICAgaWYgX19iLm5hbWUgPT0gU3BlbGxzLlEuc3BlbGxuYW1lIGFuZCBTcGVsbERtZ0NhbGN1bGF0aW9ucygiUSIsIF9fYi50YXJnZXQpID49IF9fYi50YXJnZXQuaGVhbHRoIHRoZW4NCiAgICAgICAgaXNLaWxsZWRbX19iLnRhcmdldC5uZXR3b3JrSURdID0gdHJ1ZQ0KICAgICAgZWxzZWlmIF9fYi5uYW1lID09IFNwZWxscy5RLnNwZWxsbmFtZSBhbmQgZW5lbWllc0J1ZmZzW19fYi50YXJnZXQubmV0d29ya0lEXS5yZWNlaXZlZCA9PSB0cnVlIGFuZCBTcGVsbERtZ0NhbGN1bGF0aW9ucygiUSIsIF9fYi50YXJnZXQpICsgU3BlbGxEbWdDYWxjdWxhdGlvbnMoIlFQcm9jIiwgX19iLnRhcmdldCkgPj0gX19iLnRhcmdldC5oZWFsdGggdGhlbg0KICAgICAgICBpc0tpbGxlZFtfX2IudGFyZ2V0Lm5ldHdvcmtJRF0gPSB0cnVlDQogICAgICBlbHNlaWYgX19iLm5hbWUgPT0gU3BlbGxzLlIuUW5hbWUgYW5kIFNwZWxsRG1nQ2FsY3VsYXRpb25zKCJSUSIsIF9fYi50YXJnZXQpID49IF9fYi50YXJnZXQuaGVhbHRoIHRoZW4NCiAgICAgICAgaXNLaWxsZWRbX19iLnRhcmdldC5uZXR3b3JrSURdID0gdHJ1ZQ0KICAgICAgZWxzZWlmIF9fYi5uYW1lID09IFNwZWxscy5SLlFuYW1lIGFuZCBlbmVtaWVzQnVmZnNbX19iLnRhcmdldC5uZXR3b3JrSURdLnJlY2VpdmVkID09IHRydWUgYW5kIFNwZWxsRG1nQ2FsY3VsYXRpb25zKCJSUSIsIF9fYi50YXJnZXQpICsgU3BlbGxEbWdDYWxjdWxhdGlvbnMoIlFQcm9jIiwgX19iLnRhcmdldCkgPj0gX19iLnRhcmdldC5oZWFsdGggdGhlbg0KICAgICAgICBpc0tpbGxlZFtfX2IudGFyZ2V0Lm5ldHdvcmtJRF0gPSB0cnVlDQogICAgICBlbmQNCiAgICBlbmQNCiAgICBpZiB0YXJnZXQgYW5kIF9fYi5uYW1lID09IFNwZWxscy5XLnNwZWxsbmFtZSBhbmQgX19iLmVuZFBvcyBhbmQgR2V0RGlzdGFuY2UodGFyZ2V0LCBfX2IuZW5kUG9zKSA8PSBTcGVsbHMuVy5yYWRpdXMgLSA1MCBhbmQgU3BlbGxEbWdDYWxjdWxhdGlvbnMoIlciLCBfX2IudGFyZ2V0KSA+PSB0YXJnZXQuaGVhbHRoIHRoZW4NCiAgICAgIGlzS2lsbGVkW3RhcmdldC5uZXR3b3JrSURdID0gdHJ1ZQ0KICAgIGVuZA0KICAgIGlmIChfX2IubmFtZSA9PSBTcGVsbHMuUS5zcGVsbG5hbWUgb3IgX19iLm5hbWUgPT0gU3BlbGxzLlIuUW5hbWUpIGFuZCBXcmVhZHkgYW5kIHRhcmdldCBhbmQgX19iLnRhcmdldCBhbmQgX19iLnRhcmdldC5uZXR3b3JrSUQgYW5kIF9fYi50YXJnZXQubmV0d29ya0lEID09IHRhcmdldC5uZXR3b3JrSUQgdGhlbg0KICAgICAgbG9jYWwgYV9iID0gR2V0V1ByZWRpY3Rpb24odGFyZ2V0KQ0KICAgICAgaWYgYV9iIH49IG5pbCB0aGVuDQogICAgICAgIGxvY2FsIGJfYiA9IG9zLmNsb2NrKCkNCiAgICAgICAgbG9jYWwgY19iID0gU3BlbGxzLlEuZGVsYXkNCiAgICAgICAgbG9jYWwgZF9iID0gR2V0RGlzdGFuY2UodGFyZ2V0KQ0KICAgICAgICBsb2NhbCBfYWIgPSBTcGVsbHMuUS5zcGVlZA0KICAgICAgICBsb2NhbCBhYWIgPSBkX2IgLyBfYWIgKyBjX2INCiAgICAgICAgbG9jYWwgYmFiID0gYl9iICsgYWFiDQogICAgICAgIGxhc3RRQ2FzdCA9IHsNCiAgICAgICAgICB0YXJnZXQgPSBfX2IudGFyZ2V0LA0KICAgICAgICAgIGVuZFQgPSBiYWINCiAgICAgICAgfQ0KICAgICAgZW5kDQogICAgZW5kDQogICAgaWYgX19iLm5hbWUgPT0gU3BlbGxzLlcuc3BlbGxuYW1lIHRoZW4NCiAgICAgIFNwZWxscy5XLnN0YXJ0UG9zID0gX19iLnN0YXJ0UG9zDQogICAgICBpZiBNZW51LmtleXNldHRpbmdzLnVzZUhhcmFzcyB0aGVuDQogICAgICAgIGNhc3RlZFdUaHJvdWdoSGFyYXNzLmJvb2wgPSB0cnVlDQogICAgICAgIGNhc3RlZFdUaHJvdWdoSGFyYXNzLnRpbWUgPSBvcy5jbG9jaygpDQogICAgICBlbmQNCiAgICBlbHNlaWYgX19iLm5hbWUgPT0gU3BlbGxzLldSLnNwZWxsbmFtZSB0aGVuDQogICAgICBTcGVsbHMuV1Iuc3RhcnRQb3MgPSBfX2Iuc3RhcnRQb3MNCiAgICBlbmQNCiAgICBpZiBfX2IubmFtZSA9PSBTcGVsbHMuUS5zcGVsbG5hbWUgb3IgX19iLm5hbWUgPT0gU3BlbGxzLlcuc3BlbGxuYW1lIG9yIF9fYi5uYW1lID09IFNwZWxscy5FLnNwZWxsbmFtZSB0aGVuDQogICAgICBsYXN0QWN0aXZhdGVkID0gX19iLm5hbWUNCiAgICBlbmQNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIENvbWJvKCkNCiAgaWYgbXlIZXJvLmRlYWQgdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgaWYgbm90IHRhcmdldCB0aGVuDQogICAgcmV0dXJuDQogIGVuZA0KICBpZiB0YXJnZXQgfj0gbmlsIGFuZCBWYWxpZFRhcmdldCh0YXJnZXQsIDE1MDApIHRoZW4NCiAgICBpZiB0YXJnZXQgYW5kIG5vdCB0YXJnZXQudHlwZSB0aGVuDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBpZiB0YXJnZXQgYW5kIG5vdCB0YXJnZXQubmV0d29ya0lEIHRoZW4NCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIGlzS2lsbGVkW3RhcmdldC5uZXR3b3JrSURdIHRoZW4NCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIElnbml0ZVdpbGxLaWxsRW5lbXkodGFyZ2V0KSB0aGVuDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBpZiBNZW51LmNvbWJvLmNvbWJvSXRlbXMgdGhlbg0KICAgICAgVXNlSXRlbXModGFyZ2V0KQ0KICAgIGVuZA0KICAgIGlmIChjYW5DYXN0U3BlbGxzID09IGZhbHNlIG9yIFJTa2lsbCB+PSBuaWwpIGFuZCBSU2tpbGxUaW1lICsgMS41IDwgb3MuY2xvY2soKSB0aGVuDQogICAgICBjYW5DYXN0U3BlbGxzID0gdHJ1ZQ0KICAgICAgUlNraWxsID0gbmlsDQogICAgICBSU2tpbGxQb3MgPSBuaWwNCiAgICBlbmQNCiAgICBpZiBub3QgUnJlYWR5IGFuZCAoY2FuQ2FzdFNwZWxscyA9PSBmYWxzZSBvciBSU2tpbGwgfj0gbmlsKSB0aGVuDQogICAgICBSU2tpbGwgPSBuaWwNCiAgICAgIGNhbkNhc3RTcGVsbHMgPSB0cnVlDQogICAgICBSU2tpbGxQb3MgPSBuaWwNCiAgICBlbmQNCiAgICBpZiBScmVhZHkgYW5kIG5vdCBjYW5DYXN0U3BlbGxzIGFuZCBSU2tpbGwgfj0gbmlsIHRoZW4NCiAgICAgIGlmIFJTa2lsbCA9PSAiUSIgdGhlbg0KICAgICAgICBpZiBSU3RhdGUoIlEiKSB0aGVuDQogICAgICAgICAgQ2FzdFJRKHRhcmdldCkNCiAgICAgICAgZWxzZWlmIFFyZWFkeSB0aGVuDQogICAgICAgICAgaWYgQ2FzdFEodGFyZ2V0KSB0aGVuDQogICAgICAgICAgICBDYXN0UlEodGFyZ2V0KQ0KICAgICAgICAgIGVuZA0KICAgICAgICBlbHNlaWYgbm90IFFyZWFkeSBhbmQgbm90IFJTdGF0ZSgiUSIpIG9yIG5vdCBScmVhZHkgdGhlbg0KICAgICAgICAgIGNhbkNhc3RTcGVsbHMgPSB0cnVlDQogICAgICAgICAgUlNraWxsID0gbmlsDQogICAgICAgIGVuZA0KICAgICAgZWxzZWlmIFJTa2lsbCA9PSAiVyIgdGhlbg0KICAgICAgICBpZiBSU3RhdGUoIlciKSB0aGVuDQogICAgICAgICAgaWYgUlNraWxsUG9zIHRoZW4NCiAgICAgICAgICAgIENhc3RSVyhSU2tpbGxQb3MueCwgUlNraWxsUG9zLnopDQogICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgQ2FzdFJXKHRhcmdldCkNCiAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZWlmIElzV1JlYWR5KCkgdGhlbg0KICAgICAgICAgIGlmIFJTa2lsbFBvcyB0aGVuDQogICAgICAgICAgICBpZiBDYXN0VyhSU2tpbGxQb3MueCwgUlNraWxsUG9zLnopIHRoZW4NCiAgICAgICAgICAgICAgQ2FzdFJXKFJTa2lsbFBvcy54LCBSU2tpbGxQb3MueikNCiAgICAgICAgICAgIGVuZA0KICAgICAgICAgIGVsc2VpZiBDYXN0Vyh0YXJnZXQpIHRoZW4NCiAgICAgICAgICAgIENhc3RSVyh0YXJnZXQpDQogICAgICAgICAgZW5kDQogICAgICAgIGVsc2VpZiBub3QgUlN0YXRlKCJXIikgYW5kIG5vdCBXcmVhZHkgb3Igbm90IFJyZWFkeSB0aGVuDQogICAgICAgICAgY2FuQ2FzdFNwZWxscyA9IHRydWUNCiAgICAgICAgICBSU2tpbGwgPSBuaWwNCiAgICAgICAgICBSU2tpbGxQb3MgPSBuaWwNCiAgICAgICAgZW5kDQogICAgICBlbHNlaWYgUlNraWxsID09ICJFIiB0aGVuDQogICAgICAgIGlmIFJTdGF0ZSgiRSIpIHRoZW4NCiAgICAgICAgICBDYXN0UkUodGFyZ2V0KQ0KICAgICAgICBlbHNlaWYgRXJlYWR5IHRoZW4NCiAgICAgICAgICBpZiBDYXN0RSh0YXJnZXQpIHRoZW4NCiAgICAgICAgICAgIENhc3RSRSh0YXJnZXQpDQogICAgICAgICAgZW5kDQogICAgICAgIGVsc2VpZiBub3QgUlN0YXRlKCJFIikgYW5kIG5vdCBFcmVhZHkgb3Igbm90IFJyZWFkeSB0aGVuDQogICAgICAgICAgY2FuQ2FzdFNwZWxscyA9IHRydWUNCiAgICAgICAgICBSU2tpbGwgPSBuaWwNCiAgICAgICAgZW5kDQogICAgICBlbmQNCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIG5vdCBjYW5DYXN0U3BlbGxzIGFuZCBSU2tpbGwgfj0gbmlsIHRoZW4NCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIE1lbnUua2V5c2V0dGluZ3MudXNlQ29tYm8gdGhlbg0KICAgICAgUGVyZm9ybU5vcm1hbFNtYXJ0Q29tYm8odGFyZ2V0KQ0KICAgIGVsc2VpZiBNZW51LmtleXNldHRpbmdzLnVzZUNvbWJvR2FwQ2xvc2UgdGhlbg0KICAgICAgU21hcnRHYXBDbG9zZUNvbWJvKHRhcmdldCkNCiAgICBlbHNlaWYgTWVudS5rZXlzZXR0aW5ncy51c2VDb21ib0NoYWluIHRoZW4NCiAgICAgIFNtYXJ0Q2hhaW5Db21ibyh0YXJnZXQpDQogICAgZW5kDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBQZXJmb3JtTm9ybWFsU21hcnRDb21ibyhkZGEpDQogIGlmIE1lbnUuY29tYm8uY29tYm9XYXkgPT0gMSB0aGVuDQogICAgU21hcnRDb21ibyhkZGEpDQogIGVsc2VpZiBNZW51LmNvbWJvLmNvbWJvV2F5ID09IDIgdGhlbg0KICAgIENvbWJvUVJXRShkZGEpDQogIGVsc2VpZiBNZW51LmNvbWJvLmNvbWJvV2F5ID09IDMgdGhlbg0KICAgIENvbWJvUVdSRShkZGEpDQogIGVsc2VpZiBNZW51LmNvbWJvLmNvbWJvV2F5ID09IDQgdGhlbg0KICAgIENvbWJvV1FSRShkZGEpDQogIGVsc2VpZiBNZW51LmNvbWJvLmNvbWJvV2F5ID09IDUgdGhlbg0KICAgIENvbWJvV1JRRShkZGEpDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBTbWFydEdhcENsb3NlQ29tYm8oZGRhKQ0KICBpZiBub3QgZGRhIHRoZW4NCiAgICByZXR1cm4NCiAgZW5kDQogIGlmIGRkYSBhbmQgbm90IGRkYS50eXBlIHRoZW4NCiAgICByZXR1cm4NCiAgZW5kDQogIGlmIGRkYSBhbmQgbm90IGRkYS5uZXR3b3JrSUQgdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgaWYgaXNLaWxsZWRbZGRhLm5ldHdvcmtJRF0gdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgaWYgSWduaXRlV2lsbEtpbGxFbmVteShkZGEpIHRoZW4NCiAgICByZXR1cm4NCiAgZW5kDQogIGlmIEdldERpc3RhbmNlU3FyKGRkYSkgPj0gU3BlbGxzLlcucmFuZ2VTcXIgYW5kIEdldERpc3RhbmNlKGRkYSkgPD0gU3BlbGxzLlcucmFuZ2UgKyBTcGVsbHMuUS5yYW5nZSB0aGVuDQogICAgaWYgR2FwQ2xvc2UoZGRhKSB0aGVuDQogICAgICBnYXBDbG9zZVNldHRpbmdzLnRpbWUgPSBvcy5jbG9jaygpDQogICAgZW5kDQogIGVsc2UNCiAgICBQZXJmb3JtTm9ybWFsU21hcnRDb21ibyhkZGEpDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBTbWFydENoYWluQ29tYm8oZGRhKQ0KICBpZiBub3QgZGRhIHRoZW4NCiAgICByZXR1cm4NCiAgZW5kDQogIGlmIGRkYSBhbmQgbm90IGRkYS50eXBlIHRoZW4NCiAgICByZXR1cm4NCiAgZW5kDQogIGlmIGRkYSBhbmQgbm90IGRkYS5uZXR3b3JrSUQgdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgaWYgaXNLaWxsZWRbZGRhLm5ldHdvcmtJRF0gdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgaWYgSWduaXRlV2lsbEtpbGxFbmVteShkZGEpIHRoZW4NCiAgICByZXR1cm4NCiAgZW5kDQogIGlmIEVyZWFkeSBhbmQgUnJlYWR5IHRoZW4NCiAgICBpZiBEb3VibGVDaGFpbkNoZWNrKGRkYSkgYW5kIENhc3RFKGRkYSkgdGhlbg0KICAgICAgcmV0dXJuDQogICAgZW5kDQogICAgaWYgRG91YmxlQ2hhaW5DaGVjayhkZGEpIGFuZCBDYXN0UkUoZGRhKSB0aGVuDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgZWxzZWlmIGNoYWluVGFyZ2V0IGFuZCBScmVhZHkgYW5kIFJTdGF0ZSgiRSIpIHRoZW4NCiAgICBpZiBEb3VibGVDaGFpbkNoZWNrKGNoYWluVGFyZ2V0KSB0aGVuDQogICAgICBDYXN0UkUoY2hhaW5UYXJnZXQpDQogICAgZW5kDQogIGVsc2VpZiBjaGFpblRhcmdldCBhbmQgRXJlYWR5IHRoZW4NCiAgICBpZiBEb3VibGVDaGFpbkNoZWNrKGNoYWluVGFyZ2V0KSB0aGVuDQogICAgICBDYXN0RShjaGFpblRhcmdldCkNCiAgICBlbmQNCiAgZWxzZWlmIEVyZWFkeSBhbmQgbm90IFJyZWFkeSB0aGVuDQogICAgaWYgRG91YmxlQ2hhaW5DaGVjayhkZGEpIHRoZW4NCiAgICAgIENhc3RFKGRkYSkNCiAgICBlbmQNCiAgZWxzZWlmIFJyZWFkeSBhbmQgbm90IEVyZWFkeSBhbmQgUlN0YXRlKCJFIikgdGhlbg0KICAgIGlmIERvdWJsZUNoYWluQ2hlY2soZGRhKSB0aGVuDQogICAgICBDYXN0UkUoZGRhKQ0KICAgIGVuZA0KICBlbHNlaWYgRXJlYWR5IGFuZCBTcGVsbEFib3V0VG9Db21lVXAoX1IpIG9yIFJyZWFkeSBhbmQgU3BlbGxBYm91dFRvQ29tZVVwKF9FKSB0aGVuDQogICAgQ2FzdFEoZGRhKQ0KICAgIENhc3RXKGRkYSkNCiAgZWxzZWlmIG5vdCBTcGVsbEFib3V0VG9Db21lVXAoX0UpIHRoZW4NCiAgICBQZXJmb3JtTm9ybWFsU21hcnRDb21ibyhkZGEpDQogIGVsc2UNCiAgICBDYXN0UShkZGEpDQogICAgQ2FzdFJRKGRkYSkNCiAgICBpZiBub3QgUXJlYWR5IGFuZCAobm90IFJyZWFkeSBvciBub3QgUlN0YXRlKCJRIikpIHRoZW4NCiAgICAgIENhc3RXKGRkYSkNCiAgICBlbmQNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIERvdWJsZUNoYWluQ2hlY2soZGRhKQ0KICBpZiBub3QgZGRhIHRoZW4NCiAgICByZXR1cm4gdHJ1ZQ0KICBlbmQNCiAgaWYgZGRhIGFuZCBub3QgZGRhLnR5cGUgdGhlbg0KICAgIHJldHVybiB0cnVlDQogIGVuZA0KICBpZiBpQ2FzdGVkRVRpbWUgKyAwLjUgPiBvcy5jbG9jaygpIHRoZW4NCiAgICByZXR1cm4gZmFsc2UNCiAgZW5kDQogIGlmIGlDYXN0ZWRFVGltZSArIDEuNSA+IG9zLmNsb2NrKCkgYW5kIG5vdCBjaGFpblRhcmdldCB0aGVuDQogICAgcmV0dXJuIHRydWUNCiAgZW5kDQogIGlmIGNoYWluVGFyZ2V0IGFuZCBjaGFpblRhcmdldC5uZXR3b3JrSUQgYW5kIGNoYWluVGFyZ2V0Lm5ldHdvcmtJRCA9PSBkZGEubmV0d29ya0lEIHRoZW4NCiAgICBsb2NhbCBfX2IgPSBHZXREaXN0YW5jZShkZGEpIC8gU3BlbGxzLkUuc3BlZWQgKyBTcGVsbHMuRS5kZWxheQ0KICAgIGlmIGNhc3RlZEVUaW1lICsgKDIuOCAtIF9fYikgPiBvcy5jbG9jaygpIHRoZW4NCiAgICAgIHJldHVybiBmYWxzZQ0KICAgIGVuZA0KICBlbmQNCiAgcmV0dXJuIHRydWUNCmVuZA0KZnVuY3Rpb24gQ29tYm9RUldFKGRkYSkNCiAgaWYgUXJlYWR5IGFuZCBScmVhZHkgYW5kIEdldERpc3RhbmNlKGRkYSkgPD0gU3BlbGxzLlEucmFuZ2UgdGhlbg0KICAgIGlmIENhc3RRKGRkYSkgdGhlbg0KICAgICAgY2FuQ2FzdFNwZWxscyA9IGZhbHNlDQogICAgICBSU2tpbGwgPSAiUSINCiAgICAgIFJTa2lsbFRpbWUgPSBvcy5jbG9jaygpDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgZWxzZWlmIFFyZWFkeSBhbmQgbm90IFJyZWFkeSB0aGVuDQogICAgQ2FzdFEoZGRhKQ0KICBlbHNlaWYgUnJlYWR5IGFuZCBub3QgUXJlYWR5IGFuZCBSU3RhdGUoIlEiKSB0aGVuDQogICAgQ2FzdFJRKGRkYSkNCiAgZWxzZWlmIG5vdCBRcmVhZHkgYW5kIChub3QgUnJlYWR5IG9yIG5vdCBSU3RhdGUoIlEiKSkgdGhlbg0KICAgIGlmIElzV1JlYWR5KCkgdGhlbg0KICAgICAgQ2FzdFcoZGRhKQ0KICAgIGVuZA0KICAgIENhc3RFKGRkYSkNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIENvbWJvUVdSRShkZGEpDQogIGlmIFFyZWFkeSBhbmQgbm90IFJTdGF0ZSgiVyIpIHRoZW4NCiAgICBDYXN0UShkZGEpDQogIGVsc2VpZiBJc1dSZWFkeSgpIGFuZCBScmVhZHkgYW5kIG5vdCB3clVzZWQoKSBhbmQgR2V0RGlzdGFuY2VTcXIoZGRhKSA8PSBTcGVsbHMuVy5yYW5nZVNxciB0aGVuDQogICAgaWYgQ2FzdFcoZGRhKSB0aGVuDQogICAgICBjYW5DYXN0U3BlbGxzID0gZmFsc2UNCiAgICAgIFJTa2lsbCA9ICJXIg0KICAgICAgUlNraWxsVGltZSA9IG9zLmNsb2NrKCkNCiAgICAgIHJldHVybg0KICAgIGVuZA0KICBlbHNlaWYgSXNXUmVhZHkoKSBhbmQgbm90IFJyZWFkeSBhbmQgbm90IHdVc2VkKCkgdGhlbg0KICAgIENhc3RXKGRkYSkNCiAgZWxzZWlmIFJyZWFkeSBhbmQgUlN0YXRlKCJXIikgYW5kIEdldERpc3RhbmNlU3FyKGRkYSkgPD0gU3BlbGxzLlcucmFuZ2VTcXIgYW5kIG5vdCB3clVzZWQoKSB0aGVuDQogICAgY2FuQ2FzdFNwZWxscyA9IGZhbHNlDQogICAgUlNraWxsID0gIlciDQogICAgUlNraWxsVGltZSA9IG9zLmNsb2NrKCkNCiAgICByZXR1cm4NCiAgZWxzZWlmIG5vdCBRcmVhZHkgYW5kIG5vdCBJc1dSZWFkeSgpIGFuZCAobm90IFJyZWFkeSBvciBub3QgUlN0YXRlKCJXIikpIHRoZW4NCiAgICBDYXN0RShkZGEpDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBDb21ib1dRUkUoZGRhKQ0KICBpZiBJc1dSZWFkeSgpIHRoZW4NCiAgICBDYXN0VyhkZGEpDQogIGVsc2VpZiBRcmVhZHkgYW5kIFJyZWFkeSBhbmQgR2V0RGlzdGFuY2UoZGRhKSA8PSBTcGVsbHMuUS5yYW5nZSBhbmQgbm90IElzV1JlYWR5KCkgdGhlbg0KICAgIGlmIENhc3RRKGRkYSkgdGhlbg0KICAgICAgY2FuQ2FzdFNwZWxscyA9IGZhbHNlDQogICAgICBSU2tpbGwgPSAiUSINCiAgICAgIFJTa2lsbFRpbWUgPSBvcy5jbG9jaygpDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgZWxzZWlmIFFyZWFkeSBhbmQgbm90IFJyZWFkeSBhbmQgbm90IElzV1JlYWR5KCkgdGhlbg0KICAgIENhc3RRKGRkYSkNCiAgZWxzZWlmIFJyZWFkeSBhbmQgbm90IFFyZWFkeSBhbmQgUlN0YXRlKCJRIikgdGhlbg0KICAgIENhc3RSUShkZGEpDQogIGVsc2VpZiBub3QgSXNXUmVhZHkoKSBhbmQgbm90IFFyZWFkeSBhbmQgKG5vdCBScmVhZHkgb3Igbm90IFJTdGF0ZSgiUSIpKSB0aGVuDQogICAgQ2FzdEUoZGRhKQ0KICBlbmQNCmVuZA0KZnVuY3Rpb24gQ29tYm9XUlFFKGRkYSkNCiAgaWYgbm90IHdyVXNlZCgpIGFuZCBJc1dSZWFkeSgpIGFuZCBScmVhZHkgdGhlbg0KICAgIGlmIENhc3RXKGRkYSkgdGhlbg0KICAgICAgY2FuQ2FzdFNwZWxscyA9IGZhbHNlDQogICAgICBSU2tpbGwgPSAiVyINCiAgICAgIFJTa2lsbFRpbWUgPSBvcy5jbG9jaygpDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgZWxzZWlmIG5vdCBScmVhZHkgYW5kIElzV1JlYWR5KCkgdGhlbg0KICAgIENhc3RXKGRkYSkNCiAgZWxzZWlmIG5vdCB3clVzZWQoKSBhbmQgUnJlYWR5IGFuZCBub3QgSXNXUmVhZHkoKSBhbmQgUlN0YXRlKCJXIikgdGhlbg0KICAgIGNhbkNhc3RTcGVsbHMgPSBmYWxzZQ0KICAgIFJTa2lsbCA9ICJXIg0KICAgIFJTa2lsbFRpbWUgPSBvcy5jbG9jaygpDQogICAgcmV0dXJuDQogIGVsc2VpZiBub3QgSXNXUmVhZHkoKSBhbmQgKG5vdCBScmVhZHkgb3Igd3JVc2VkKCkgb3Igbm90IFJTdGF0ZSgiVyIpKSB0aGVuDQogICAgQ2FzdFEoZGRhKQ0KICAgIENhc3RFKGRkYSkNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIENoZWNrU3R1bm5lZCgpDQogIGxvY2FsIGRkYSA9IDANCiAgbG9jYWwgX19iID0ge30NCiAgbG9jYWwgYV9iDQogIGZvciBiX2IsIGNfYiBpbiBwYWlycyhHZXRFbmVteUhlcm9lcygpKSBkbw0KICAgIGlmIGNfYiBhbmQgaXNTdHVubmVkW2NfYi5uZXR3b3JrSURdIGFuZCBHZXREaXN0YW5jZVNxcihjX2IpIDw9IFNwZWxscy5XLnJhbmdlU3FyIHRoZW4NCiAgICAgIGRkYSA9IGRkYSArIDENCiAgICAgIHRhYmxlLmluc2VydChfX2IsIGNfYikNCiAgICBlbmQNCiAgZW5kDQogIGlmIF9fYiB0aGVuDQogICAgYV9iID0gR2V0Q2VudGVyKF9fYikNCiAgZW5kDQogIHJldHVybiBkZGEgPiAzLCBhX2INCmVuZA0KZnVuY3Rpb24gR2V0Q2VudGVyKGRkYSkNCiAgbG9jYWwgX19iID0gMA0KICBsb2NhbCBhX2IgPSAwDQogIGZvciBpID0gMSwgI2RkYSBkbw0KICAgIF9fYiA9IF9fYiArIGRkYVtpXS54DQogICAgYV9iID0gYV9iICsgZGRhW2ldLnoNCiAgZW5kDQogIGxvY2FsIGJfYiA9IHsNCiAgICB4ID0gX19iIC8gI2RkYSwNCiAgICB5ID0gMCwNCiAgICB6ID0gYV9iIC8gI2RkYQ0KICB9DQogIHJldHVybiBiX2INCmVuZA0KZnVuY3Rpb24gU21hcnRDb21ibyhkZGEpDQogIGlmIG5vdCBkZGEgdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgaWYgZGRhIGFuZCBub3QgZGRhLnR5cGUgdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgaWYgZGRhIGFuZCBub3QgZGRhLm5ldHdvcmtJRCB0aGVuDQogICAgcmV0dXJuDQogIGVuZA0KICBpZiBpc0tpbGxlZFtkZGEubmV0d29ya0lEXSB0aGVuDQogICAgcmV0dXJuDQogIGVuZA0KICBpZiBJZ25pdGVXaWxsS2lsbEVuZW15KGRkYSkgdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgbG9jYWwgX19iLCBhX2IgPSBDaGVja1N0dW5uZWQoKQ0KICBpZiBfX2IgYW5kIGFfYiBhbmQgKFdyZWFkeSBvciBScmVhZHkpIHRoZW4NCiAgICBpZiBXcmVhZHkgYW5kIFJyZWFkeSB0aGVuDQogICAgICBpZiBDYXN0VyhhX2IueCwgYV9iLnopIHRoZW4NCiAgICAgICAgY2FuQ2FzdFNwZWxscyA9IGZhbHNlDQogICAgICAgIFJTa2lsbCA9ICJXIg0KICAgICAgICBSU2tpbGxUaW1lID0gb3MuY2xvY2soKQ0KICAgICAgICBSU2tpbGxQb3MgPSBhX2INCiAgICAgICAgcmV0dXJuDQogICAgICBlbmQNCiAgICBlbHNlaWYgV3JlYWR5IHRoZW4NCiAgICAgIENhc3RXKGFfYi54LCBhX2IueikNCiAgICBlbHNlaWYgUnJlYWR5IGFuZCBSU3RhdGUoIlciKSB0aGVuDQogICAgICBjYW5DYXN0U3BlbGxzID0gZmFsc2UNCiAgICAgIFJTa2lsbCA9ICJXIg0KICAgICAgUlNraWxsVGltZSA9IG9zLmNsb2NrKCkNCiAgICAgIFJTa2lsbFBvcyA9IGFfYg0KICAgICAgcmV0dXJuDQogICAgZW5kDQogIGVuZA0KICBsb2NhbCBiX2IsIGNfYiwgZF9iID0gUmV0dXJuQmVzdFRhcmdldFBvc2l0aW9uKDMsIFNwZWxscy5XLnJhbmdlKQ0KICBpZiBiX2Igfj0gbmlsIGFuZCBjX2Igfj0gbmlsIGFuZCBHZXREaXN0YW5jZVNxcihiX2IpIDwgU3BlbGxzLlcucmFuZ2VTcXIgYW5kIG5vdCB3clVzZWQoKSBhbmQgSXNXUmVhZHkoKSBhbmQgUnJlYWR5IGFuZCBkX2IgPj0gMyBhbmQgQ2FzdFcoYl9iLngsIGJfYi56KSB0aGVuDQogICAgY2FuQ2FzdFNwZWxscyA9IGZhbHNlDQogICAgUlNraWxsID0gIlciDQogICAgUlNraWxsVGltZSA9IG9zLmNsb2NrKCkNCiAgICByZXR1cm4NCiAgZW5kDQogIGxvY2FsIF9hYiA9IFNwZWxsRG1nQ2FsY3VsYXRpb25zKCJRIiwgZGRhKQ0KICBsb2NhbCBhYWIgPSBTcGVsbERtZ0NhbGN1bGF0aW9ucygiUVByb2MiLCBkZGEpDQogIGxvY2FsIGJhYiA9IFNwZWxsRG1nQ2FsY3VsYXRpb25zKCJXIiwgZGRhKQ0KICBsb2NhbCBjYWIgPSBTcGVsbERtZ0NhbGN1bGF0aW9ucygiRSIsIGRkYSkNCiAgbG9jYWwgZGFiID0gU3BlbGxEbWdDYWxjdWxhdGlvbnMoIlJRIiwgZGRhKQ0KICBsb2NhbCBfYmIgPSBTcGVsbERtZ0NhbGN1bGF0aW9ucygiUlciLCBkZGEpDQogIGxvY2FsIGFiYiA9IEdldERpc3RhbmNlU3FyKGRkYSkNCiAgbG9jYWwgYmJiID0gIlEiDQogIGlmIF9hYiArIGRhYiArIGFhYiArIGFhYiArIGJhYiArIGNhYiA8IF9hYiArIGFhYiArIGJhYiArIF9iYiArIGNhYiB0aGVuDQogICAgYmJiID0gIlciDQogIGVuZA0KICBpZiBRcmVhZHkgYW5kIElzV1JlYWR5KCkgYW5kIFJyZWFkeSBhbmQgYmJiID09ICJRIiB0aGVuDQogICAgaWYgQ2FzdFEoZGRhKSB0aGVuDQogICAgICBjYW5DYXN0U3BlbGxzID0gZmFsc2UNCiAgICAgIFJTa2lsbCA9ICJRIg0KICAgICAgUlNraWxsVGltZSA9IG9zLmNsb2NrKCkNCiAgICBlbmQNCiAgZWxzZWlmIFFyZWFkeSBhbmQgUnJlYWR5IGFuZCBJc1dSZWFkeSgpIGFuZCBub3Qgd3JVc2VkKCkgYW5kIGFiYiA8IFNwZWxscy5XLnJhbmdlU3FyIGFuZCBiYmIgPT0gIlciIHRoZW4NCiAgICBDYXN0UShkZGEpDQogICAgaWYgQ2FzdFcoZGRhKSB0aGVuDQogICAgICBjYW5DYXN0U3BlbGxzID0gZmFsc2UNCiAgICAgIFJTa2lsbCA9ICJXIg0KICAgICAgUlNraWxsVGltZSA9IG9zLmNsb2NrKCkNCiAgICBlbmQNCiAgZWxzZWlmIGFiYiA8IGN1cnJlbnRSYW5nZSAqIGN1cnJlbnRSYW5nZSBhbmQgYWJiID4gU3BlbGxzLlEucmFuZ2UgKiBTcGVsbHMuUS5yYW5nZSB0aGVuDQogICAgQ2FzdEUoZGRhKQ0KICBlbHNlaWYgUXJlYWR5IGFuZCBScmVhZHkgYW5kIEdldERpc3RhbmNlU3FyKGRkYSkgPCBTcGVsbHMuUS5yYW5nZSAqIFNwZWxscy5RLnJhbmdlIGFuZCAoYmJiID09ICJXIiBhbmQgbm90IFdyZWFkeSBhbmQgbm90IFNwZWxsQWJvdXRUb0NvbWVVcChfVykgb3IgYmJiID09ICJRIikgdGhlbg0KICAgIGlmIENhc3RRKGRkYSkgdGhlbg0KICAgICAgY2FuQ2FzdFNwZWxscyA9IGZhbHNlDQogICAgICBSU2tpbGwgPSAiUSINCiAgICAgIFJTa2lsbFRpbWUgPSBvcy5jbG9jaygpDQogICAgZW5kDQogIGVsc2VpZiBXcmVhZHkgYW5kIFJyZWFkeSBhbmQgR2V0RGlzdGFuY2VTcXIoZGRhKSA8IFNwZWxscy5XLnJhbmdlU3FyIGFuZCAoYmJiID09ICJRIiBhbmQgbm90IFFyZWFkeSBhbmQgbm90IFNwZWxsQWJvdXRUb0NvbWVVcChfUSkgb3IgYmJiID09ICJXIikgdGhlbg0KICAgIGlmIENhc3RXKGRkYSkgdGhlbg0KICAgICAgY2FuQ2FzdFNwZWxscyA9IGZhbHNlDQogICAgICBSU2tpbGwgPSAiVyINCiAgICAgIFJTa2lsbFRpbWUgPSBvcy5jbG9jaygpDQogICAgZW5kDQogIGVsc2VpZiBiYmIgPT0gIlEiIGFuZCBScmVhZHkgYW5kIFJTdGF0ZSgiUSIpIHRoZW4NCiAgICBDYXN0UlEoZGRhKQ0KICBlbHNlaWYgYmJiID09ICJXIiBhbmQgUnJlYWR5IGFuZCBub3Qgd3JVc2VkKCkgYW5kIFJTdGF0ZSgiVyIpIHRoZW4NCiAgICBDYXN0UlcoZGRhKQ0KICBlbHNlaWYgYmJiID09ICJRIiBhbmQgUXJlYWR5IGFuZCBub3QgUnJlYWR5IGFuZCBub3QgSXNLaWxsYWJsZShkZGEpIGFuZCBTcGVsbEFib3V0VG9Db21lVXAoX1IpIHRoZW4NCiAgICBDYXN0VyhkZGEpDQogICAgQ2FzdEUoZGRhKQ0KICBlbHNlaWYgYmJiID09ICJXIiBhbmQgV3JlYWR5IGFuZCBub3QgUnJlYWR5IGFuZCBub3QgSXNLaWxsYWJsZShkZGEpIGFuZCBTcGVsbEFib3V0VG9Db21lVXAoX1IpIHRoZW4NCiAgICBDYXN0UShkZGEpDQogICAgQ2FzdEUoZGRhKQ0KICBlbHNlaWYgSXNXUmVhZHkoKSBhbmQgbm90IEVyZWFkeSBhbmQgbm90IFFyZWFkeSBhbmQgbm90IFJyZWFkeSBhbmQgU3BlbGxBYm91dFRvQ29tZVVwKF9RKSBhbmQgbm90IFNwZWxsQWJvdXRUb0NvbWVVcChfRSkgYW5kIG5vdCBTcGVsbEFib3V0VG9Db21lVXAoX1IpIGFuZCBub3QgSXNLaWxsYWJsZShkZGEpIGFuZCBub3QgKF9hYiArIGJhYiA+PSBkZGEuaGVhbHRoKSB0aGVuDQogICAgcmV0dXJuDQogIGVsc2VpZiBFcmVhZHkgYW5kIG5vdCBJc1dSZWFkeSgpIGFuZCBub3QgUXJlYWR5IGFuZCBub3QgUnJlYWR5IGFuZCBTcGVsbEFib3V0VG9Db21lVXAoX1EpIGFuZCBteUhlcm86R2V0U3BlbGxEYXRhKF9RKS5jdXJyZW50Q2QgPj0gU3BlbGxzLkUucHJvY1RpbWUgYW5kIG5vdCBTcGVsbEFib3V0VG9Db21lVXAoX1cpIGFuZCBub3QgSXNLaWxsYWJsZShkZGEpIGFuZCBub3QgKF9hYiArIGNhYiA+PSBkZGEuaGVhbHRoKSBhbmQgR2V0RVByZWRpY3Rpb24oZGRhKSB+PSBuaWwgdGhlbg0KICAgIHJldHVybg0KICBlbHNlDQogICAgaWYgQ2FzdFEoZGRhKSBhbmQgX2FiID4gZGRhLmhlYWx0aCB0aGVuDQogICAgICBpc0tpbGxlZFtkZGEubmV0d29ya0lEXSA9IHRydWUNCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIENhc3RSUShkZGEpIGFuZCBkYWIgPiBkZGEuaGVhbHRoIHRoZW4NCiAgICAgIGlzS2lsbGVkW2RkYS5uZXR3b3JrSURdID0gdHJ1ZQ0KICAgICAgcmV0dXJuDQogICAgZW5kDQogICAgaWYgQ2FzdFcoZGRhKSBhbmQgYmFiID4gZGRhLmhlYWx0aCB0aGVuDQogICAgICBpc0tpbGxlZFtkZGEubmV0d29ya0lEXSA9IHRydWUNCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIENhc3RFKGRkYSkNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIFNwZWxsQWJvdXRUb0NvbWVVcChkZGEpDQogIHJldHVybiBteUhlcm86R2V0U3BlbGxEYXRhKGRkYSkubGV2ZWwgYW5kIG15SGVybzpHZXRTcGVsbERhdGEoZGRhKS5sZXZlbCA+PSAxIGFuZCBteUhlcm86R2V0U3BlbGxEYXRhKGRkYSkuY3VycmVudENkIGFuZCBtYXRoLmZsb29yKG15SGVybzpHZXRTcGVsbERhdGEoZGRhKS5jdXJyZW50Q2QpIDw9IDINCmVuZA0KZnVuY3Rpb24gU3BlbGxOT1RBYm91dFRvQ29tZVVwKGRkYSkNCiAgcmV0dXJuIG15SGVybzpHZXRTcGVsbERhdGEoZGRhKS5sZXZlbCBhbmQgbXlIZXJvOkdldFNwZWxsRGF0YShkZGEpLmxldmVsID49IDEgYW5kIG15SGVybzpHZXRTcGVsbERhdGEoZGRhKS5jdXJyZW50Q2QgYW5kIG1hdGguZmxvb3IobXlIZXJvOkdldFNwZWxsRGF0YShkZGEpLmN1cnJlbnRDZCkgPj0gNQ0KZW5kDQpmdW5jdGlvbiBDYXN0UlEoZGRhKQ0KICBpZiBSU3RhdGUoIlEiKSBhbmQgZGRhIGFuZCBScmVhZHkgYW5kIEdldERpc3RhbmNlU3FyKGRkYSkgPD0gU3BlbGxzLlEucmFuZ2UgKiBTcGVsbHMuUS5yYW5nZSB0aGVuDQogICAgQ2FzdFNwZWxsKF9SLCBkZGEpDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBDYXN0UlcoZGRhLCBfX2IpDQogIGlmIFJTdGF0ZSgiVyIpIGFuZCBkZGEgYW5kIFJyZWFkeSB0aGVuDQogICAgaWYgbm90IF9fYiB0aGVuDQogICAgICBsb2NhbCBhX2IgPSBHZXRXUHJlZGljdGlvbihkZGEpDQogICAgICBpZiBHZXREaXN0YW5jZVNxcihkZGEpIDw9IFNwZWxscy5XLnJhbmdlU3FyIGFuZCBhX2Igfj0gbmlsIGFuZCBub3Qgd3JVc2VkKCkgdGhlbg0KICAgICAgICBDYXN0U3BlbGwoX1IsIGFfYi54LCBhX2IueikNCiAgICAgIGVuZA0KICAgIGVsc2VpZiBHZXREaXN0YW5jZVNxcihQb2ludChkZGEsIF9fYikpIDw9IFNwZWxscy5XLnJhbmdlU3FyIHRoZW4NCiAgICAgIENhc3RTcGVsbChfUiwgZGRhLCBfX2IpDQogICAgZW5kDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBDYXN0UkUoZGRhKQ0KICBpZiBSU3RhdGUoIkUiKSBhbmQgZGRhIHRoZW4NCiAgICBsb2NhbCBfX2IgPSBHZXRFUHJlZGljdGlvbihkZGEpDQogICAgaWYgUnJlYWR5IGFuZCBHZXREaXN0YW5jZShkZGEpIDw9IFNwZWxscy5FLnJhbmdlIGFuZCBfX2Igfj0gbmlsIHRoZW4NCiAgICAgIENhc3RTcGVsbChfUiwgX19iLngsIF9fYi56KQ0KICAgIGVuZA0KICBlbmQNCmVuZA0KZnVuY3Rpb24gSGFyYXNzKCkNCiAgaWYgdGFyZ2V0IH49IG5pbCBhbmQgVmFsaWRUYXJnZXQodGFyZ2V0KSBhbmQgTWFuYU1hbmFnZXIoKSB0aGVuDQogICAgaWYgTWVudS5oYXJhc3MuaGFyYXNzRSB0aGVuDQogICAgICBDYXN0RSh0YXJnZXQpDQogICAgZW5kDQogICAgaWYgTWVudS5oYXJhc3MuaGFyYXNzUSB0aGVuDQogICAgICBDYXN0USh0YXJnZXQpDQogICAgZW5kDQogICAgaWYgTWVudS5oYXJhc3MuaGFyYXNzVyBhbmQgbm90IFFyZWFkeSB0aGVuDQogICAgICBDYXN0Vyh0YXJnZXQpDQogICAgZW5kDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBMZUJsYW5jU3BlY2lmaWNTcGVsbENoZWNrcygpDQogIGlmIHdVc2VkKCkgYW5kIGNhc3RlZFdUaHJvdWdoSGFyYXNzLmJvb2wgYW5kIChub3QgdGFyZ2V0IG9yIG5vdCBJc0tpbGxhYmxlKHRhcmdldCkpIHRoZW4NCiAgICBDYXN0U3BlbGwoX1cpDQogICAgY2FzdGVkV1Rocm91Z2hIYXJhc3MuYm9vbCA9IGZhbHNlDQogICAgcmV0dXJuDQogIGVuZA0KICBsb2NhbCBkZGEgPSAwDQogIGxvY2FsIF9fYiA9IDANCiAgaWYgdGFyZ2V0IGFuZCBDb3VudEVuZW15SGVyb0luUmFuZ2UoMTUwMCkgPT0gMSBhbmQgd1VzZWQoKSB0aGVuDQogICAgX19iID0gRGFtYWdlVG9NZSh0YXJnZXQpDQogIGVuZA0KICBsb2NhbCBhX2IsIGJfYiA9IDAsIDANCiAgaWYgd1VzZWQoKSB0aGVuDQogICAgYV9iLCBiX2IgPSBDb3VudE1pbmlvbnNBdHRhY2tpbmdtZSgpDQogIGVuZA0KICBpZiBiX2IgPT0gbmlsIHRoZW4NCiAgICBiX2IgPSAwDQogIGVuZA0KICBpZiB3VXNlZCgpIG9yIHdyVXNlZCgpIHRoZW4NCiAgICBkZGEgPSBUb29EYW5nZXJvdXMobXlIZXJvLnBvcykNCiAgZW5kDQogIGxvY2FsIGNfYiA9IDANCiAgaWYgd1VzZWQoKSB0aGVuDQogICAgY19iID0gVG9vRGFuZ2Vyb3VzKFNwZWxscy5XLnN0YXJ0UG9zKQ0KICBlbmQNCiAgaWYgQ291bnRFbmVteUhlcm9JblJhbmdlKDgwMCkgPT0gMCBhbmQgVW5kZXJUdXJyZXQobXlIZXJvKSBhbmQgdHVycmV0Rm9jdXMuZm9jdXNlZCB0aGVuDQogICAgQ2FzdFNwZWxsKF9XKQ0KICAgIHJldHVybg0KICBlbmQNCiAgaWYgQ291bnRFbmVteUhlcm9JblJhbmdlKDgwMCkgPT0gMCBhbmQgYl9iIGFuZCBiX2IgLyBteUhlcm8uaGVhbHRoIDw9IDAuNSB0aGVuDQogICAgcmV0dXJuDQogIGVuZA0KICBpZiBjYXN0ZWRFVGltZSArIDEuMiA+IG9zLmNsb2NrKCkgYW5kIHdVc2VkKCkgYW5kIGRkYSA8PSA1IGFuZCBjX2IgPD0gMyBhbmQgKG5vdCBVbmRlclR1cnJldChteUhlcm8pIG9yIG5vdCB0dXJyZXRGb2N1cy5mb2N1c2VkKSB0aGVuDQogICAgcmV0dXJuDQogIGVuZA0KICBpZiBjaGFpblRhcmdldCBhbmQgY2FzdGVkRVRpbWUgKyAyIDwgb3MuY2xvY2soKSB0aGVuDQogICAgY2hhaW5UYXJnZXQgPSBuaWwNCiAgZW5kDQogIGlmIHdVc2VkKCkgYW5kIGNoYWluVGFyZ2V0IH49IG5pbCBhbmQgR2V0RGlzdGFuY2UoU3BlbGxzLlcuc3RhcnRQb3MsIGNoYWluVGFyZ2V0KSA+PSBTcGVsbHMuRS5yYW5nZSBhbmQgZGRhIDw9IDMgdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgaWYgd3JVc2VkKCkgYW5kIG5vdCB3VXNlZCgpIGFuZCBjaGFpblRhcmdldCB+PSBuaWwgYW5kIEdldERpc3RhbmNlKFNwZWxscy5XUi5zdGFydFBvcywgY2hhaW5UYXJnZXQpID49IFNwZWxscy5FLnJhbmdlIHRoZW4NCiAgICByZXR1cm4NCiAgZW5kDQogIGlmIHdVc2VkKCkgYW5kIHdyVXNlZCgpIGFuZCBjaGFpblRhcmdldCBhbmQgR2V0RGlzdGFuY2UoU3BlbGxzLlcuc3RhcnRQb3MsIGNoYWluVGFyZ2V0KSA+PSBTcGVsbHMuRS5yYW5nZSBhbmQgR2V0RGlzdGFuY2UoU3BlbGxzLldSLnN0YXJ0UG9zLCBjaGFpblRhcmdldCkgPj0gU3BlbGxzLkUucmFuZ2UgYW5kIGRkYSA8PSAzIHRoZW4NCiAgICByZXR1cm4NCiAgZW5kDQogIGlmIHdVc2VkKCkgYW5kIFdyZWFkeSB0aGVuDQogICAgbG9jYWwgZF9iID0gbXlIZXJvLmhlYWx0aCAvIG15SGVyby5tYXhIZWFsdGgNCiAgICBsb2NhbCBfYWIgPSAobXlIZXJvLmhlYWx0aCAtIGJfYikgLyBteUhlcm8ubWF4SGVhbHRoDQogICAgaWYgZ2FwQ2xvc2VTZXR0aW5ncy50aW1lICsgMSA+IG9zLmNsb2NrKCkgdGhlbg0KICAgICAgaWYgbm90IFFyZWFkeSBhbmQgbm90IFJyZWFkeSBhbmQgKG5vdCB0YXJnZXQgb3IgdGFyZ2V0IGFuZCBub3QgSXNLaWxsYWJsZSh0YXJnZXQpKSBhbmQgMSA8IENvdW50RW5lbXlIZXJvSW5SYW5nZShTcGVsbHMuUS5yYW5nZSkgdGhlbg0KICAgICAgICBDYXN0U3BlbGwoX1cpDQogICAgICAgIHJldHVybg0KICAgICAgZW5kDQogICAgICBpZiBkX2IgPD0gMC4xNSBhbmQgKG5vdCB0YXJnZXQgb3Igbm90IElzS2lsbGFibGUodGFyZ2V0KSBvciBDb3VudEVuZW15SGVyb0luUmFuZ2UoU3BlbGxzLlEucmFuZ2UpIH49IDEpIHRoZW4NCiAgICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgICAgICByZXR1cm4NCiAgICAgIGVuZA0KICAgICAgaWYgZGRhID49IDUgdGhlbg0KICAgICAgICBDYXN0U3BlbGwoX1cpDQogICAgICAgIHJldHVybg0KICAgICAgZW5kDQogICAgICBpZiBkX2IgPj0gMC44IGFuZCBkZGEgPD0gNyB0aGVuDQogICAgICAgIHJldHVybg0KICAgICAgZW5kDQogICAgICBpZiBkX2IgPD0gMC4zIGFuZCB0YXJnZXQgYW5kIElzS2lsbGFibGUodGFyZ2V0KSBhbmQgQ291bnRFbmVteUhlcm9JblJhbmdlKFNwZWxscy5RLnJhbmdlKSA9PSAxIHRoZW4NCiAgICAgICAgcmV0dXJuDQogICAgICBlbmQNCiAgICAgIGlmIGRfYiA8PSAwLjMgYW5kIG5vdCBRcmVhZHkgYW5kIG5vdCBScmVhZHkgdGhlbg0KICAgICAgICBDYXN0U3BlbGwoX1cpDQogICAgICAgIHJldHVybg0KICAgICAgZW5kDQogICAgICBpZiBkX2IgPj0gX2FiIGFuZCBfYWIgPD0gMC4zIGFuZCBub3QgdGFyZ2V0IHRoZW4NCiAgICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgICAgICByZXR1cm4NCiAgICAgIGVuZA0KICAgICAgcmV0dXJuDQogICAgZW5kDQogICAgbG9jYWwgYWFiID0gKG15SGVyby5oZWFsdGggLSBiX2IpIC8gbXlIZXJvLmhlYWx0aA0KICAgIGlmIENvdW50RW5lbXlIZXJvSW5SYW5nZSgxMDAwKSA9PSAwIGFuZCAobm90IFVuZGVyVHVycmV0KG15SGVybywgdHJ1ZSkgb3Igbm90IHR1cnJldEZvY3VzLmZvY3VzZWQpIGFuZCBhX2IgYW5kIGFfYiA8PSA1IHRoZW4NCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIGRfYiA+PSAwLjYgYW5kIG5vdCB0YXJnZXQgYW5kIChub3QgVW5kZXJUdXJyZXQobXlIZXJvKSBvciBub3QgdHVycmV0Rm9jdXMuZm9jdXNlZCkgYW5kIGRfYiA8PSBfYWIgKyAwLjIgdGhlbg0KICAgICAgcmV0dXJuDQogICAgZW5kDQogICAgaWYgZF9iIDw9IDAuMiBhbmQgMiA+PSBDb3VudEVuZW15SGVyb0luUmFuZ2UoNjAwKSBhbmQgbm90IFVuZGVyVHVycmV0KG15SGVybywgdHJ1ZSkgdGhlbg0KICAgICAgcmV0dXJuDQogICAgZW5kDQogICAgaWYgZF9iIDw9IDAuMyBhbmQgdGFyZ2V0IGFuZCBJc0tpbGxhYmxlKHRhcmdldCkgYW5kIEdldERpc3RhbmNlKHRhcmdldCkgPD0gNTAwIGFuZCBkZGEgPD0gNCB0aGVuDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBpZiBkX2IgPD0gMC40IGFuZCB0YXJnZXQgYW5kIEdldERpc3RhbmNlKHRhcmdldCkgPD0gU3BlbGxzLlEucmFuZ2UgYW5kIElzS2lsbGFibGUodGFyZ2V0KSBhbmQgVW5kZXJUdXJyZXQobXlIZXJvLCB0cnVlKSB0aGVuDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBpZiBkX2IgPj0gMC42IGFuZCB0YXJnZXQgYW5kIElzS2lsbGFibGUodGFyZ2V0KSBhbmQgODAwID49IEdldERpc3RhbmNlKHRhcmdldCkgYW5kIGRkYSA8PSAzIHRoZW4NCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIHRhcmdldCBhbmQgQ291bnRFbmVteUhlcm9JblJhbmdlKDE1MDApID09IDEgYW5kIChJZ25pdGVXaWxsS2lsbEVuZW15KHRhcmdldCkgb3IgaXNLaWxsZWRbdGFyZ2V0Lm5ldHdvcmtJRF0pIHRoZW4NCiAgICAgIENhc3RTcGVsbChfVykNCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIHRhcmdldCBhbmQgbm90IFNwZWxsQXZhaWxhYmxlKCkgYW5kIHRhcmdldC5oZWFsdGggPiAzMDAgYW5kIG5vdCBTcGVsbEFib3V0VG9Db21lVXAoX1EpIGFuZCBub3QgU3BlbGxBYm91dFRvQ29tZVVwKF9SKSBhbmQgbm90IFNwZWxsQWJvdXRUb0NvbWVVcChfRSkgYW5kIEdldERpc3RhbmNlKFNwZWxscy5XLnN0YXJ0UG9zKSA+PSAzMDAgdGhlbg0KICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgICAgcmV0dXJuDQogICAgZW5kDQogICAgaWYgYWFiIDw9IDAuNiBhbmQgVW5kZXJUdXJyZXQobXlIZXJvLCB0cnVlKSBhbmQgdHVycmV0Rm9jdXMuZm9jdXNlZCBhbmQgKG5vdCB0YXJnZXQgb3IgdGFyZ2V0IGFuZCA4MDAgPD0gR2V0RGlzdGFuY2UodGFyZ2V0KSkgdGhlbg0KICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgICAgcmV0dXJuDQogICAgZW5kDQogICAgaWYgYWFiIDw9IDAuNSBhbmQgQ291bnRFbmVteUhlcm9JblJhbmdlKDEwMDApID09IDAgdGhlbg0KICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgICAgcmV0dXJuDQogICAgZW5kDQogICAgaWYgYWFiIDw9IDAuMyBhbmQgKG5vdCB0YXJnZXQgb3Igbm90IElzS2lsbGFibGUodGFyZ2V0KSkgdGhlbg0KICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgICAgcmV0dXJuDQogICAgZW5kDQogICAgaWYgQ291bnRFbmVteUhlcm9JblJhbmdlKDE1MDApID09IDAgYW5kIFVuZGVyVHVycmV0KG15SGVybywgdHJ1ZSkgYW5kIHR1cnJldEZvY3VzLmZvY3VzZWQgdGhlbg0KICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgICAgcmV0dXJuDQogICAgZW5kDQogICAgaWYgQ291bnRFbmVteUhlcm9JblJhbmdlKDE1MDApID49IDEgYW5kIFVuZGVyVHVycmV0KG15SGVybywgdHJ1ZSkgYW5kIG5vdCBVbmRlclR1cnJldChTcGVsbHMuVy5zdGFydFBvcywgdHJ1ZSkgYW5kIHRhcmdldCBhbmQgbm90IElzS2lsbGFibGUodGFyZ2V0KSBhbmQgdHVycmV0Rm9jdXMuZm9jdXNlZCB0aGVuDQogICAgICBDYXN0U3BlbGwoX1cpDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBpZiBhYWIgPD0gMC41IGFuZCB0YXJnZXQgYW5kIG5vdCBJc0tpbGxhYmxlKHRhcmdldCkgYW5kIEdldERpc3RhbmNlKFNwZWxscy5XLnN0YXJ0UG9zKSA+PSAzMDAgdGhlbg0KICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgICAgcmV0dXJuDQogICAgZW5kDQogICAgaWYgZF9iIDw9IDAuMSBhbmQgdGFyZ2V0IHRoZW4NCiAgICAgIENhc3RTcGVsbChfVykNCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIF9hYiBhbmQgX2FiIDw9IDAuMyBhbmQgZF9iID49IF9hYiBhbmQgKG5vdCB0YXJnZXQgb3Igbm90IElzS2lsbGFibGUodGFyZ2V0KSBvciBDb3VudEVuZW15SGVyb0luUmFuZ2UoODAwKSB+PSAxKSB0aGVuDQogICAgICBDYXN0U3BlbGwoX1cpDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBpZiBkX2IgPD0gMC40IGFuZCB0YXJnZXQgYW5kIG5vdCBJc0tpbGxhYmxlKHRhcmdldCkgYW5kIFVuZGVyVHVycmV0KG15SGVybywgdHJ1ZSkgYW5kIG5vdCBVbmRlclR1cnJldChTcGVsbHMuVy5zdGFydFBvcywgdHJ1ZSkgdGhlbg0KICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgICAgcmV0dXJuDQogICAgZW5kDQogICAgaWYgNCA8PSBDb3VudEVuZW15SGVyb0luUmFuZ2UoMzAwLCBteUhlcm8ucG9zKSBhbmQgQ291bnRFbmVteUhlcm9JblJhbmdlKDMwMCwgbXlIZXJvLnBvcykgPj0gQ291bnRFbmVteUhlcm9JblJhbmdlKDMwMCwgU3BlbGxzLlcuc3RhcnRQb3MpIGFuZCBHZXREaXN0YW5jZShTcGVsbHMuVy5zdGFydFBvcykgPj0gMzAwIGFuZCBkZGEgPj0gY19iIHRoZW4NCiAgICAgIENhc3RTcGVsbChfVykNCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIENoZWNrQURDVGFyZ2V0KFNwZWxscy5XLnN0YXJ0UG9zKSBhbmQgbm90IENoZWNrQURDVGFyZ2V0KG15SGVyby5wb3MpIGFuZCBkZGEgPD0gNCB0aGVuDQogICAgICByZXR1cm4NCiAgICBlbHNlaWYgQ2hlY2tBRENUYXJnZXQobXlIZXJvLnBvcykgYW5kIG5vdCBDaGVja0FEQ1RhcmdldChTcGVsbHMuVy5zdGFydFBvcykgYW5kIFRvb0Rhbmdlcm91cyhTcGVsbHMuVy5zdGFydFBvcykgPD0gNCB0aGVuDQogICAgICBDYXN0U3BlbGwoX1cpDQogICAgZW5kDQogICAgaWYgZGRhID49IFRvb0Rhbmdlcm91cyhTcGVsbHMuVy5zdGFydFBvcykgYW5kIGRkYSA+PSA0IHRoZW4NCiAgICAgIENhc3RTcGVsbChfVykNCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIGRkYSA+PSA2IHRoZW4NCiAgICAgIENhc3RTcGVsbChfVykNCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGlmIGRfYiA8PSAwLjMgYW5kIFVuZGVyVHVycmV0KG15SGVybykgYW5kIChub3QgdGFyZ2V0IG9yIG5vdCB0YXJnZXQgb3Igbm90IElzS2lsbGFibGUodGFyZ2V0KSBvciB0YXJnZXQgYW5kIGlzS2lsbGVkW3RhcmdldC5uZXR3b3JrSURdKSB0aGVuDQogICAgICBDYXN0U3BlbGwoX1cpDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBpZiBDb3VudEVuZW15SGVyb0luUmFuZ2UoMzAwKSA9PSAjR2V0RW5lbXlIZXJvZXMoKSBhbmQgR2V0RGlzdGFuY2UoU3BlbGxzLlcuc3RhcnRQb3MpID49IDMwMCB0aGVuDQogICAgICBDYXN0U3BlbGwoX1cpDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBpZiBkX2IgPD0gMC41IGFuZCBfX2IgPj0gbXlIZXJvLmhlYWx0aCB0aGVuDQogICAgICBDYXN0U3BlbGwoX1cpDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBpZiBkZGEgPj0gNiB0aGVuDQogICAgICBDYXN0U3BlbGwoX1cpDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgZW5kDQogIGlmIHdyVXNlZCgpIGFuZCBub3Qgd1VzZWQoKSBhbmQgUnJlYWR5IHRoZW4NCiAgICBpZiBDaGVja0FEQ1RhcmdldChteUhlcm8ucG9zKSBhbmQgbm90IENoZWNrQURDVGFyZ2V0KFNwZWxscy5XUi5zdGFydFBvcykgdGhlbg0KICAgICAgQ2FzdFNwZWxsKF9SKQ0KICAgIGVuZA0KICAgIGlmIGRkYSA+PSBUb29EYW5nZXJvdXMoU3BlbGxzLldSLnN0YXJ0UG9zKSBhbmQgZGRhID49IDQgdGhlbg0KICAgICAgQ2FzdFNwZWxsKF9SKQ0KICAgIGVuZA0KICBlbmQNCiAgaWYgd1VzZWQoKSBhbmQgQ291bnRFbmVteUhlcm9JblJhbmdlKDYwMCkgPT0gMSBhbmQgZGRhID49IDQgdGhlbg0KICAgIENhc3RTcGVsbChfVykNCiAgZW5kDQogIGlmIE1lbnUuc2V0dGluZ3NXLnVzZU9wdGlvbmFsVyA9PSAxIHRoZW4NCiAgICBpZiB3VXNlZCgpIGFuZCB3clVzZWQoKSB0aGVuDQogICAgICBpZiBDb3VudEVuZW15SGVyb0luUmFuZ2UoNDAwLCBTcGVsbHMuV1Iuc3RhcnRQb3MpIDwgQ291bnRFbmVteUhlcm9JblJhbmdlKDQwMCwgU3BlbGxzLlcuc3RhcnRQb3MpIGFuZCBDb3VudEVuZW15SGVyb0luUmFuZ2UoNDAwLCBTcGVsbHMuV1Iuc3RhcnRQb3MpIDwgQ291bnRFbmVteUhlcm9JblJhbmdlKDQwMCkgdGhlbg0KICAgICAgICBpZiBub3QgUXJlYWR5IGFuZCBub3QgRXJlYWR5IHRoZW4NCiAgICAgICAgICBDYXN0U3BlbGwoX1IpDQogICAgICAgIGVuZA0KICAgICAgZWxzZWlmIENvdW50RW5lbXlIZXJvSW5SYW5nZSg0MDAsIFNwZWxscy5XLnN0YXJ0UG9zKSA+IENvdW50RW5lbXlIZXJvSW5SYW5nZSg0MDAsIFNwZWxscy5XUi5zdGFydFBvcykgYW5kIENvdW50RW5lbXlIZXJvSW5SYW5nZSg0MDAsIFNwZWxscy5XLnN0YXJ0UG9zKSA8IENvdW50RW5lbXlIZXJvSW5SYW5nZSg0MDApIGFuZCBub3QgUXJlYWR5IGFuZCBub3QgRXJlYWR5IHRoZW4NCiAgICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgICAgZW5kDQogICAgZWxzZWlmIHdVc2VkKCkgdGhlbg0KICAgICAgaWYgQ291bnRFbmVteUhlcm9JblJhbmdlKDQwMCwgU3BlbGxzLlcuc3RhcnRQb3MpIDwgQ291bnRFbmVteUhlcm9JblJhbmdlKDQwMCkgYW5kIChub3QgUXJlYWR5IGFuZCBub3QgRXJlYWR5IG9yIGRkYSA+IFRvb0Rhbmdlcm91cyhTcGVsbHMuVy5zdGFydFBvcykpIHRoZW4NCiAgICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgICAgZW5kDQogICAgZWxzZWlmIHdyVXNlZCgpIGFuZCBDb3VudEVuZW15SGVyb0luUmFuZ2UoNDAwLCBTcGVsbHMuV1Iuc3RhcnRQb3MpIDwgQ291bnRFbmVteUhlcm9JblJhbmdlKDQwMCkgYW5kIG5vdCBRcmVhZHkgYW5kIG5vdCBFcmVhZHkgdGhlbg0KICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgIGVuZA0KICBlbHNlaWYgTWVudS5zZXR0aW5nc1cudXNlT3B0aW9uYWxXID09IDMgb3IgTWVudS5zZXR0aW5nc1cudXNlT3B0aW9uYWxXID09IDQgdGhlbg0KICAgIGlmIHdVc2VkKCkgYW5kIHdyVXNlZCgpIHRoZW4NCiAgICAgIGlmIG5vdCBRcmVhZHkgYW5kIG5vdCBFcmVhZHkgdGhlbg0KICAgICAgICBDYXN0U3BlbGwoX1cpDQogICAgICBlbmQNCiAgICBlbHNlaWYgd1VzZWQoKSB0aGVuDQogICAgICBpZiBub3QgUXJlYWR5IGFuZCBub3QgRXJlYWR5IHRoZW4NCiAgICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgICAgZW5kDQogICAgZWxzZWlmIHdyVXNlZCgpIGFuZCBub3QgUXJlYWR5IGFuZCBub3QgRXJlYWR5IHRoZW4NCiAgICAgIENhc3RTcGVsbChfVykNCiAgICBlbmQNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIEZhcm0oKQ0KICBsb2NhbCBkZGEgPSBmYWxzZQ0KICBpZiBNZW51LmZhcm0uZmFybUFBIGFuZCAoZGJhIGFuZCBfRy5TeE9yYjpDYW5BdHRhY2soKSA9PSB0cnVlIG9yIFNBQ0xvYWRlZCBhbmQgX0cuQXV0b0NhcnJ5Lk9yYndhbGtlcjpDYW5TaG9vdCgpKSB0aGVuDQogICAgcmV0dXJuDQogIGVuZA0KICBpZiBNZW51LmZhcm0uZmFybVEgdGhlbg0KICAgIGZvciBfX2IsIGFfYiBpbiBwYWlycyhlbmVteU1pbmlvbnMub2JqZWN0cykgZG8NCiAgICAgIGlmIGFfYiBhbmQgTWVudS5mYXJtLmZhcm1SYW5nZSBhbmQgR2V0RGlzdGFuY2VTcXIoYV9iKSA8IFNwZWxscy5BQS5yYW5nZSAqIFNwZWxscy5BQS5yYW5nZSBhbmQgR2V0RGlzdGFuY2VTcXIoYV9iKSA8IFNwZWxscy5RLnJhbmdlICogU3BlbGxzLlEucmFuZ2UgdGhlbg0KICAgICAgICBpZiBnZXREbWcoIlEiLCBhX2IsIG15SGVybykgPiBhX2IuaGVhbHRoIGFuZCBDYXN0UShhX2IpIHRoZW4NCiAgICAgICAgICBkZGEgPSB0cnVlDQogICAgICAgIGVuZA0KICAgICAgZW5kDQogICAgICBpZiBkZGEgfj0gdHJ1ZSB0aGVuDQogICAgICAgIGlmIG5vdCBNZW51LmZhcm0uZmFybVJhbmdlIGFuZCBHZXREaXN0YW5jZVNxcihhX2IpIDwgU3BlbGxzLlEucmFuZ2UgKiBTcGVsbHMuUS5yYW5nZSB0aGVuDQogICAgICAgICAgaWYgZ2V0RG1nKCJRIiwgYV9iLCBteUhlcm8pID4gYV9iLmhlYWx0aCB0aGVuDQogICAgICAgICAgICBpZiBDYXN0UShhX2IpIHRoZW4NCiAgICAgICAgICAgICAgZGRhID0gdHJ1ZQ0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBpZiBkZGEgdGhlbg0KICAgICAgICAgICAgICBDYXN0U3BlbGwoX1cpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICBlbmQNCiAgICAgIGlmIGRkYSB+PSB0cnVlIHRoZW4NCiAgICAgIGVuZA0KICAgIGVuZA0KICBlbmQNCiAgaWYgZGRhIHRoZW4NCiAgICBRcmVhZHkgPSBmYWxzZQ0KICAgIHJldHVybg0KICBlbmQNCiAgaWYgTWVudS5mYXJtLmZhcm1XIHRoZW4NCiAgICBmb3IgX19iLCBhX2IgaW4gcGFpcnMoZW5lbXlNaW5pb25zLm9iamVjdHMpIGRvDQogICAgICBpZiBhX2IgYW5kIE1lbnUuZmFybS5mYXJtUmFuZ2UgYW5kIEdldERpc3RhbmNlU3FyKGFfYikgPCBTcGVsbHMuQUEucmFuZ2UgKiBTcGVsbHMuQUEucmFuZ2UgYW5kIEdldERpc3RhbmNlU3FyKGFfYikgPCBTcGVsbHMuVy5yYW5nZVNxciBhbmQgSXNXUmVhZHkoKSBhbmQgZ2V0RG1nKCJXIiwgYV9iLCBteUhlcm8pID4gYV9iLmhlYWx0aCBhbmQgQ2FzdFcoYV9iKSB0aGVuDQogICAgICAgIENhc3RTcGVsbChfVykNCiAgICAgICAgZGRhID0gdHJ1ZQ0KICAgICAgICBkbyBicmVhayBlbmQNCiAgICAgICAgcmV0dXJuDQogICAgICBlbmQNCiAgICAgIGlmIG5vdCBNZW51LmZhcm0uZmFybVJhbmdlIGFuZCBHZXREaXN0YW5jZVNxcihhX2IpIDwgU3BlbGxzLlcucmFuZ2VTcXIgYW5kIElzV1JlYWR5KCkgYW5kIGdldERtZygiVyIsIGFfYiwgbXlIZXJvKSA+IGFfYi5oZWFsdGggYW5kIENhc3RXKGFfYikgdGhlbg0KICAgICAgICBDYXN0U3BlbGwoX1cpDQogICAgICAgIGRkYSA9IHRydWUNCiAgICAgICAgYnJlYWsNCiAgICAgIGVuZA0KICAgIGVuZA0KICBlbmQNCiAgaWYgZGRhIHRoZW4NCiAgICBXcmVhZHkgPSBmYWxzZQ0KICAgIHJldHVybg0KICBlbmQNCmVuZA0KZnVuY3Rpb24gTGFuZUNsZWFyKCkNCiAgaWYgTWVudS5sYW5lY2xlYXIubGFuZWNsZWFyUSB0aGVuDQogICAgZm9yIGRkYSwgX19iIGluIGlwYWlycyhlbmVteU1pbmlvbnMub2JqZWN0cykgZG8NCiAgICAgIGlmIEdldERpc3RhbmNlU3FyKF9fYikgPCBTcGVsbHMuUS5yYW5nZSAqIFNwZWxscy5RLnJhbmdlIHRoZW4NCiAgICAgICAgQ2FzdFNwZWxsKF9RLCBfX2IpDQogICAgICAgIGJyZWFrDQogICAgICBlbmQNCiAgICBlbmQNCiAgZW5kDQogIGlmIE1lbnUubGFuZWNsZWFyLmxhbmVjbGVhclcgYW5kIE1lbnUubGFuZWNsZWFyLmxhbmVjbGVhclIgYW5kIFJyZWFkeSBhbmQgV3JlYWR5IHRoZW4NCiAgICBpZiBub3Qgd1VzZWQoKSBhbmQgbm90IHdyVXNlZCgpIHRoZW4NCiAgICAgIGxvY2FsIGRkYSwgX19iID0gR2V0QmVzdEFPRVBvc2l0aW9uKGVuZW15TWluaW9ucy5vYmplY3RzLCBTcGVsbHMuVy5yYW5nZSwgU3BlbGxzLlcucmFkaXVzLCBteUhlcm8pDQogICAgICBpZiBfX2IgYW5kIF9fYiA+PSBNZW51LmxhbmVjbGVhci5sYW5lY2xlYXJXUkFtb3VudCB0aGVuDQogICAgICAgIGlmIGRkYSB+PSBuaWwgdGhlbg0KICAgICAgICAgIENhc3RTcGVsbChfVywgZGRhLngsIGRkYS56KQ0KICAgICAgICBlbmQNCiAgICAgICAgZGRhLCBfX2IgPSBHZXRCZXN0QU9FUG9zaXRpb24oZW5lbXlNaW5pb25zLm9iamVjdHMsIFNwZWxscy5XLnJhbmdlLCBTcGVsbHMuVy5yYWRpdXMsIG15SGVybykNCiAgICAgICAgaWYgZGRhIH49IG5pbCB0aGVuDQogICAgICAgICAgQ2FzdFNwZWxsKF9SLCBkZGEueCwgZGRhLnopDQogICAgICAgIGVuZA0KICAgICAgZW5kDQogICAgZW5kDQogICAgaWYgd1VzZWQoKSB0aGVuDQogICAgICBDYXN0U3BlbGwoX1cpDQogICAgZW5kDQogIGVsc2VpZiBNZW51LmxhbmVjbGVhci5sYW5lY2xlYXJXIGFuZCBJc1dSZWFkeSgpIHRoZW4NCiAgICBsb2NhbCBkZGEsIF9fYiA9IEdldEJlc3RBT0VQb3NpdGlvbihlbmVteU1pbmlvbnMub2JqZWN0cywgU3BlbGxzLlcucmFuZ2UsIFNwZWxscy5XLnJhZGl1cywgbXlIZXJvKQ0KICAgIGlmIGRkYSB+PSBuaWwgYW5kIF9fYiA+PSBNZW51LmxhbmVjbGVhci5sYW5lY2xlYXJXQW1vdW50IHRoZW4NCiAgICAgIENhc3RTcGVsbChfVywgZGRhLngsIGRkYS56KQ0KICAgICAgQ2FzdFNwZWxsKF9XKQ0KICAgIGVuZA0KICBlbHNlaWYgTWVudS5sYW5lY2xlYXIubGFuZWNsZWFyUiBhbmQgUnJlYWR5IGFuZCBSU3RhdGUoIlciKSBhbmQgbm90IHdyVXNlZCgpIHRoZW4NCiAgICBsb2NhbCBkZGEsIF9fYiA9IEdldEJlc3RBT0VQb3NpdGlvbihlbmVteU1pbmlvbnMub2JqZWN0cywgU3BlbGxzLlcucmFuZ2UsIFNwZWxscy5XLnJhZGl1cywgbXlIZXJvKQ0KICAgIGlmIGRkYSB+PSBuaWwgYW5kIF9fYiA+PSBNZW51LmxhbmVjbGVhci5sYW5lY2xlYXJSQW1vdW50IHRoZW4NCiAgICAgIENhc3RTcGVsbChfUiwgZGRhLngsIGRkYS56KQ0KICAgICAgQ2FzdFNwZWxsKF9SKQ0KICAgIGVuZA0KICBlbmQNCmVuZA0KZnVuY3Rpb24gS2lsbFN0ZWFsKCkNCiAgaWYgbm90IGNhbkNhc3RTcGVsbHMgdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgZm9yIGRkYSwgX19iIGluIHBhaXJzKEdldEVuZW15SGVyb2VzKCkpIGRvDQogICAgaWYgVmFsaWRUYXJnZXQoX19iKSBhbmQgbm90IF9fYi5kZWFkIGFuZCBfX2IudmlzaWJsZSBhbmQgTWVudS5raWxsc3RlYWwuZW5lbWllc1tfX2IuY2hhck5hbWVdIGFuZCBfX2IubmV0d29ya0lEIGFuZCBfX2IuaGVhbHRoIGFuZCAobm90IElnbml0ZVdpbGxLaWxsRW5lbXkoX19iKSBhbmQgbm90IGlzS2lsbGVkW19fYi5uZXR3b3JrSURdIG9yIG15SGVyby5oZWFsdGggLyBteUhlcm8ubWF4SGVhbHRoIDw9IDAuMikgdGhlbg0KICAgICAgbG9jYWwgYV9iLCBiX2IsIGNfYiwgZF9iLCBfYWIsIGFhYiA9IDAsIG5pbCwgbmlsLCBuaWwsIG5pbCwgbmlsDQogICAgICBpZiBHZXREaXN0YW5jZShfX2IpIDw9IFNwZWxscy5RLnJhbmdlICsgKFNwZWxscy5XLnJhbmdlIC0gMTI1KSB0aGVuDQogICAgICAgIGFfYiA9IFFyZWFkeSBhbmQgTWVudS5raWxsc3RlYWwua2lsbHN0ZWFsUSBhbmQgU3BlbGxEbWdDYWxjdWxhdGlvbnMoIlEiLCBfX2IpIG9yIDANCiAgICAgICAgYl9iID0gUnJlYWR5IGFuZCBSU3RhdGUoIlEiKSBhbmQgU3BlbGxEbWdDYWxjdWxhdGlvbnMoIlJRIiwgX19iKSBvciAwDQogICAgICAgIGNfYiA9IFNwZWxsRG1nQ2FsY3VsYXRpb25zKCJRUHJvYyIsIF9fYikNCiAgICAgICAgZF9iID0gSXNXUmVhZHkoKSBhbmQgTWVudS5raWxsc3RlYWwua2lsbHN0ZWFsVyBhbmQgU3BlbGxEbWdDYWxjdWxhdGlvbnMoIlciLCBfX2IpIG9yIDANCiAgICAgICAgX2FiID0gUnJlYWR5IGFuZCBNZW51LmtpbGxzdGVhbC5raWxsc3RlYWxSIGFuZCBub3Qgd3JVc2VkKCkgYW5kIFJTdGF0ZSgiVyIpIGFuZCBTcGVsbERtZ0NhbGN1bGF0aW9ucygiUlciLCBfX2IpIG9yIDANCiAgICAgIGVuZA0KICAgICAgaWYgR2V0RGlzdGFuY2VTcXIoX19iKSA8PSA0MjI1MDAgdGhlbg0KICAgICAgICBpZiBhX2IgPiBkX2IgYW5kIGRfYiA+IF9fYi5oZWFsdGggdGhlbg0KICAgICAgICAgIENhc3RXKF9fYikNCiAgICAgICAgZWxzZWlmIGFfYiA+IF9fYi5oZWFsdGggdGhlbg0KICAgICAgICAgIENhc3RRKF9fYikNCiAgICAgICAgZWxzZWlmIGVuZW1pZXNCdWZmc1tfX2IubmV0d29ya0lEXS5yZWNlaXZlZCBhbmQgYV9iICsgY19iID4gX19iLmhlYWx0aCB0aGVuDQogICAgICAgICAgQ2FzdFEoX19iKQ0KICAgICAgICBlbHNlaWYgZW5lbWllc0J1ZmZzW19fYi5uZXR3b3JrSURdLnJlY2VpdmVkIGFuZCBkX2IgKyBjX2IgPiBfX2IuaGVhbHRoIHRoZW4NCiAgICAgICAgICBDYXN0VyhfX2IpDQogICAgICAgIGVsc2VpZiBiX2IgPiBfYWIgYW5kIF9hYiA+IF9fYi5oZWFsdGggYW5kIFJTdGF0ZSgiVyIpIHRoZW4NCiAgICAgICAgICBDYXN0UlcoX19iKQ0KICAgICAgICBlbHNlaWYgYl9iID4gX19iLmhlYWx0aCBhbmQgUlN0YXRlKCJRIikgdGhlbg0KICAgICAgICAgIENhc3RSUShfX2IpDQogICAgICAgIGVsc2VpZiBlbmVtaWVzQnVmZnNbX19iLm5ldHdvcmtJRF0ucmVjZWl2ZWQgYW5kIGNfYiArIGJfYiA+IF9fYi5oZWFsdGggYW5kIFJTdGF0ZSgiUSIpIHRoZW4NCiAgICAgICAgICBDYXN0UlEoX19iKQ0KICAgICAgICBlbHNlaWYgYl9iICsgY19iICsgYV9iID4gX19iLmhlYWx0aCBhbmQgUXJlYWR5IGFuZCBScmVhZHkgdGhlbg0KICAgICAgICAgIENhc3RRKF9fYikNCiAgICAgICAgICBDYXN0UlEoX19iKQ0KICAgICAgICBlbmQNCiAgICAgIGVsc2VpZiBNZW51LmtpbGxzdGVhbC5raWxsc3RlYWxHYXAgYW5kIEdldERpc3RhbmNlU3FyKF9fYikgPj0gMzYwMDAwIGFuZCBHZXREaXN0YW5jZShfX2IpIDw9IFNwZWxscy5RLnJhbmdlICsgU3BlbGxzLlcucmFuZ2UgLSAxMjUgYW5kIElzV1JlYWR5KCkgYW5kIEhhc01hbmFUb0dhcENsb3NlKCkgdGhlbg0KICAgICAgICBpZiBhX2IgPiBfX2IuaGVhbHRoIHRoZW4NCiAgICAgICAgICBpZiBHYXBDbG9zZShfX2IpIHRoZW4NCiAgICAgICAgICAgIENhc3RRKF9fYikNCiAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZWlmIEdldERpc3RhbmNlKF9fYikgPCBTcGVsbHMuVy5yYW5nZSArIFNwZWxscy5XLnJhbmdlIC0gMTAwIGFuZCBiX2IgPiBfYWIgYW5kIF9hYiA+IF9fYi5oZWFsdGggYW5kIFJyZWFkeSB0aGVuDQogICAgICAgICAgaWYgR2FwQ2xvc2UoX19iKSBhbmQgUlN0YXRlKCJXIikgdGhlbg0KICAgICAgICAgICAgQ2FzdFJXKF9fYikNCiAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZWlmIE1lbnUua2lsbHN0ZWFsLmtpbGxzdGVhbFFSIGFuZCBiX2IgKyBjX2IgKyBhX2IgPiBfX2IuaGVhbHRoIGFuZCBRcmVhZHkgYW5kIFJyZWFkeSB0aGVuDQogICAgICAgICAgaWYgR2V0RGlzdGFuY2VTcXIoX19iKSA+PSBTcGVsbHMuUS5yYW5nZSAqIFNwZWxscy5RLnJhbmdlIGFuZCBHZXREaXN0YW5jZVNxcihfX2IpIDw9IChTcGVsbHMuUS5yYW5nZSArIFNwZWxscy5XLnJhbmdlIC0gMjAwKSAqIChTcGVsbHMuUS5yYW5nZSArIFNwZWxscy5XLnJhbmdlIC0gMjAwKSB0aGVuDQogICAgICAgICAgICBHYXBDbG9zZShfX2IpDQogICAgICAgICAgICBDYXN0UShfX2IpDQogICAgICAgICAgICBDYXN0UlEoX19iKQ0KICAgICAgICAgIGVsc2VpZiBHZXREaXN0YW5jZVNxcihfX2IpIDw9IFNwZWxscy5RLnJhbmdlICogU3BlbGxzLlEucmFuZ2UgdGhlbg0KICAgICAgICAgICAgQ2FzdFEoX19iKQ0KICAgICAgICAgICAgQ2FzdFJRKF9fYikNCiAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICBlbmQNCiAgICBlbmQNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIEdldE9yYlRhcmdldCgpDQogIGxvY2FsIGRkYSwgX19iDQogIGlmIGZvcmNlZFRhcmdldCBhbmQgR2V0RGlzdGFuY2VTcXIoZm9yY2VkVGFyZ2V0KSA8PSAoU3BlbGxzLlEucmFuZ2UgKyBTcGVsbHMuVy5yYW5nZSkgKiAoU3BlbGxzLlEucmFuZ2UgKyBTcGVsbHMuVy5yYW5nZSkgdGhlbg0KICAgIHJldHVybiBmb3JjZWRUYXJnZXQNCiAgZW5kDQogIGlmIHRhcmdldCBhbmQgdGFyZ2V0LnZpc2libGUgYW5kIG5vdCB0YXJnZXQuZGVhZCBhbmQgR2V0RGlzdGFuY2VTcXIodGFyZ2V0KSA8PSBTcGVsbHMuUS5yYW5nZSAqIFNwZWxscy5RLnJhbmdlIGFuZCAobm90IHRhYmxlLmNvbnRhaW5zKHByaW9yaXR5VGFibGUuQnJ1aXNlciwgdGFyZ2V0LmNoYXJOYW1lKSBhbmQgbm90IHRhYmxlLmNvbnRhaW5zKHByaW9yaXR5VGFibGUuVGFuaywgdGFyZ2V0LmNoYXJOYW1lKSBvciBJc0tpbGxhYmxlKHRhcmdldCkpIHRoZW4NCiAgICByZXR1cm4gdGFyZ2V0DQogIGVuZA0KICB0czp1cGRhdGUoKQ0KICB0c0xvbmc6dXBkYXRlKCkNCiAgZGRhID0gdHNMb25nLnRhcmdldA0KICBfX2IgPSBkZGENCiAgaWYgZGRhIHRoZW4NCiAgICBpZiBHZXREaXN0YW5jZShkZGEpID4gNzAwIGFuZCBDb3VudEVuZW15SGVyb0luUmFuZ2UoNjAwKSA+PSAzIGFuZCBub3QgdGFibGUuY29udGFpbnMocHJpb3JpdHlUYWJsZS5BUCwgZGRhLmNoYXJOYW1lKSBhbmQgbm90IHRhYmxlLmNvbnRhaW5zKHByaW9yaXR5VGFibGUuU3VwcG9ydCwgZGRhLmNoYXJOYW1lKSBhbmQgbm90IHRhYmxlLmNvbnRhaW5zKHByaW9yaXR5VGFibGUuQURfQ2FycnksIGRkYS5jaGFyTmFtZSkgdGhlbg0KICAgICAgZGRhID0gbmlsDQogICAgZWxzZQ0KICAgICAgbG9jYWwgYV9iID0gUXJlYWR5IGFuZCBTcGVsbERtZ0NhbGN1bGF0aW9ucygiUSIsIGRkYSkgb3IgMA0KICAgICAgbG9jYWwgYl9iID0gUXJlYWR5IGFuZCBSU3RhdGUoIlEiKSBhbmQgU3BlbGxEbWdDYWxjdWxhdGlvbnMoIlJRIiwgZGRhKSBvciAwDQogICAgICBsb2NhbCBjX2IgPSAoUXJlYWR5IG9yIFJyZWFkeSkgYW5kIFNwZWxsRG1nQ2FsY3VsYXRpb25zKCJRUHJvYyIsIGRkYSkgb3IgMA0KICAgICAgbG9jYWwgZF9iID0gUnJlYWR5IGFuZCBRcmVhZHkgYW5kIGFfYiArIGJfYiArIGNfYiBvciAwDQogICAgICBpZiBHZXREaXN0YW5jZShkZGEpID4gNzAwIGFuZCAzIDw9IENvdW50RW5lbXlIZXJvSW5SYW5nZSgzMDAsIGRkYSkgYW5kIGRfYiA8IGRkYS5oZWFsdGggdGhlbg0KICAgICAgICBkZGEgPSBuaWwNCiAgICAgIGVuZA0KICAgIGVuZA0KICAgIGlmIG5vdCBIYXNNYW5hVG9HYXBDbG9zZSgpIG9yIGRkYSA9PSBuaWwgdGhlbg0KICAgICAgZGRhID0gdHMudGFyZ2V0DQogICAgZW5kDQogICAgaWYgZGRhIGFuZCBHZXREaXN0YW5jZVNxcihkZGEpID49IDQ5MDAwMCBhbmQgdHMudGFyZ2V0IH49IG5pbCBhbmQgKHRhYmxlLmNvbnRhaW5zKHByaW9yaXR5VGFibGUuQVAsIHRzLnRhcmdldC5jaGFyTmFtZSkgb3IgdGFibGUuY29udGFpbnMocHJpb3JpdHlUYWJsZS5TdXBwb3J0LCB0cy50YXJnZXQuY2hhck5hbWUpIG9yIHRhYmxlLmNvbnRhaW5zKHByaW9yaXR5VGFibGUuQURfQ2FycnksIHRzLnRhcmdldC5jaGFyTmFtZSkpIHRoZW4NCiAgICAgIGRkYSA9IHRzLnRhcmdldA0KICAgIGVuZA0KICAgIGlmIGRkYSA9PSBuaWwgYW5kIF9fYiB+PSBuaWwgdGhlbg0KICAgICAgZGRhID0gX19iDQogICAgZW5kDQogICAgaWYgZGRhIGFuZCBJZ25pdGVXaWxsS2lsbEVuZW15KGRkYSkgdGhlbg0KICAgICAgZGRhID0gbmlsDQogICAgZW5kDQogICAgaWYgZGRhIGFuZCAoZGRhLnR5cGUgYW5kIGRkYS50eXBlIH49IG15SGVyby50eXBlIG9yIG5vdCBkZGEudHlwZSkgdGhlbg0KICAgICAgZGRhID0gbmlsDQogICAgZW5kDQogIGVuZA0KICBpZiBNZW51LmNvbWJvLmZvcmNlQURDIHRoZW4NCiAgICBsb2NhbCBhX2IgPSBmYWxzZQ0KICAgIGZvciBiX2IsIGNfYiBpbiBwYWlycyhHZXRFbmVteUhlcm9lcygpKSBkbw0KICAgICAgaWYgY19iIGFuZCBjX2IudHlwZSBhbmQgVmFsaWRUYXJnZXQoY19iLCBTcGVsbHMuRS5yYW5nZSkgYW5kIGNfYi52aXNpYmxlIGFuZCBub3QgY19iLmRlYWQgYW5kICh0YWJsZS5jb250YWlucyhwcmlvcml0eVRhYmxlLkFQLCBjX2IuY2hhck5hbWUpIG9yIHRhYmxlLmNvbnRhaW5zKHByaW9yaXR5VGFibGUuQURfQ2FycnksIGNfYi5jaGFyTmFtZSkpIHRoZW4NCiAgICAgICAgaWYgZGRhIGFuZCBJc0tpbGxhYmxlKGRkYSkgYW5kIG5vdCBJc0tpbGxhYmxlKGNfYikgdGhlbg0KICAgICAgICAgIGJyZWFrDQogICAgICAgIGVuZA0KICAgICAgICBkZGEgPSBjX2INCiAgICAgICAgYV9iID0gdHJ1ZQ0KICAgICAgICBicmVhaw0KICAgICAgZW5kDQogICAgZW5kDQogIGVuZA0KICByZXR1cm4gZGRhDQplbmQNCmZ1bmN0aW9uIFpob255YXMoKQ0KICBsb2NhbCBkZGEgPSBHZXRJbnZlbnRvcnlTbG90SXRlbSgzMTU3KQ0KICBpZiBkZGEgfj0gbmlsIGFuZCBteUhlcm86Q2FuVXNlU3BlbGwoZGRhKSA9PSBSRUFEWSBhbmQgbXlIZXJvLmhlYWx0aCAvIG15SGVyby5tYXhIZWFsdGggPD0gTWVudS5taXNjLnpob255YXMuemhvbnlhc3VuZGVyIHRoZW4NCiAgICBDYXN0U3BlbGwoZGRhKQ0KICBlbmQNCmVuZA0KZnVuY3Rpb24gVXNlSWduaXRlKCkNCiAgbG9jYWwgZGRhID0gNTAgKyAyMCAqIG15SGVyby5sZXZlbA0KICBmb3IgX19iLCBhX2IgaW4gcGFpcnMoR2V0RW5lbXlIZXJvZXMoKSkgZG8NCiAgICBpZiBhX2IgYW5kIEdldERpc3RhbmNlKGFfYiwgbXlIZXJvKSA8IDYwMCBhbmQgVmFsaWRUYXJnZXQoYV9iLCA2MDApIGFuZCBNZW51Lm1pc2MuYXV0b2lnbml0ZVthX2IuY2hhck5hbWVdIGFuZCBJcmVhZHkgYW5kIGRkYSA+IGFfYi5oZWFsdGggdGhlbg0KICAgICAgQ2FzdFNwZWxsKGlnbml0ZSwgYV9iKQ0KICAgIGVuZA0KICBlbmQNCmVuZA0KZnVuY3Rpb24gTWFuYU1hbmFnZXIoKQ0KICBpZiBteUhlcm8ubWFuYSAvIG15SGVyby5tYXhNYW5hIDw9IE1lbnUuaGFyYXNzLmhhcmFzc01hbmEgdGhlbg0KICAgIHJldHVybiBmYWxzZQ0KICBlbmQNCiAgcmV0dXJuIHRydWUNCmVuZA0KZnVuY3Rpb24gQ2hlY2tJZ25pdGUoKQ0KICBpZiBNZW51Lm1pc2MuY291bnRlckxvZ2ljLnVzZVBvdGlvbiBhbmQgaWduaXRlZFRhYmxlLmlnbml0ZWQgYW5kIGlnbml0ZWRUYWJsZS5zb3VyY2UgdGhlbg0KICAgIGxvY2FsIGRkYSA9IGlnbml0ZWRUYWJsZS50aW1lICsgNSAtIG9zLmNsb2NrKCkNCiAgICBpZiBkZGEgPCAwIHRoZW4NCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGxvY2FsIF9fYiA9IGRkYSAqICgxMCArIGlnbml0ZWRUYWJsZS5zb3VyY2UubGV2ZWwgKiA0KQ0KICAgIGlmIF9fYiA+IG15SGVyby5oZWFsdGggYW5kIF9fYiAtIDM3IDw9IG15SGVyby5oZWFsdGggb3IgX19iID49IG15SGVyby5oZWFsdGggKiAwLjMgdGhlbg0KICAgICAgbG9jYWwgYV9iID0gR2V0SW52ZW50b3J5U2xvdEl0ZW0oMjAwMykNCiAgICAgIGlmIGFfYiB+PSBuaWwgYW5kIG5vdCBoYXNQb3Rpb25BY3RpdmUgdGhlbg0KICAgICAgICBDYXN0U3BlbGwoYV9iKQ0KICAgICAgZW5kDQogICAgZW5kDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBJZ25pdGVXaWxsS2lsbE1lKCkNCiAgaWYgaWduaXRlZFRhYmxlLmlnbml0ZWQgYW5kIGlnbml0ZWRUYWJsZS5zb3VyY2UgYW5kIGlnbml0ZWRUYWJsZS5zb3VyY2UubGV2ZWwgdGhlbg0KICAgIGxvY2FsIGRkYSA9IGlnbml0ZWRUYWJsZS50aW1lICsgNSAtIG9zLmNsb2NrKCkNCiAgICBpZiBkZGEgPCAwIHRoZW4NCiAgICAgIHJldHVybg0KICAgIGVuZA0KICAgIGxvY2FsIF9fYiA9IGRkYSAqICgxMCArIGlnbml0ZWRUYWJsZS5zb3VyY2UubGV2ZWwgKiA0KQ0KICAgIGlmIF9fYiA+IG15SGVyby5oZWFsdGggdGhlbg0KICAgICAgaWYgbm90IGlnbml0ZWRUYWJsZS5oYXNTYWlkIHRoZW4NCiAgICAgICAgU2F5KGlnbml0ZWRUYWJsZS5zb3VyY2UuY2hhck5hbWUgLi4gIidzIGlnbml0ZSB3aWxsIGtpbGwgbWUuIikNCiAgICAgICAgaWduaXRlZFRhYmxlLmhhc1NhaWQgPSB0cnVlDQogICAgICBlbmQNCiAgICAgIGlmIG5vdCBpZ25pdGVkVGFibGUud2lsbEtpbGxNZSB0aGVuDQogICAgICAgIGlnbml0ZWRUYWJsZS53aWxsS2lsbE1lID0gdHJ1ZQ0KICAgICAgZW5kDQogICAgZWxzZQ0KICAgICAgaWYgaWduaXRlZFRhYmxlLmhhc1NhaWQgdGhlbg0KICAgICAgICBTYXkoaWduaXRlZFRhYmxlLnNvdXJjZS5jaGFyTmFtZSAuLiAiJ3MgaWduaXRlIHdpbGwgTk8gTE9OR0VSIGtpbGwgbWUuIikNCiAgICAgICAgaWduaXRlZFRhYmxlLmhhc1NhaWQgPSBmYWxzZQ0KICAgICAgZW5kDQogICAgICBpZiBpZ25pdGVkVGFibGUud2lsbEtpbGxNZSB0aGVuDQogICAgICAgIGlnbml0ZWRUYWJsZS53aWxsS2lsbE1lID0gZmFsc2UNCiAgICAgIGVuZA0KICAgIGVuZA0KICBlbHNlaWYgaWduaXRlZFRhYmxlLndpbGxLaWxsTWUgdGhlbg0KICAgIGlnbml0ZWRUYWJsZS53aWxsS2lsbE1lID0gZmFsc2UNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIFNldFByaW9yaXR5KGRkYSwgX19iLCBhX2IpDQogIGZvciBpID0gMSwgI2RkYSBkbw0KICAgIGlmIF9fYi5jaGFyTmFtZTpmaW5kKGRkYVtpXSkgfj0gbmlsIHRoZW4NCiAgICAgIFRTX1NldEhlcm9Qcmlvcml0eShhX2IsIF9fYi5jaGFyTmFtZSkNCiAgICBlbmQNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIGFycmFuZ2VQcmlvcml0eXMoKQ0KICBmb3IgZGRhLCBfX2IgaW4gaXBhaXJzKEdldEVuZW15SGVyb2VzKCkpIGRvDQogICAgU2V0UHJpb3JpdHkocHJpb3JpdHlUYWJsZS5BRF9DYXJyeSwgX19iLCAxKQ0KICAgIFNldFByaW9yaXR5KHByaW9yaXR5VGFibGUuQVAsIF9fYiwgMikNCiAgICBTZXRQcmlvcml0eShwcmlvcml0eVRhYmxlLlN1cHBvcnQsIF9fYiwgMykNCiAgICBTZXRQcmlvcml0eShwcmlvcml0eVRhYmxlLkJydWlzZXIsIF9fYiwgNCkNCiAgICBTZXRQcmlvcml0eShwcmlvcml0eVRhYmxlLlRhbmssIF9fYiwgNSkNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIGFycmFuZ2VQcmlvcml0eXNUVCgpDQogIGZvciBkZGEsIF9fYiBpbiBpcGFpcnMoR2V0RW5lbXlIZXJvZXMoKSkgZG8NCiAgICBTZXRQcmlvcml0eShwcmlvcml0eVRhYmxlLkFEX0NhcnJ5LCBfX2IsIDEpDQogICAgU2V0UHJpb3JpdHkocHJpb3JpdHlUYWJsZS5BUCwgX19iLCAxKQ0KICAgIFNldFByaW9yaXR5KHByaW9yaXR5VGFibGUuU3VwcG9ydCwgX19iLCAyKQ0KICAgIFNldFByaW9yaXR5KHByaW9yaXR5VGFibGUuQnJ1aXNlciwgX19iLCAyKQ0KICAgIFNldFByaW9yaXR5KHByaW9yaXR5VGFibGUuVGFuaywgX19iLCAzKQ0KICBlbmQNCmVuZA0KZnVuY3Rpb24gVXNlSXRlbXMoZGRhKQ0KICBpZiBkZGEgfj0gbmlsIHRoZW4NCiAgICBmb3IgX19iLCBhX2IgaW4gcGFpcnMoSXRlbXMpIGRvDQogICAgICBhX2Iuc2xvdCA9IEdldEludmVudG9yeVNsb3RJdGVtKGFfYi5pZCkNCiAgICAgIGlmIGFfYi5zbG90IH49IG5pbCBhbmQgbXlIZXJvOkNhblVzZVNwZWxsKGFfYi5zbG90KSA9PSBSRUFEWSB0aGVuDQogICAgICAgIGlmIGFfYi5yZXFUYXJnZXQgYW5kIEdldERpc3RhbmNlKGRkYSkgPCBhX2IucmFuZ2UgdGhlbg0KICAgICAgICAgIENhc3RTcGVsbChhX2Iuc2xvdCwgZGRhKQ0KICAgICAgICBlbHNlaWYgbm90IGFfYi5yZXFUYXJnZXQgYW5kIEdldERpc3RhbmNlKGRkYSkgLSBnZXRIaXRCb3hSYWRpdXMobXlIZXJvKSAtIGdldEhpdEJveFJhZGl1cyhkZGEpIDwgNTAgdGhlbg0KICAgICAgICAgIENhc3RTcGVsbChhX2Iuc2xvdCkNCiAgICAgICAgZW5kDQogICAgICBlbmQNCiAgICBlbmQNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIENhbGNEYW1hZ2UoKQ0KICBmb3IgZGRhLCBfX2IgaW4gcGFpcnMoR2V0RW5lbXlIZXJvZXMoKSkgZG8NCiAgICBpZiBfX2IgYW5kIGlzS2lsbGVkW19fYi5uZXR3b3JrSURdIGFuZCBpc0tpbGxlZFtfX2IubmV0d29ya0lEXSA9PSB0cnVlIHRoZW4NCiAgICAgIGlmIF9fYi5kZWFkIHRoZW4NCiAgICAgICAgaXNLaWxsZWRbX19iLm5ldHdvcmtJRF0gPSBmYWxzZQ0KICAgICAgZWxzZWlmIHRhcmdldCBhbmQgX19iLm5ldHdvcmtJRCB+PSB0YXJnZXQubmV0d29ya0lEIHRoZW4NCiAgICAgICAgaXNLaWxsZWRbX19iLm5ldHdvcmtJRF0gPSBmYWxzZQ0KICAgICAgZWxzZWlmIG15SGVyby5oZWFsdGggLyBteUhlcm8ubWF4SGVhbHRoIDw9IDAuMjUgdGhlbg0KICAgICAgICBpc0tpbGxlZFtfX2IubmV0d29ya0lEXSA9IGZhbHNlDQogICAgICBlbmQNCiAgICBlbmQNCiAgICBpZiBlbmVtaWVzQnVmZnNbX19iLm5ldHdvcmtJRF0ucmVjZWl2ZWQgYW5kIGVuZW1pZXNCdWZmc1tfX2IubmV0d29ya0lEXS5yZWNlaXZlZCA9PSB0cnVlIGFuZCBlbmVtaWVzQnVmZnNbX19iLm5ldHdvcmtJRF0uZW5kVGltZSBhbmQgZW5lbWllc0J1ZmZzW19fYi5uZXR3b3JrSURdLmVuZFRpbWUgPCBvcy5jbG9jaygpIHRoZW4NCiAgICAgIGVuZW1pZXNCdWZmc1tfX2IubmV0d29ya0lEXS5yZWNlaXZlZCA9IGZhbHNlDQogICAgZW5kDQogICAgaWYgX19iIGFuZCBWYWxpZFRhcmdldChfX2IsIDMwMDApIHRoZW4NCiAgICAgIGxvY2FsIGFfYiA9IFNwZWxsRG1nQ2FsY3VsYXRpb25zKCJRIiwgX19iKSBvciAwDQogICAgICBsb2NhbCBiX2IgPSBSU3RhdGUoIlEiKSBhbmQgU3BlbGxEbWdDYWxjdWxhdGlvbnMoIlJRIiwgX19iKSBvciAwDQogICAgICBsb2NhbCBjX2IgPSAoUXJlYWR5IG9yIFJyZWFkeSBhbmQgUlN0YXRlKCJRIikpIGFuZCBTcGVsbERtZ0NhbGN1bGF0aW9ucygiUVByb2MiLCBfX2IpIG9yIDANCiAgICAgIGxvY2FsIGRfYiA9IElzV1JlYWR5KCkgYW5kIFNwZWxsRG1nQ2FsY3VsYXRpb25zKCJXIiwgX19iKSBvciAwDQogICAgICBsb2NhbCBfYWIgPSBub3Qgd3JVc2VkKCkgYW5kIFJTdGF0ZSgiVyIpIGFuZCBTcGVsbERtZ0NhbGN1bGF0aW9ucygiUlciLCBfX2IpIG9yIDANCiAgICAgIGxvY2FsIGFhYiA9IFNwZWxsRG1nQ2FsY3VsYXRpb25zKCJFIiwgX19iKSBvciAwDQogICAgICBsb2NhbCBiYWIgPSA1MCArIDIwICogbXlIZXJvLmxldmVsIG9yIDANCiAgICAgIGlmIG15SGVyby5kYW1hZ2UgPiBfX2IuaGVhbHRoIHRoZW4NCiAgICAgICAgS2lsbFRleHRbX19iLm5ldHdvcmtJRF0gPSAiTVVSREVSIEhJTSINCiAgICAgIGVsc2VpZiBRcmVhZHkgYW5kIGFfYiA8IGRfYiBhbmQgYV9iID4gX19iLmhlYWx0aCB0aGVuDQogICAgICAgIEtpbGxUZXh0W19fYi5uZXR3b3JrSURdID0gIlEgPSBraWxsIg0KICAgICAgZWxzZWlmIElzV1JlYWR5KCkgYW5kIGRfYiA+IF9fYi5oZWFsdGggdGhlbg0KICAgICAgICBLaWxsVGV4dFtfX2IubmV0d29ya0lEXSA9ICJXID0ga2lsbCINCiAgICAgIGVsc2VpZiBFcmVhZHkgYW5kIGFhYiA+IF9fYi5oZWFsdGggdGhlbg0KICAgICAgICBLaWxsVGV4dFtfX2IubmV0d29ya0lEXSA9ICJFID0ga2lsbCINCiAgICAgIGVsc2VpZiBRcmVhZHkgYW5kIElyZWFkeSBhbmQgYV9iICsgYmFiID4gX19iLmhlYWx0aCB0aGVuDQogICAgICAgIEtpbGxUZXh0W19fYi5uZXR3b3JrSURdID0gIlEgKyBJZ25pdGUgPSBraWxsIg0KICAgICAgZWxzZWlmIElzV1JlYWR5KCkgYW5kIElyZWFkeSBhbmQgZF9iICsgYmFiID4gX19iLmhlYWx0aCB0aGVuDQogICAgICAgIEtpbGxUZXh0W19fYi5uZXR3b3JrSURdID0gIlcgKyBJZ25pdGUgPSBraWxsIg0KICAgICAgZWxzZWlmIElzV1JlYWR5KCkgYW5kIFFyZWFkeSBhbmQgYV9iICsgY19iICsgZF9iID4gX19iLmhlYWx0aCB0aGVuDQogICAgICAgIEtpbGxUZXh0W19fYi5uZXR3b3JrSURdID0gIlEgKyBXID0ga2lsbCINCiAgICAgIGVsc2VpZiBRcmVhZHkgYW5kIEVyZWFkeSBhbmQgZF9iICsgYWFiID4gX19iLmhlYWx0aCB0aGVuDQogICAgICAgIEtpbGxUZXh0W19fYi5uZXR3b3JrSURdID0gIlEgKyBFID0ga2lsbCINCiAgICAgIGVsc2VpZiBRcmVhZHkgYW5kIFJyZWFkeSBhbmQgYV9iICsgYl9iICsgY19iID4gX19iLmhlYWx0aCB0aGVuDQogICAgICAgIEtpbGxUZXh0W19fYi5uZXR3b3JrSURdID0gIlEgKyBSID0ga2lsbCINCiAgICAgIGVsc2VpZiBJc1dSZWFkeSgpIGFuZCBScmVhZHkgYW5kIGRfYiArIF9hYiA+IF9fYi5oZWFsdGggdGhlbg0KICAgICAgICBLaWxsVGV4dFtfX2IubmV0d29ya0lEXSA9ICJXICsgUiA9IGtpbGwiDQogICAgICBlbHNlaWYgUXJlYWR5IGFuZCBScmVhZHkgYW5kIElyZWFkeSBhbmQgYV9iICsgYl9iICsgY19iICsgYmFiID4gX19iLmhlYWx0aCB0aGVuDQogICAgICAgIEtpbGxUZXh0W19fYi5uZXR3b3JrSURdID0gIlEgKyBSICsgSWduaXRlID0ga2lsbCINCiAgICAgIGVsc2VpZiBRcmVhZHkgYW5kIElzV1JlYWR5KCkgYW5kIFJyZWFkeSBhbmQgYV9iICsgY19iICsgZF9iICsgX2FiID4gX19iLmhlYWx0aCB0aGVuDQogICAgICAgIEtpbGxUZXh0W19fYi5uZXR3b3JrSURdID0gIlEgKyBXICsgUiA9IGtpbGwiDQogICAgICBlbHNlaWYgUXJlYWR5IGFuZCBScmVhZHkgYW5kIElzV1JlYWR5KCkgYW5kIGFfYiArIGJfYiArIGNfYiArIGNfYiArIGRfYiA+IF9fYi5oZWFsdGggdGhlbg0KICAgICAgICBLaWxsVGV4dFtfX2IubmV0d29ya0lEXSA9ICJRICsgUiArIFcgPSBraWxsIg0KICAgICAgZWxzZWlmIFFyZWFkeSBhbmQgSXNXUmVhZHkoKSBhbmQgUnJlYWR5IGFuZCBJcmVhZHkgYW5kIGFfYiArIGNfYiArIGRfYiArIF9hYiArIGJhYiA+IF9fYi5oZWFsdGggdGhlbg0KICAgICAgICBLaWxsVGV4dFtfX2IubmV0d29ya0lEXSA9ICJRICsgVyArIFIgKyBJZ25pdGUgPSBraWxsIg0KICAgICAgZWxzZWlmIFFyZWFkeSBhbmQgSXNXUmVhZHkoKSBhbmQgSXJlYWR5IGFuZCBhX2IgKyBiX2IgKyBjX2IgKyBjX2IgKyBkX2IgKyBiYWIgPiBfX2IuaGVhbHRoIHRoZW4NCiAgICAgICAgS2lsbFRleHRbX19iLm5ldHdvcmtJRF0gPSAiUSArIFIgKyBXICsgSWduaXRlID0ga2lsbCINCiAgICAgIGVsc2VpZiBRcmVhZHkgYW5kIFJyZWFkeSBhbmQgSXNXUmVhZHkoKSBhbmQgRXJlYWR5IGFuZCBhX2IgKyBiX2IgKyBjX2IgKyBjX2IgKyBkX2IgKyBhYWIgPiBfX2IuaGVhbHRoIHRoZW4NCiAgICAgICAgS2lsbFRleHRbX19iLm5ldHdvcmtJRF0gPSAiUSArIFIgKyBXICsgRSA9IGtpbGwiDQogICAgICBlbHNlaWYgSXNXUmVhZHkoKSBhbmQgUXJlYWR5IGFuZCBScmVhZHkgYW5kIEVyZWFkeSBhbmQgYV9iICsgY19iICsgZF9iICsgX2FiICsgYWFiID4gX19iLmhlYWx0aCB0aGVuDQogICAgICAgIEtpbGxUZXh0W19fYi5uZXR3b3JrSURdID0gIlEgKyBXICsgUiArIEUgPSBraWxsIg0KICAgICAgZWxzZWlmIFFyZWFkeSBhbmQgUnJlYWR5IGFuZCBFcmVhZHkgYW5kIElzV1JlYWR5KCkgYW5kIElyZWFkeSBhbmQgYV9iICsgYl9iICsgY19iICsgY19iICsgZF9iICsgYWFiICsgYmFiID4gX19iLmhlYWx0aCB0aGVuDQogICAgICAgIEtpbGxUZXh0W19fYi5uZXR3b3JrSURdID0gIlEgKyBSICsgVyArIEUgKyBJZ25pdGUgPSBraWxsIg0KICAgICAgZWxzZWlmIFFyZWFkeSBhbmQgUnJlYWR5IGFuZCBFcmVhZHkgYW5kIElzV1JlYWR5KCkgYW5kIElyZWFkeSBhbmQgYV9iICsgY19iICsgZF9iICsgX2FiICsgYWFiICsgYmFiID4gX19iLmhlYWx0aCB0aGVuDQogICAgICAgIEtpbGxUZXh0W19fYi5uZXR3b3JrSURdID0gIlEgKyBXICsgUiArIEUgKyBJZ25pdGUgPSBraWxsIg0KICAgICAgZWxzZWlmIFFyZWFkeSBvciBJc1dSZWFkeSgpIG9yIEVyZWFkeSB0aGVuDQogICAgICAgIEtpbGxUZXh0W19fYi5uZXR3b3JrSURdID0gIkhhcmFzcyBoaW0hIg0KICAgICAgZWxzZQ0KICAgICAgICBLaWxsVGV4dFtfX2IubmV0d29ya0lEXSA9ICJTcGVsbHMgb24gQ0QiDQogICAgICBlbmQNCiAgICBlbmQNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIGdldEhpdEJveFJhZGl1cyhkZGEpDQogIHJldHVybiBHZXREaXN0YW5jZShkZGEubWluQkJveCwgZGRhLm1heEJCb3gpIC8gMg0KZW5kDQpmdW5jdGlvbiBDYW5QZXJtZm9ybUtpbGxTdGVhbCgpDQogIHJldHVybiBNZW51LmtpbGxzdGVhbC5raWxsc3RlYWwgYW5kIChNZW51LmtpbGxzdGVhbC5raWxsU3RlYWxFeGNlY3V0ZSA9PSAxIG9yIE1lbnUua2lsbHN0ZWFsLmtpbGxTdGVhbEV4Y2VjdXRlID09IDIgYW5kIG5vdCBNZW51LmtleXNldHRpbmdzLnVzZUNvbWJvIGFuZCBub3QgTWVudS5rZXlzZXR0aW5ncy51c2VDb21ib0dhcENsb3NlIGFuZCBub3QgTWVudS5rZXlzZXR0aW5ncy51c2VDb21ib0NoYWluIG9yIE1lbnUua2lsbHN0ZWFsLmtpbGxTdGVhbEV4Y2VjdXRlID09IDMgYW5kIG5vdCBNZW51LmtleXNldHRpbmdzLnVzZUNvbWJvIGFuZCBub3QgTWVudS5rZXlzZXR0aW5ncy51c2VMYW5lQ2xlYXIgYW5kIG5vdCBNZW51LmtleXNldHRpbmdzLnVzZUNvbWJvR2FwQ2xvc2UgYW5kIG5vdCBNZW51LmtleXNldHRpbmdzLnVzZUNvbWJvQ2hhaW4gYW5kIG5vdCBNZW51LmtleXNldHRpbmdzLnVzZUZhcm0gYW5kIG5vdCBNZW51LmtleXNldHRpbmdzLnVzZUhhcmFzcykNCmVuZA0KZnVuY3Rpb24gRHJhd01lbnUoKQ0KICBNZW51ID0gc2NyaXB0Q29uZmlnKCJUb3RhbGx5IExlQmxhbmMgLSBUb3RhbGx5IExlZ2l0IiwgIlRvdGFsbHlMZUJsYW5jLmNmZyIpDQogIGxvY2FsIGRkYSA9ICJUb3RhbGx5IExlQmxhbmMgIC0gICINCiAgTWVudTphZGRTdWJNZW51KGRkYSAuLiAiS2V5IFNldHRpbmdzIiwgImtleXNldHRpbmdzIikNCiAgTWVudS5rZXlzZXR0aW5nczphZGRQYXJhbSgiaW5mbzEzIiwgIiIsIFNDUklQVF9QQVJBTV9JTkZPLCAiQ29tYm8iKQ0KICBNZW51LmtleXNldHRpbmdzOmFkZFBhcmFtKCJ1c2VDb21ibyIsICJDb21ibyBLZXkiLCBTQ1JJUFRfUEFSQU1fT05LRVlET1dOLCBmYWxzZSwgMzIpDQogIE1lbnUua2V5c2V0dGluZ3M6YWRkUGFyYW0oInVzZUNvbWJvR2FwQ2xvc2UiLCAiQ29tYm8gR2FwQ2xvc2UgS2V5IiwgU0NSSVBUX1BBUkFNX09OS0VZRE9XTiwgZmFsc2UsIHN0cmluZy5ieXRlKCJNIikpDQogIE1lbnUua2V5c2V0dGluZ3M6YWRkUGFyYW0oInVzZUNvbWJvQ2hhaW4iLCAiQ29tYm8gQ2hhaW4gS2V5IiwgU0NSSVBUX1BBUkFNX09OS0VZRE9XTiwgZmFsc2UsIHN0cmluZy5ieXRlKCJZIikpDQogIE1lbnUua2V5c2V0dGluZ3M6YWRkUGFyYW0oImluZm8xNCIsICIiLCBTQ1JJUFRfUEFSQU1fSU5GTywgIkhhcmFzcyIpDQogIE1lbnUua2V5c2V0dGluZ3M6YWRkUGFyYW0oInVzZUhhcmFzcyIsICJIYXJhc3MgS2V5IiwgU0NSSVBUX1BBUkFNX09OS0VZRE9XTiwgZmFsc2UsIHN0cmluZy5ieXRlKCJUIikpDQogIE1lbnUua2V5c2V0dGluZ3M6YWRkUGFyYW0oImluZm8xNSIsICIiLCBTQ1JJUFRfUEFSQU1fSU5GTywgIkxhbmVDbGVhciIpDQogIE1lbnUua2V5c2V0dGluZ3M6YWRkUGFyYW0oInVzZUxhbmVDbGVhciIsICJMYW5lQ2xlYXIgS2V5IiwgU0NSSVBUX1BBUkFNX09OS0VZRE9XTiwgZmFsc2UsIHN0cmluZy5ieXRlKCJLIikpDQogIE1lbnUua2V5c2V0dGluZ3M6YWRkUGFyYW0oImluZm8xNiIsICIiLCBTQ1JJUFRfUEFSQU1fSU5GTywgIkZhcm0iKQ0KICBNZW51LmtleXNldHRpbmdzOmFkZFBhcmFtKCJ1c2VGYXJtIiwgIkZhcm0gS2V5IiwgU0NSSVBUX1BBUkFNX09OS0VZVE9HR0xFLCBmYWxzZSwgc3RyaW5nLmJ5dGUoIkwiKSkNCiAgTWVudTphZGRTdWJNZW51KGRkYSAuLiAiQ29tYm8iLCAiY29tYm8iKQ0KICBNZW51LmNvbWJvOmFkZFN1Yk1lbnUoU3BlbGxzLkUubmFtZSAuLiAiIChFKSIsICJlc2V0dGluZ3MiKQ0KICBNZW51LmNvbWJvLmVzZXR0aW5nczphZGRQYXJhbSgicmFuZ2UiLCAiTWF4IHJhbmdlOiIsIFNDUklQVF9QQVJBTV9TTElDRSwgU3BlbGxzLkUucmFuZ2UsIDAsIFNwZWxscy5FLnJhbmdlLCAwKQ0KICBNZW51LmNvbWJvLmVzZXR0aW5nczphZGRQYXJhbSgid2lkdGgiLCAiTWluIHdpZHRoOiIsIFNDUklQVF9QQVJBTV9TTElDRSwgU3BlbGxzLkUucmFkaXVzLCA5MCwgMjAwLCAwKQ0KICBNZW51LmNvbWJvLmVzZXR0aW5nczphZGRQYXJhbSgiZHJhdyIsICJEcmF3IHJhbmdlIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCBmYWxzZSkNCiAgTWVudS5jb21ibzphZGRQYXJhbSgiaW5mbzEyIiwgIiIsIFNDUklQVF9QQVJBTV9JTkZPLCAiIikNCiAgTWVudS5jb21ibzphZGRQYXJhbSgiY29tYm9XYXkiLCAiUGVyZm9ybSBDb21ibzoiLCBTQ1JJUFRfUEFSQU1fTElTVCwgMSwgew0KICAgICJTbWFydCIsDQogICAgIlFSV0UiLA0KICAgICJRV1JFIiwNCiAgICAiV1FSRSIsDQogICAgIldSUUUiDQogIH0pDQogIE1lbnUuY29tYm86YWRkUGFyYW0oImluZm84IiwgIiIsIFNDUklQVF9QQVJBTV9JTkZPLCAiIikNCiAgTWVudS5jb21ibzphZGRQYXJhbSgiY29tYm9JdGVtcyIsICJVc2UgSXRlbXMiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQogIE1lbnUuY29tYm86YWRkUGFyYW0oImNvbWJvQUEiLCAiVXNlIEFBcyIsIFNDUklQVF9QQVJBTV9PTk9GRiwgdHJ1ZSkNCiAgTWVudS5jb21ibzphZGRQYXJhbSgiY29tYm9HYXAiLCAiVXNlIFcgdG8gR2FwQ2xvc2UiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQogIE1lbnUuY29tYm86YWRkUGFyYW0oImluZm85IiwgIiIsIFNDUklQVF9QQVJBTV9JTkZPLCAiIikNCiAgTWVudS5jb21ibzphZGRQYXJhbSgic2VsZWN0ZWRUYXJnZXQiLCAiRm9jdXMgU2VsZWN0ZWQgVGFyZ2V0IiwgU0NSSVBUX1BBUkFNX09OT0ZGLCB0cnVlKQ0KICBNZW51LmNvbWJvOmFkZFBhcmFtKCJmb3JjZUFEQyIsICJGb3JjZSBBREMvQVBDIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCBmYWxzZSkNCiAgTWVudTphZGRTdWJNZW51KGRkYSAuLiAiU2V0dGluZ3M6IFciLCAic2V0dGluZ3NXIikNCiAgTWVudS5zZXR0aW5nc1c6YWRkUGFyYW0oInVzZU9wdGlvbmFsIiwgIlVzZSBPcHRpb25hbCBXIFNldHRpbmdzIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCB0cnVlKQ0KICBNZW51LnNldHRpbmdzVzphZGRQYXJhbSgidXNlT3B0aW9uYWxXIiwgIlJldHVybjogIiwgU0NSSVBUX1BBUkFNX0xJU1QsIDEsIHsNCiAgICAiU21hcnQiLA0KICAgICJUYXJnZXQgZGVhZCIsDQogICAgIlNraWxscyB1c2VkIiwNCiAgICAiQm90aCINCiAgfSkNCiAgTWVudTphZGRTdWJNZW51KGRkYSAuLiAiSGFyYXNzIiwgImhhcmFzcyIpDQogIE1lbnUuaGFyYXNzOmFkZFBhcmFtKCJoYXJhc3NRIiwgIlVzZSAiIC4uIFNwZWxscy5RLm5hbWUgLi4gIiAoUSkiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQogIE1lbnUuaGFyYXNzOmFkZFBhcmFtKCJoYXJhc3NXIiwgIlVzZSAiIC4uIFNwZWxscy5XLm5hbWUgLi4gIiAoVykiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIGZhbHNlKQ0KICBNZW51LmhhcmFzczphZGRQYXJhbSgiaGFyYXNzRSIsICJVc2UgIiAuLiBTcGVsbHMuRS5uYW1lIC4uICIgKEUpIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCBmYWxzZSkNCiAgTWVudS5oYXJhc3M6YWRkUGFyYW0oImluZm84IiwgIiIsIFNDUklQVF9QQVJBTV9JTkZPLCAiIikNCiAgTWVudS5oYXJhc3M6YWRkUGFyYW0oImhhcmFzc01hbmEiLCAiTWFuYSBNYW5hZ2VyICUiLCBTQ1JJUFRfUEFSQU1fU0xJQ0UsIDAuMjUsIDAsIDEsIDIpDQogIE1lbnU6YWRkU3ViTWVudShkZGEgLi4gIkZhcm1pbmciLCAiZmFybSIpDQogIE1lbnUuZmFybTphZGRQYXJhbSgiZmFybVEiLCAiVXNlICIgLi4gU3BlbGxzLlEubmFtZSAuLiAiIChRKSIsIFNDUklQVF9QQVJBTV9PTk9GRiwgdHJ1ZSkNCiAgTWVudS5mYXJtOmFkZFBhcmFtKCJmYXJtVyIsICJVc2UgIiAuLiBTcGVsbHMuVy5uYW1lIC4uICIgKFcpIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCB0cnVlKQ0KICBNZW51LmZhcm06YWRkUGFyYW0oImZhcm1SYW5nZSIsICJNaW5pb25zIG91dHNpZGUgQUEgcmFuZ2Ugb25seSIsIFNDUklQVF9QQVJBTV9PTk9GRiwgZmFsc2UpDQogIE1lbnUuZmFybTphZGRQYXJhbSgiZmFybUFBIiwgIkZhcm0gaWYgQUEgaXMgb24gQ0QiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIGZhbHNlKQ0KICBNZW51OmFkZFN1Yk1lbnUoZGRhIC4uICJMYW5lY2xlYXIiLCAibGFuZWNsZWFyIikNCiAgTWVudS5sYW5lY2xlYXI6YWRkUGFyYW0oImxhbmVjbGVhclEiLCAiVXNlICIgLi4gU3BlbGxzLlEubmFtZSAuLiAiIChRKSIsIFNDUklQVF9QQVJBTV9PTk9GRiwgdHJ1ZSkNCiAgTWVudS5sYW5lY2xlYXI6YWRkUGFyYW0oImxhbmVjbGVhclciLCAiVXNlICIgLi4gU3BlbGxzLlcubmFtZSAuLiAiIChXKSIsIFNDUklQVF9QQVJBTV9PTk9GRiwgdHJ1ZSkNCiAgTWVudS5sYW5lY2xlYXI6YWRkUGFyYW0oImxhbmVjbGVhclIiLCAiVXNlICIgLi4gU3BlbGxzLlIubmFtZSAuLiAiIChSKSIsIFNDUklQVF9QQVJBTV9PTk9GRiwgZmFsc2UpDQogIE1lbnUubGFuZWNsZWFyOmFkZFBhcmFtKCJpbmZvNyIsICIiLCBTQ1JJUFRfUEFSQU1fSU5GTywgIiIpDQogIE1lbnUubGFuZWNsZWFyOmFkZFBhcmFtKCJsYW5lY2xlYXJXQW1vdW50IiwgIk1pbiBtaW5pb25zIHRvIFdSIiwgU0NSSVBUX1BBUkFNX1NMSUNFLCA1LCAwLCAzMCwgMCkNCiAgTWVudS5sYW5lY2xlYXI6YWRkUGFyYW0oImxhbmVjbGVhclJBbW91bnQiLCAiTWluIG1pbmlvbnMgdG8gV1IiLCBTQ1JJUFRfUEFSQU1fU0xJQ0UsIDUsIDAsIDMwLCAwKQ0KICBNZW51LmxhbmVjbGVhcjphZGRQYXJhbSgibGFuZWNsZWFyV1JBbW91bnQiLCAiTWluIG1pbmlvbnMgdG8gVyBhbmQgV1IiLCBTQ1JJUFRfUEFSQU1fU0xJQ0UsIDUsIDAsIDMwLCAwKQ0KICBNZW51OmFkZFN1Yk1lbnUoZGRhIC4uICJLaWxsU3RlYWwiLCAia2lsbHN0ZWFsIikNCiAgTWVudS5raWxsc3RlYWw6YWRkUGFyYW0oImtpbGxzdGVhbCIsICJVc2UgS2lsbFN0ZWFsIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCB0cnVlKQ0KICBNZW51LmtpbGxzdGVhbDphZGRQYXJhbSgia2lsbFN0ZWFsRXhjZWN1dGUiLCAiRXhjZWN1dGUiLCBTQ1JJUFRfUEFSQU1fTElTVCwgMSwgew0KICAgICJBbHdheXMiLA0KICAgICJOb3QgaW4gQ29tYm8iLA0KICAgICJObyBvdGhlciBtb2RlIGFjdGl2ZSINCiAgfSkNCiAgTWVudS5raWxsc3RlYWw6YWRkUGFyYW0oImtpbGxzdGVhbEdhcCIsICJHYXBDbG9zZSB0byBraWxsIGVuZW15IiwgU0NSSVBUX1BBUkFNX09OT0ZGLCBmYWxzZSkNCiAgTWVudS5raWxsc3RlYWw6YWRkUGFyYW0oImluZm8zIiwgIiIsIFNDUklQVF9QQVJBTV9JTkZPLCAiIikNCiAgTWVudS5raWxsc3RlYWw6YWRkUGFyYW0oImtpbGxzdGVhbFEiLCAiVXNlICIgLi4gU3BlbGxzLlEubmFtZSAuLiAiIChRKSIsIFNDUklQVF9QQVJBTV9PTk9GRiwgdHJ1ZSkNCiAgTWVudS5raWxsc3RlYWw6YWRkUGFyYW0oImtpbGxzdGVhbFciLCAiVXNlICIgLi4gU3BlbGxzLlcubmFtZSAuLiAiIChXKSIsIFNDUklQVF9QQVJBTV9PTk9GRiwgdHJ1ZSkNCiAgTWVudS5raWxsc3RlYWw6YWRkUGFyYW0oImtpbGxzdGVhbFIiLCAiVXNlICIgLi4gU3BlbGxzLlIubmFtZSAuLiAiIChSKSIsIFNDUklQVF9QQVJBTV9PTk9GRiwgZmFsc2UpDQogIE1lbnUua2lsbHN0ZWFsOmFkZFBhcmFtKCJraWxsc3RlYWxRUiIsICJHYXBjbG9zZSA+IFEgKyBSIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCB0cnVlKQ0KICBNZW51LmtpbGxzdGVhbDphZGRQYXJhbSgiaW5mbzEwIiwgIiIsIFNDUklQVF9QQVJBTV9JTkZPLCAiIikNCiAgTWVudS5raWxsc3RlYWw6YWRkU3ViTWVudSgiS2lsbFN0ZWFsIEVuZW15IiwgImVuZW1pZXMiKQ0KICBmb3IgX19iLCBhX2IgaW4gcGFpcnMoR2V0RW5lbXlIZXJvZXMoKSkgZG8NCiAgICBNZW51LmtpbGxzdGVhbC5lbmVtaWVzOmFkZFBhcmFtKGFfYi5jaGFyTmFtZSwgYV9iLmNoYXJOYW1lLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQogIGVuZA0KICBNZW51OmFkZFN1Yk1lbnUoZGRhIC4uICJEcmF3aW5ncyIsICJkcmF3aW5ncyIpDQogIE1lbnUuZHJhd2luZ3M6YWRkU3ViTWVudSgiTGFnLUZyZWUgQ2lyY2xlcyIsICJsZmMiKQ0KICBNZW51LmRyYXdpbmdzLmxmYzphZGRQYXJhbSgidXNlTEZDIiwgIlVzZSBMYWctRnJlZSBDaXJjbGVzIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCBmYWxzZSkNCiAgTWVudS5kcmF3aW5ncy5sZmM6YWRkUGFyYW0oIkNMIiwgIkxlbmd0aCBiZWZvcmUgU25hcHBpbmciLCBTQ1JJUFRfUEFSQU1fU0xJQ0UsIDMwMCwgNzUsIDIwMDAsIDApDQogIE1lbnUuZHJhd2luZ3M6YWRkUGFyYW0oImRyYXciLCAiVXNlIERyYXdpbmdzIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCB0cnVlKQ0KICBNZW51LmRyYXdpbmdzOmFkZFBhcmFtKCJkcmF3USIsICJEcmF3ICIgLi4gU3BlbGxzLlEubmFtZSAuLiAiIChRKSIsIFNDUklQVF9QQVJBTV9PTk9GRiwgdHJ1ZSkNCiAgTWVudS5kcmF3aW5nczphZGRQYXJhbSgiZHJhd1ciLCAiRHJhdyAiIC4uIFNwZWxscy5XLm5hbWUgLi4gIiAoVykiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQogIE1lbnUuZHJhd2luZ3M6YWRkUGFyYW0oImRyYXdFIiwgIkRyYXcgIiAuLiBTcGVsbHMuRS5uYW1lIC4uICIgKEUpIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCB0cnVlKQ0KICBNZW51LmRyYXdpbmdzOmFkZFBhcmFtKCJpbmZvMTEiLCAiIiwgU0NSSVBUX1BBUkFNX0lORk8sICIiKQ0KICBNZW51LmRyYXdpbmdzOmFkZFBhcmFtKCJkcmF3S2lsbGFibGUiLCAiRHJhdyBLaWxsYWJsZSBUZXh0IiwgU0NSSVBUX1BBUkFNX09OT0ZGLCB0cnVlKQ0KICBNZW51LmRyYXdpbmdzOmFkZFBhcmFtKCJkcmF3S2lsbGFibGVXaWR0aCIsICJEcmF3IEtpbGxhYmxlIFdpZHRoIiwgU0NSSVBUX1BBUkFNX1NMSUNFLCAxMCwgNSwgMjAsIDApDQogIE1lbnUuZHJhd2luZ3M6YWRkUGFyYW0oImRyYXdUYXJnZXQiLCAiRHJhdyBUYXJnZXQiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQogIE1lbnUuZHJhd2luZ3M6YWRkUGFyYW0oImRyYXdTcGVsbFJlYWR5IiwgIkRvbid0IGRyYXcgaWYgc3BlbGwgaXMgQ0QiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIGZhbHNlKQ0KICBNZW51OmFkZFN1Yk1lbnUoZGRhIC4uICJQcmVkaWN0aW9uIiwgInByZWRpY3Rpb24iKQ0KICBpZiBiY2EgYW5kIGNjYSBhbmQgYWRhIGFuZCBzUHJlZExvYWRlZCB0aGVuDQogICAgTWVudS5wcmVkaWN0aW9uOmFkZFBhcmFtKCJ1c2VQcmVkaWN0aW9uIiwgIlByZWRpY3Rpb24gVHlwZToiLCBTQ1JJUFRfUEFSQU1fTElTVCwgMSwgew0KICAgICAgIlZQcmVkaWN0aW9uIiwNCiAgICAgICJEaXZpbmVQcmVkaWN0aW9uIiwNCiAgICAgICJIUHJlZGljdGlvbiIsDQogICAgICAiU1ByZWRpY3Rpb24iDQogICAgfSkNCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb25WUHJlZCIsICJWUHJlZGljdGlvbiBIaXRDaGFuY2UiLCBTQ1JJUFRfUEFSQU1fU0xJQ0UsIDIsIDEsIDYsIDApDQogICAgTWVudS5wcmVkaWN0aW9uOmFkZFBhcmFtKCJ1c2VQcmVkaWN0aW9uSFByZWQiLCAiSFByZWRpY3Rpb24gSGl0Q2hhbmNlIiwgU0NSSVBUX1BBUkFNX1NMSUNFLCAxLCAxLCAzLCAyKQ0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvbkRQcmVkIiwgIkRpdmluZVByZWQgSGl0Q2hhbmNlIiwgU0NSSVBUX1BBUkFNX1NMSUNFLCA1MCwgMCwgMTAwLCAwKQ0KICBlbHNlaWYgYmNhIGFuZCBjY2EgYW5kIGFkYSBhbmQgbm90IHNQcmVkTG9hZGVkIHRoZW4NCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb24iLCAiUHJlZGljdGlvbiBUeXBlOiIsIFNDUklQVF9QQVJBTV9MSVNULCAxLCB7DQogICAgICAiVlByZWRpY3Rpb24iLA0KICAgICAgIkRpdmluZVByZWRpY3Rpb24iLA0KICAgICAgIkhQcmVkaWN0aW9uIg0KICAgIH0pDQogICAgTWVudS5wcmVkaWN0aW9uOmFkZFBhcmFtKCJ1c2VQcmVkaWN0aW9uVlByZWQiLCAiVlByZWRpY3Rpb24gSGl0Q2hhbmNlIiwgU0NSSVBUX1BBUkFNX1NMSUNFLCAyLCAxLCA2LCAwKQ0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvbkhQcmVkIiwgIkhQcmVkaWN0aW9uIEhpdENoYW5jZSIsIFNDUklQVF9QQVJBTV9TTElDRSwgMSwgMSwgMywgMikNCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb25EUHJlZCIsICJEaXZpbmVQcmVkIEhpdENoYW5jZSIsIFNDUklQVF9QQVJBTV9TTElDRSwgNTAsIDAsIDEwMCwgMCkNCiAgZWxzZWlmIGJjYSBhbmQgbm90IGNjYSBhbmQgYWRhIGFuZCBzUHJlZExvYWRlZCB0aGVuDQogICAgTWVudS5wcmVkaWN0aW9uOmFkZFBhcmFtKCJ1c2VQcmVkaWN0aW9uIiwgIlByZWRpY3Rpb24gVHlwZToiLCBTQ1JJUFRfUEFSQU1fTElTVCwgMSwgew0KICAgICAgIlZQcmVkaWN0aW9uIiwNCiAgICAgICJEaXZpbmVQcmVkaWN0aW9uIiwNCiAgICAgICJTUHJlZGljdGlvbiINCiAgICB9KQ0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvblZQcmVkIiwgIlZQcmVkaWN0aW9uIEhpdENoYW5jZSIsIFNDUklQVF9QQVJBTV9TTElDRSwgMiwgMSwgNiwgMCkNCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb25EUHJlZCIsICJEaXZpbmVQcmVkIEhpdENoYW5jZSIsIFNDUklQVF9QQVJBTV9TTElDRSwgNTAsIDAsIDEwMCwgMCkNCiAgZWxzZWlmIGJjYSBhbmQgbm90IGNjYSBhbmQgYWRhIGFuZCBub3Qgc1ByZWRMb2FkZWQgdGhlbg0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvbiIsICJQcmVkaWN0aW9uIFR5cGU6IiwgU0NSSVBUX1BBUkFNX0xJU1QsIDEsIHsNCiAgICAgICJWUHJlZGljdGlvbiIsDQogICAgICAiRGl2aW5lUHJlZGljdGlvbiINCiAgICB9KQ0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvblZQcmVkIiwgIlZQcmVkaWN0aW9uIEhpdENoYW5jZSIsIFNDUklQVF9QQVJBTV9TTElDRSwgMiwgMSwgNiwgMCkNCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb25EUHJlZCIsICJEaXZpbmVQcmVkIEhpdENoYW5jZSIsIFNDUklQVF9QQVJBTV9TTElDRSwgNTAsIDAsIDEwMCwgMCkNCiAgZWxzZWlmIGNjYSBhbmQgbm90IGJjYSBhbmQgYWRhIGFuZCBzUHJlZExvYWRlZCB0aGVuDQogICAgTWVudS5wcmVkaWN0aW9uOmFkZFBhcmFtKCJ1c2VQcmVkaWN0aW9uIiwgIlByZWRpY3Rpb24gVHlwZToiLCBTQ1JJUFRfUEFSQU1fTElTVCwgMSwgew0KICAgICAgIlZQcmVkaWN0aW9uIiwNCiAgICAgICJIUHJlZGljdGlvbiIsDQogICAgICAiU1ByZWRpY3Rpb24iDQogICAgfSkNCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb25WUHJlZCIsICJWUHJlZGljdGlvbiBIaXRDaGFuY2UiLCBTQ1JJUFRfUEFSQU1fU0xJQ0UsIDIsIDEsIDYsIDApDQogICAgTWVudS5wcmVkaWN0aW9uOmFkZFBhcmFtKCJ1c2VQcmVkaWN0aW9uSFByZWQiLCAiSFByZWRpY3Rpb24gSGl0Q2hhbmNlIiwgU0NSSVBUX1BBUkFNX1NMSUNFLCAxLCAxLCAzLCAyKQ0KICBlbHNlaWYgY2NhIGFuZCBub3QgYmNhIGFuZCBhZGEgYW5kIG5vdCBzUHJlZExvYWRlZCB0aGVuDQogICAgTWVudS5wcmVkaWN0aW9uOmFkZFBhcmFtKCJ1c2VQcmVkaWN0aW9uIiwgIlByZWRpY3Rpb24gVHlwZToiLCBTQ1JJUFRfUEFSQU1fTElTVCwgMSwgew0KICAgICAgIlZQcmVkaWN0aW9uIiwNCiAgICAgICJIUHJlZGljdGlvbiINCiAgICB9KQ0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvblZQcmVkIiwgIlZQcmVkaWN0aW9uIEhpdENoYW5jZSIsIFNDUklQVF9QQVJBTV9TTElDRSwgMiwgMSwgNiwgMCkNCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb25IUHJlZCIsICJIUHJlZGljdGlvbiBIaXRDaGFuY2UiLCBTQ1JJUFRfUEFSQU1fU0xJQ0UsIDEsIDEsIDMsIDIpDQogIGVsc2VpZiBjY2EgYW5kIGJjYSBhbmQgbm90IGFkYSBhbmQgc1ByZWRMb2FkZWQgdGhlbg0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvbiIsICJQcmVkaWN0aW9uIFR5cGU6IiwgU0NSSVBUX1BBUkFNX0xJU1QsIDEsIHsNCiAgICAgICJEaXZpbmVQcmVkaWN0aW9uIiwNCiAgICAgICJIUHJlZGljdGlvbiIsDQogICAgICAiU1ByZWRpY3Rpb24iDQogICAgfSkNCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb25EUHJlZCIsICJEaXZpbmVQcmVkIEhpdENoYW5jZSIsIFNDUklQVF9QQVJBTV9TTElDRSwgNTAsIDAsIDEwMCwgMCkNCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb25IUHJlZCIsICJIUHJlZGljdGlvbiBIaXRDaGFuY2UiLCBTQ1JJUFRfUEFSQU1fU0xJQ0UsIDEsIDEsIDMsIDIpDQogIGVsc2VpZiBjY2EgYW5kIGJjYSBhbmQgbm90IGFkYSBhbmQgbm90IHNQcmVkTG9hZGVkIHRoZW4NCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb24iLCAiUHJlZGljdGlvbiBUeXBlOiIsIFNDUklQVF9QQVJBTV9MSVNULCAxLCB7DQogICAgICAiRGl2aW5lUHJlZGljdGlvbiIsDQogICAgICAiSFByZWRpY3Rpb24iDQogICAgfSkNCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb25EUHJlZCIsICJEaXZpbmVQcmVkIEhpdENoYW5jZSIsIFNDUklQVF9QQVJBTV9TTElDRSwgNTAsIDAsIDEwMCwgMCkNCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb25IUHJlZCIsICJIUHJlZGljdGlvbiBIaXRDaGFuY2UiLCBTQ1JJUFRfUEFSQU1fU0xJQ0UsIDEsIDEsIDMsIDIpDQogIGVsc2VpZiBhZGEgYW5kIG5vdCBiY2EgYW5kIG5vdCBjY2EgYW5kIHNQcmVkTG9hZGVkIHRoZW4NCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb24iLCAiUHJlZGljdGlvbiBUeXBlOiIsIFNDUklQVF9QQVJBTV9MSVNULCAxLCB7DQogICAgICAiVlByZWRpY3Rpb24iLA0KICAgICAgIlNQcmVkaWN0aW9uIg0KICAgIH0pDQogICAgTWVudS5wcmVkaWN0aW9uOmFkZFBhcmFtKCJ1c2VQcmVkaWN0aW9uVlByZWQiLCAiVlByZWRpY3Rpb24gSGl0Q2hhbmNlIiwgU0NSSVBUX1BBUkFNX1NMSUNFLCAyLCAxLCA2LCAwKQ0KICBlbHNlaWYgYWRhIGFuZCBub3QgYmNhIGFuZCBub3QgY2NhIGFuZCBub3Qgc1ByZWRMb2FkZWQgdGhlbg0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvbiIsICJQcmVkaWN0aW9uIFR5cGU6IiwgU0NSSVBUX1BBUkFNX0xJU1QsIDEsIHsNCiAgICAgICJWUHJlZGljdGlvbiINCiAgICB9KQ0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvblZQcmVkIiwgIlZQcmVkaWN0aW9uIEhpdENoYW5jZSIsIFNDUklQVF9QQVJBTV9TTElDRSwgMiwgMSwgNiwgMCkNCiAgZWxzZWlmIG5vdCBhZGEgYW5kIGJjYSBhbmQgbm90IGNjYSBhbmQgc1ByZWRMb2FkZWQgdGhlbg0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvbiIsICJQcmVkaWN0aW9uIFR5cGU6IiwgU0NSSVBUX1BBUkFNX0xJU1QsIDEsIHsNCiAgICAgICJEaXZpbmVQcmVkaWN0aW9uIiwNCiAgICAgICJTUHJlZGljdGlvbiINCiAgICB9KQ0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvbkRQcmVkIiwgIkRpdmluZVByZWQgSGl0Q2hhbmNlIiwgU0NSSVBUX1BBUkFNX1NMSUNFLCA1MCwgMCwgMTAwLCAwKQ0KICBlbHNlaWYgbm90IGFkYSBhbmQgYmNhIGFuZCBub3QgY2NhIGFuZCBub3Qgc1ByZWRMb2FkZWQgdGhlbg0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvbiIsICJQcmVkaWN0aW9uIFR5cGU6IiwgU0NSSVBUX1BBUkFNX0xJU1QsIDEsIHsNCiAgICAgICJEaXZpbmVQcmVkaWN0aW9uIg0KICAgIH0pDQogICAgTWVudS5wcmVkaWN0aW9uOmFkZFBhcmFtKCJ1c2VQcmVkaWN0aW9uRFByZWQiLCAiRGl2aW5lUHJlZCBIaXRDaGFuY2UiLCBTQ1JJUFRfUEFSQU1fU0xJQ0UsIDUwLCAwLCAxMDAsIDApDQogIGVsc2VpZiBub3QgYWRhIGFuZCBub3QgYmNhIGFuZCBjY2EgYW5kIHNQcmVkTG9hZGVkIHRoZW4NCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb24iLCAiUHJlZGljdGlvbiBUeXBlOiIsIFNDUklQVF9QQVJBTV9MSVNULCAxLCB7DQogICAgICAiSFByZWRpY3Rpb24iLA0KICAgICAgIlNQcmVkaWN0aW9uIg0KICAgIH0pDQogICAgTWVudS5wcmVkaWN0aW9uOmFkZFBhcmFtKCJ1c2VQcmVkaWN0aW9uSFByZWQiLCAiSFByZWRpY3Rpb24gSGl0Q2hhbmNlIiwgU0NSSVBUX1BBUkFNX1NMSUNFLCAxLCAxLCAzLCAyKQ0KICBlbHNlaWYgbm90IGFkYSBhbmQgbm90IGJjYSBhbmQgY2NhIGFuZCBub3Qgc1ByZWRMb2FkZWQgdGhlbg0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvbiIsICJQcmVkaWN0aW9uIFR5cGU6IiwgU0NSSVBUX1BBUkFNX0xJU1QsIDEsIHsNCiAgICAgICJIUHJlZGljdGlvbiINCiAgICB9KQ0KICAgIE1lbnUucHJlZGljdGlvbjphZGRQYXJhbSgidXNlUHJlZGljdGlvbkhQcmVkIiwgIkhQcmVkaWN0aW9uIEhpdENoYW5jZSIsIFNDUklQVF9QQVJBTV9TTElDRSwgMSwgMSwgMywgMikNCiAgZWxzZWlmIG5vdCBhZGEgYW5kIG5vdCBiY2EgYW5kIG5vdCBjY2EgYW5kIHNQcmVkTG9hZGVkIHRoZW4NCiAgICBNZW51LnByZWRpY3Rpb246YWRkUGFyYW0oInVzZVByZWRpY3Rpb24iLCAiUHJlZGljdGlvbiBUeXBlOiIsIFNDUklQVF9QQVJBTV9MSVNULCAxLCB7DQogICAgICAiU1ByZWRpY3Rpb24iDQogICAgfSkNCiAgZWxzZWlmIG5vdCBhZGEgYW5kIG5vdCBiY2EgYW5kIG5vdCBjY2EgYW5kIG5vdCBzUHJlZExvYWRlZCB0aGVuDQogICAgTWVudS5wcmVkaWN0aW9uOmFkZFBhcmFtKCJ1c2VQcmVkaWN0aW9uIiwgIlByZWRpY3Rpb24gVHlwZSIsIFNDUklQVF9QQVJBTV9MSVNULCAxLCB7DQogICAgICAiTm8gUHJlZGljdGlvbnMgZm91bmQiDQogICAgfSkNCiAgZW5kDQogIE1lbnU6YWRkU3ViTWVudShkZGEgLi4gIk1pc2MiLCAibWlzYyIpDQogIE1lbnUubWlzYzphZGRTdWJNZW51KCJBdXRvIExldmVsIiwgImF1dG9sZXZlbCIpDQogIE1lbnUubWlzYy5hdXRvbGV2ZWw6YWRkUGFyYW0oInVzZUF1dG9MZXZlbCIsICJVc2UgQXV0byBMZXZlbCIsIFNDUklQVF9QQVJBTV9PTk9GRiwgZmFsc2UpDQogIE1lbnUubWlzYy5hdXRvbGV2ZWw6YWRkUGFyYW0oInNlcXVlbmNlIiwgIldoYXQgdG8gbWF4PyIsIFNDUklQVF9QQVJBTV9MSVNULCAxLCB7IlEtVy1SLUUiLCAiVy1RLVItRSJ9KQ0KICBpZiBpZ25pdGUgfj0gbmlsIHRoZW4NCiAgICBNZW51Lm1pc2M6YWRkU3ViTWVudSgiQXV0byBJZ25pdGUiLCAiYXV0b2lnbml0ZSIpDQogICAgTWVudS5taXNjLmF1dG9pZ25pdGU6YWRkUGFyYW0oInVzZUlnbml0ZSIsICJVc2UgU3VtbW9uZXIgSWduaXRlIiwgU0NSSVBUX1BBUkFNX09OT0ZGLCB0cnVlKQ0KICAgIGZvciBfX2IsIGFfYiBpbiBpcGFpcnMoR2V0RW5lbXlIZXJvZXMoKSkgZG8NCiAgICAgIE1lbnUubWlzYy5hdXRvaWduaXRlOmFkZFBhcmFtKGFfYi5jaGFyTmFtZSwgIlVzZSBJZ25pdGUgT24gIiAuLiBhX2IuY2hhck5hbWUsIFNDUklQVF9QQVJBTV9PTk9GRiwgdHJ1ZSkNCiAgICBlbmQNCiAgZW5kDQogIE1lbnUubWlzYzphZGRTdWJNZW51KCJaaHlvbmFzIiwgInpob255YXMiKQ0KICBNZW51Lm1pc2MuemhvbnlhczphZGRQYXJhbSgiemhvbnlhcyIsICJBdXRvIFpob255YXMiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQogIE1lbnUubWlzYy56aG9ueWFzOmFkZFBhcmFtKCJ6aG9ueWFzdW5kZXIiLCAiVXNlIFpob255YXMgdW5kZXIgJSBoZWFsdGgiLCBTQ1JJUFRfUEFSQU1fU0xJQ0UsIDAuMiwgMCwgMSwgMikNCiAgTWVudS5taXNjOmFkZFN1Yk1lbnUoIkF1dG8gSWduaXRlIFBvdGlvbiIsICJjb3VudGVyTG9naWMiKQ0KICBNZW51Lm1pc2MuY291bnRlckxvZ2ljOmFkZFBhcmFtKCJ1c2VQb3Rpb24iLCAiRHJpbmsgSGVhbHRoIFBvdCB3aGVuIElnbml0ZWQiLCBTQ1JJUFRfUEFSQU1fT05PRkYsIHRydWUpDQogIE1lbnU6YWRkU3ViTWVudShkZGEgLi4gIk9yYldhbGtlciIsICJvcmJ3YWxrZXIiKQ0KICBNZW51OmFkZFN1Yk1lbnUoZGRhIC4uICJUYXJnZXRTZWxlY3RvciBNb2RlcyIsICJ0c21vZGVzIikNCiAgTWVudS50c21vZGVzOmFkZFRTKHRzKQ0KICBNZW51LnRzbW9kZXM6YWRkVFModHNMb25nKQ0KICBNZW51OmFkZFBhcmFtKCJpbmZvMiIsICJBdXRob3IiLCBTQ1JJUFRfUEFSQU1fSU5GTywgX0cuTGVCbGFuY19BdXRob3IpDQogIE1lbnU6YWRkUGFyYW0oImluZm8iLCAiVmVyc2lvbiIsIFNDUklQVF9QQVJBTV9JTkZPLCBfRy5MZUJsYW5jX1NjcmlwdFZlcnNpb24pDQogIGlmIGRhYSB0aGVuDQogICAgTWVudTphZGRQYXJhbSgiaW5mbzExIiwgIkxpY2Vuc2UiLCBTQ1JJUFRfUEFSQU1fSU5GTywgIlByb21vdGlvbiBGcmVlIERheSIpDQogIGVsc2VpZiBiYWEgdGhlbg0KICAgIE1lbnU6YWRkUGFyYW0oImluZm8xMSIsICJMaWNlbnNlIiwgU0NSSVBUX1BBUkFNX0lORk8sICJUcmlhbCIpDQogIGVuZA0KICBpZiBjYWEgdGhlbg0KICAgIE1lbnU6YWRkUGFyYW0oImluZm8xMSIsICJMaWNlbnNlIiwgU0NSSVBUX1BBUkFNX0lORk8sICJQYWlkIikNCiAgZW5kDQogIE1lbnU6YWRkUGFyYW0oInBhdGNoIiwgIlBhdGNoOiAiLCBTQ1JJUFRfUEFSQU1fSU5GTywgIjUuMjEiKQ0KICBNZW51LmtleXNldHRpbmdzOnBlcm1hU2hvdygidXNlQ29tYm8iKQ0KICBNZW51LmtleXNldHRpbmdzOnBlcm1hU2hvdygidXNlSGFyYXNzIikNCiAgTWVudS5rZXlzZXR0aW5nczpwZXJtYVNob3coInVzZUxhbmVDbGVhciIpDQogIE1lbnUua2V5c2V0dGluZ3M6cGVybWFTaG93KCJ1c2VGYXJtIikNCiAgTWVudS5raWxsc3RlYWw6cGVybWFTaG93KCJraWxsc3RlYWwiKQ0KICBNZW51LmRyYXdpbmdzOnBlcm1hU2hvdygiZHJhdyIpDQplbmQNCmZ1bmN0aW9uIFN1bW1vbmVycygpDQogIGhlYWwgPSAobm90IG15SGVybzpHZXRTcGVsbERhdGEoU1VNTU9ORVJfMSkubmFtZTpmaW5kKCJzdW1tb25lcmhlYWwiKSBvciBub3QgU1VNTU9ORVJfMSkgYW5kIG15SGVybzpHZXRTcGVsbERhdGEoU1VNTU9ORVJfMikubmFtZTpmaW5kKCJzdW1tb25lcmhlYWwiKSBhbmQgU1VNTU9ORVJfMg0KICBpZ25pdGUgPSAobm90IG15SGVybzpHZXRTcGVsbERhdGEoU1VNTU9ORVJfMSkubmFtZTpmaW5kKCJzdW1tb25lcmRvdCIpIG9yIG5vdCBTVU1NT05FUl8xKSBhbmQgbXlIZXJvOkdldFNwZWxsRGF0YShTVU1NT05FUl8yKS5uYW1lOmZpbmQoInN1bW1vbmVyZG90IikgYW5kIFNVTU1PTkVSXzINCmVuZA0KZnVuY3Rpb24gVHVycmV0Q2hlY2soKQ0KICBpZiB0dXJyZXRGb2N1cy5mb2N1c2VkIGFuZCB0dXJyZXRGb2N1cy50dXJyZXQgYW5kIHR1cnJldEZvY3VzLnNwZWxsIHRoZW4NCiAgICBsb2NhbCBkZGEgPSAxIC8gKHR1cnJldEZvY3VzLnR1cnJldC5hdHRhY2tTcGVlZCAqICgxIC8gKHR1cnJldEZvY3VzLnNwZWxsLmFuaW1hdGlvblRpbWUgKiB0dXJyZXRGb2N1cy50dXJyZXQuYXR0YWNrU3BlZWQpKSkNCiAgICBpZiBvcy5jbG9jaygpID4gdHVycmV0Rm9jdXMuc3RhcnRUICsgZGRhICsgdHVycmV0Rm9jdXMuc3BlbGwud2luZFVwVGltZSB0aGVuDQogICAgICB0dXJyZXRGb2N1cy5mb2N1c2VkID0gZmFsc2UNCiAgICBlbmQNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIENoZWNrcygpDQogIFFyZWFkeSA9IG15SGVybzpDYW5Vc2VTcGVsbChfUSkgPT0gUkVBRFkNCiAgV3JlYWR5ID0gbXlIZXJvOkNhblVzZVNwZWxsKF9XKSA9PSBSRUFEWQ0KICBFcmVhZHkgPSBteUhlcm86Q2FuVXNlU3BlbGwoX0UpID09IFJFQURZDQogIFJyZWFkeSA9IG15SGVybzpDYW5Vc2VTcGVsbChfUikgPT0gUkVBRFkNCiAgSHJlYWR5ID0gaGVhbCB+PSBuaWwgYW5kIG15SGVybzpDYW5Vc2VTcGVsbChoZWFsKSA9PSBSRUFEWQ0KICBJcmVhZHkgPSBpZ25pdGUgfj0gbmlsIGFuZCBteUhlcm86Q2FuVXNlU3BlbGwoaWduaXRlKSA9PSBSRUFEWQ0KICBpZiBNZW51LmRyYXdpbmdzLmxmYy51c2VMRkMgdGhlbg0KICAgIF9HLkRyYXdDaXJjbGUgPSBEcmF3Q2lyY2xlMg0KICBlbHNlDQogICAgX0cuRHJhd0NpcmNsZSA9IF9HLm9sZERyYXdDaXJjbGUNCiAgZW5kDQogIE1pbmlvbnNBdHRhY2tpbmdNZSgpDQogIFR1cnJldENoZWNrKCkNCiAgaWYgY2FzdGVkV1Rocm91Z2hIYXJhc3MuYm9vbCBhbmQgY2FzdGVkV1Rocm91Z2hIYXJhc3MudGltZSArIDIgPiBvcy5jbG9jaygpIHRoZW4NCiAgICBjYXN0ZWRXVGhyb3VnaEhhcmFzcy5ib29sID0gZmFsc2UNCiAgZW5kDQogIGlmIG5vdCBScmVhZHkgYW5kIChjYW5DYXN0U3BlbGxzID09IGZhbHNlIG9yIFJTa2lsbCB+PSBuaWwpIHRoZW4NCiAgICBjYW5DYXN0U3BlbGxzID0gdHJ1ZQ0KICAgIFJTa2lsbCA9IG5pbA0KICAgIFJTa2lsbFBvcyA9IG5pbA0KICBlbmQNCiAgZW5lbXlNaW5pb25zOnVwZGF0ZSgpDQogIHRhcmdldCA9IEdldE9yYlRhcmdldCgpDQogIENhbGNEYW1hZ2UoKQ0KICBDb250cm9sRVJhbmdlKCkNCiAgQ2hlY2tGb3JjZWRUYXJnZXQoKQ0KICBQcmVkaWN0aW9uQ2hhbmdlKCkNCmVuZA0KZnVuY3Rpb24gUmV0dXJuQmVzdFRhcmdldFBvc2l0aW9uKGRkYSwgX19iKQ0KICBsb2NhbCBhX2IsIGJfYiwgY19iID0gMCwge30sIG5pbA0KICBsb2NhbCBkX2IgPSBfX2IgYW5kIF9fYiAqIF9fYiBvciBteUhlcm8ucmFuZ2UgKiBteUhlcm8ucmFuZ2UNCiAgZm9yIF9hYiwgYWFiIGluIGlwYWlycyhHZXRFbmVteUhlcm9lcygpKSBkbw0KICAgIGlmIGRfYiA+PSBHZXREaXN0YW5jZVNxcihhYWIsIG15SGVybykgdGhlbg0KICAgICAgYl9iID0ge30NCiAgICAgIHRhYmxlLmluc2VydChiX2IsIGFhYi5jaGFyTmFtZSkNCiAgICAgIGFfYiA9IDANCiAgICAgIGZvciBiYWIsIGNhYiBpbiBpcGFpcnMoR2V0RW5lbXlIZXJvZXMoKSkgZG8NCiAgICAgICAgaWYgYWFiIH49IGNhYiBhbmQgR2V0RGlzdGFuY2UoY2FiLCBhYWIpIDwgU3BlbGxzLlcucmFkaXVzIHRoZW4NCiAgICAgICAgICBhX2IgPSBhX2IgKyAxDQogICAgICAgICAgdGFibGUuaW5zZXJ0KGJfYiwgY2FiLmNoYXJOYW1lKQ0KICAgICAgICBlbmQNCiAgICAgIGVuZA0KICAgICAgaWYgZGRhIDw9IGFfYiB0aGVuDQogICAgICAgIGNfYiA9IGFhYi5wb3MNCiAgICAgICAgYnJlYWsNCiAgICAgIGVuZA0KICAgIGVuZA0KICBlbmQNCiAgcmV0dXJuIGNfYiwgYl9iLCBhX2INCmVuZA0KZnVuY3Rpb24gR2V0QmVzdEFPRVBvc2l0aW9uKGRkYSwgX19iLCBhX2IsIGJfYikNCiAgYXNzZXJ0KGRkYSBhbmQgdHlwZShkZGEpID09ICJ0YWJsZSIsICJUb3RhbGx5IExlQmxhbmM6IEludmFsaWQgT2JqZWN0cyBpbiBmdW5jdGlvbiBHZXRCZXN0QU9FUG9zaXRpb24iKQ0KICBsb2NhbCBjX2INCiAgbG9jYWwgZF9iID0gMA0KICBsb2NhbCBfYWIgPSBiX2Igb3IgbXlIZXJvDQogIGxvY2FsIGFhYiA9IF9fYiBhbmQgX19iICogX19iIG9yIG15SGVybw0KICBmb3IgYmFiLCBjYWIgaW4gaXBhaXJzKGRkYSkgZG8NCiAgICBpZiBhYWIgPiBHZXREaXN0YW5jZVNxcihjYWIsIF9hYikgdGhlbg0KICAgICAgbG9jYWwgZGFiID0gMA0KICAgICAgZm9yIF9iYiwgYWJiIGluIGlwYWlycyhkZGEpIGRvDQogICAgICAgIGlmIEdldERpc3RhbmNlU3FyKGFiYiwgY2FiKSA8PSBhX2IgKiBhX2IgdGhlbg0KICAgICAgICAgIGRhYiA9IGRhYiArIDENCiAgICAgICAgZW5kDQogICAgICBlbmQNCiAgICAgIGlmIGRfYiA8IGRhYiB0aGVuDQogICAgICAgIGRfYiA9IGRhYg0KICAgICAgICBjX2IgPSBjYWIucG9zDQogICAgICBlbmQNCiAgICBlbmQNCiAgZW5kDQogIHJldHVybiBjX2IsIGRfYg0KZW5kDQpmdW5jdGlvbiBHZXRLaWxsYWJsZU1pbmlvbnMoZGRhLCBfX2IsIGFfYiwgYl9iKQ0KICBhc3NlcnQoYV9iID09IF9RIG9yIGFfYiA9PSBfVyBvciBhX2IgPT0gX0UsICJUb3RhbGx5IExlQmxhbmM6IENvcnJlY3Qgc3BlbGwgbm90IGRldGVjdGVkIikNCiAgYXNzZXJ0KGRkYSBhbmQgdHlwZShkZGEpID09ICJ0YWJsZSIsICJUb3RhbGx5IExlQmxhbmM6IEludmFsaWQgdGFibGUgaW46IG1pbmlvblRhYmxlLCBmaXJzdCBwYXJhbWV0ZXIiKQ0KICBsb2NhbCBjX2IgPSBfX2IgYW5kIF9fYiAqIF9fYiBvciBteUhlcm8ucmFuZ2UgKiBteUhlcm8ucmFuZ2UNCiAgbG9jYWwgZF9iID0ge30NCiAgbG9jYWwgX2FiID0gYl9iIG9yIG15SGVybw0KICBsb2NhbCBhYWIgPSAwDQogIGZvciBiYWIsIGNhYiBpbiBpcGFpcnMoZGRhKSBkbw0KICAgIGlmIGNfYiA+IEdldERpc3RhbmNlU3FyKGNhYikgdGhlbg0KICAgICAgaWYgYV9iID09IF9RIHRoZW4NCiAgICAgICAgYWFiID0gZ2V0RG1nKCJRIiwgY2FiLCBfYWIpDQogICAgICBlbmQNCiAgICAgIGlmIGFfYiA9PSBfVyB0aGVuDQogICAgICAgIGFhYiA9IGdldERtZygiVyIsIGNhYiwgX2FiKQ0KICAgICAgZW5kDQogICAgICBpZiBhX2IgPT0gX0UgdGhlbg0KICAgICAgICBhYWIgPSBnZXREbWcoIkUiLCBjYWIsIF9hYikNCiAgICAgIGVuZA0KICAgICAgaWYgYWFiID4gY2FiLmhlYWx0aCB0aGVuDQogICAgICAgIHRhYmxlLmluc2VydChkX2IsIGNhYikNCiAgICAgIGVuZA0KICAgIGVuZA0KICBlbmQNCiAgcmV0dXJuIGRfYg0KZW5kDQpmdW5jdGlvbiBBbGx5SGVyb0luUmFuZ2UoZGRhLCBfX2IpDQogIF9fYiA9IF9fYiBvciBteUhlcm8NCiAgZGRhID0gZGRhIGFuZCBkZGEgKiBkZGEgb3IgbXlIZXJvLnJhbmdlICogbXlIZXJvLnJhbmdlDQogIGxvY2FsIGFfYiA9IDANCiAgZm9yIGkgPSAxLCBoZXJvTWFuYWdlci5pQ291bnQgZG8NCiAgICBsb2NhbCBiX2IgPSBoZXJvTWFuYWdlcjpnZXRIZXJvKGkpDQogICAgaWYgYl9iLnRlYW0gPT0gX19iLnRlYW0gYW5kIGRkYSA+PSBHZXREaXN0YW5jZVNxcihfX2IsIGJfYikgdGhlbg0KICAgICAgYV9iID0gYV9iICsgMQ0KICAgIGVuZA0KICBlbmQNCiAgcmV0dXJuIGFfYg0KZW5kDQpmdW5jdGlvbiBHZXRXUHJlZGljdGlvbihkZGEpDQogIGxvY2FsIF9fYg0KICBpZiBWUHJlZGljdGlvbkxvYWRlZCgpIHRoZW4NCiAgICBsb2NhbCBhX2IsIGJfYiwgY19iID0gYmRhOklzRGFzaGluZyhkZGEsIFNwZWxscy5XLmRlbGF5LCBTcGVsbHMuVy5yYWRpdXMsIFNwZWxscy5XLnNwZWVkLCBteUhlcm8pDQogICAgaWYgYV9iIGFuZCBiX2IgdGhlbg0KICAgICAgX19iID0gY19iDQogICAgZWxzZQ0KICAgICAgX19iID0gYmRhOkdldENpcmN1bGFyQ2FzdFBvc2l0aW9uKGRkYSwgU3BlbGxzLlcuZGVsYXksIFNwZWxscy5XLnJhZGl1cywgU3BlbGxzLlcucmFuZ2UsIFNwZWxscy5XLnNwZWVkKQ0KICAgIGVuZA0KICBlbHNlaWYgRGl2aW5lUHJlZExvYWRlZCgpIHRoZW4NCiAgICBpZiBub3QgRFAuaXNBdXRoZWQoKSB0aGVuDQogICAgICBTYXkoIllvdSBhcmUgbm90IGF1dGhlZCB0byB1c2UgRGl2aW5lUHJlZC4gQ2hhbmdlIHByZWRpY3Rpb24hISIpDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBpZiBub3QgcHJlZFRpbWVyOmlzVXAoKSB0aGVuDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBsb2NhbCBhX2IsIGJfYiwgY19iID0gRFA6cHJlZGljdCgid1NraWxsU2hvdCIsIGRkYSkNCiAgICBpZiBhX2IgYW5kIGFfYiA9PSBTa2lsbFNob3QuU1RBVFVTLlNVQ0NFU1NfSElUIGFuZCBiX2Igfj0gbmlsIHRoZW4NCiAgICAgIF9fYiA9IGJfYg0KICAgICAgcHJlZFRpbWVyOnJlc2V0KCkNCiAgICBlbmQNCiAgZWxzZWlmIEhQcmVkTWVudUxvYWRlZCgpIHRoZW4NCiAgICBfX2IgPSBfZGE6R2V0UHJlZGljdChIUF9XLCBkZGEsIG15SGVybykNCiAgZWxzZWlmIFNQcmVkaWN0aW9uTG9hZGVkKCkgdGhlbg0KICAgIGxvY2FsIGFfYiwgYl9iLCBjX2IgPSBjZGE6UHJlZGljdChkZGEsIFNwZWxscy5XLnJhbmdlLCBTcGVsbHMuVy5zcGVlZCwgU3BlbGxzLlcuZGVsYXksIFNwZWxscy5XLnJhZGl1cywgZmFsc2UsIG15SGVybykNCiAgICBpZiBhX2IgYW5kIGJfYiA+PSAxIHRoZW4NCiAgICAgIF9fYiA9IGFfYg0KICAgIGVuZA0KICBlbmQNCiAgcmV0dXJuIF9fYg0KZW5kDQpmdW5jdGlvbiBHZXRFUHJlZGljdGlvbihkZGEpDQogIGxvY2FsIF9fYg0KICBpZiBWUHJlZGljdGlvbkxvYWRlZCgpIHRoZW4NCiAgICBsb2NhbCBhX2IsIGJfYiwgY19iID0gYmRhOklzRGFzaGluZyhkZGEsIFNwZWxscy5FLmRlbGF5LCBjdXJyZW50V2lkdGgsIFNwZWxscy5FLnNwZWVkLCBteUhlcm8pDQogICAgaWYgYV9iIGFuZCBiX2IgYW5kIEdldERpc3RhbmNlU3FyKGNfYikgPD0gU3BlbGxzLkUucmFuZ2UgKiBTcGVsbHMuRS5yYW5nZSB0aGVuDQogICAgICBfX2IgPSBjX2INCiAgICBlbHNlDQogICAgICBsb2NhbCBkX2IsIF9hYiA9IGJkYTpHZXRMaW5lQ2FzdFBvc2l0aW9uKGRkYSwgU3BlbGxzLkUuZGVsYXksIGN1cnJlbnRXaWR0aCwgY3VycmVudFJhbmdlLCBTcGVsbHMuRS5zcGVlZCwgbXlIZXJvLCB0cnVlKQ0KICAgICAgaWYgX2FiID49IE1lbnUucHJlZGljdGlvbi51c2VQcmVkaWN0aW9uVlByZWQgdGhlbg0KICAgICAgICBfX2IgPSBkX2INCiAgICAgIGVuZA0KICAgIGVuZA0KICBlbHNlaWYgRGl2aW5lUHJlZExvYWRlZCgpIHRoZW4NCiAgICBpZiBub3QgRFAuaXNBdXRoZWQoKSB0aGVuDQogICAgICBTYXkoIllvdSBhcmUgbm90IGF1dGhlZCB0byB1c2UgRGl2aW5lUHJlZC4gQ2hhbmdlIHByZWRpY3Rpb24hISIpDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBpZiBub3QgcHJlZFRpbWVyOmlzVXAoKSB0aGVuDQogICAgICByZXR1cm4NCiAgICBlbmQNCiAgICBsb2NhbCBhX2IsIGJfYiwgY19iID0gRFA6cHJlZGljdCgiZVNraWxsU2hvdCIsIGRkYSkNCiAgICBpZiBhX2IgYW5kIGFfYiA9PSBTa2lsbFNob3QuU1RBVFVTLlNVQ0NFU1NfSElUIGFuZCBiX2Igfj0gbmlsIGFuZCBjX2IgPj0gTWVudS5wcmVkaWN0aW9uLnVzZVByZWRpY3Rpb25EUHJlZCB0aGVuDQogICAgICBfX2IgPSBiX2INCiAgICAgIHByZWRUaW1lcjpyZXNldCgpDQogICAgZW5kDQogIGVsc2VpZiBIUHJlZE1lbnVMb2FkZWQoKSB0aGVuDQogICAgbG9jYWwgYV9iLCBiX2IgPSBfZGE6R2V0UHJlZGljdChIUF9FLCBkZGEsIG15SGVybykNCiAgICBpZiBhX2IgYW5kIGJfYiA+PSBNZW51LnByZWRpY3Rpb24udXNlUHJlZGljdGlvbkhQcmVkIHRoZW4NCiAgICAgIF9fYiA9IGFfYg0KICAgIGVuZA0KICBlbHNlaWYgU1ByZWRpY3Rpb25Mb2FkZWQoKSB0aGVuDQogICAgbG9jYWwgYV9iLCBiX2IsIGNfYiA9IGNkYTpQcmVkaWN0KGRkYSwgY3VycmVudFJhbmdlLCBTcGVsbHMuRS5zcGVlZCwgU3BlbGxzLkUuZGVsYXksIGN1cnJlbnRXaWR0aCwgdHJ1ZSwgbXlIZXJvKQ0KICAgIGlmIGFfYiBhbmQgYl9iID49IDEgdGhlbg0KICAgICAgV0Nhc3QgPSBhX2INCiAgICBlbmQNCiAgZW5kDQogIHJldHVybiBfX2INCmVuZA0KZnVuY3Rpb24gVlByZWRpY3Rpb25Mb2FkZWQoKQ0KICByZXR1cm4gYWRhIGFuZCBNZW51LnByZWRpY3Rpb24udXNlUHJlZGljdGlvbiA9PSAxDQplbmQNCmZ1bmN0aW9uIERpdmluZVByZWRMb2FkZWQoKQ0KICByZXR1cm4gYmNhIGFuZCAoYWRhIGFuZCBNZW51LnByZWRpY3Rpb24udXNlUHJlZGljdGlvbiA9PSAyIG9yIG5vdCBhZGEgYW5kIE1lbnUucHJlZGljdGlvbi51c2VQcmVkaWN0aW9uID09IDEpDQplbmQNCmZ1bmN0aW9uIEhQcmVkTWVudUxvYWRlZCgpDQogIHJldHVybiBjY2EgYW5kIChhZGEgYW5kIGJjYSBhbmQgTWVudS5wcmVkaWN0aW9uLnVzZVByZWRpY3Rpb24gPT0gMyBvciBiY2EgYW5kIG5vdCBhZGEgYW5kIE1lbnUucHJlZGljdGlvbi51c2VQcmVkaWN0aW9uID09IDIgb3IgYWRhIGFuZCBub3QgYmNhIGFuZCBNZW51LnByZWRpY3Rpb24udXNlUHJlZGljdGlvbiA9PSAyIG9yIG5vdCBhZGEgYW5kIG5vdCBiY2EgYW5kIE1lbnUucHJlZGljdGlvbi51c2VQcmVkaWN0aW9uID09IDEpDQplbmQNCmZ1bmN0aW9uIFNQcmVkaWN0aW9uTG9hZGVkKCkNCiAgcmV0dXJuIHNQcmVkTG9hZGVkIGFuZCAoYWRhIGFuZCBiY2EgYW5kIGNjYSBhbmQgTWVudS5wcmVkaWN0aW9uLnVzZVByZWRpY3Rpb24gPT0gNCBvciBhZGEgYW5kIGJjYSBhbmQgbm90IGNjYSBhbmQgTWVudS5wcmVkaWN0aW9uLnVzZVByZWRpY3Rpb24gPT0gMyBvciBhZGEgYW5kIGNjYSBhbmQgbm90IGJjYSBhbmQgTWVudS5wcmVkaWN0aW9uLnVzZVByZWRpY3Rpb24gPT0gMyBvciBhZGEgYW5kIG5vdCBiY2EgYW5kIG5vdCBjY2EgYW5kIE1lbnUucHJlZGljdGlvbi51c2VQcmVkaWN0aW9uID09IDIgb3IgYmNhIGFuZCBub3QgY2NhIGFuZCBub3QgYWRhIGFuZCBNZW51LnByZWRpY3Rpb24udXNlUHJlZGljdGlvbiA9PSAyIG9yIGNjYSBhbmQgbm90IGJjYSBhbmQgbm90IGFkYSBhbmQgTWVudS5wcmVkaWN0aW9uLnVzZVByZWRpY3Rpb24gPT0gMiBvciBub3QgYWRhIGFuZCBub3QgYmNhIGFuZCBub3QgY2NhIGFuZCBNZW51LnByZWRpY3Rpb24udXNlUHJlZGljdGlvbiA9PSAxKQ0KZW5kDQpmdW5jdGlvbiBQcmVkaWN0aW9uQ2hhbmdlKCkNCiAgbG9jYWwgZGRhID0gTWVudS5wcmVkaWN0aW9uLnVzZVByZWRpY3Rpb24NCiAgaWYgY3VycmVudFByZWRpY3Rpb24gYW5kIGRkYSB+PSBjdXJyZW50UHJlZGljdGlvbiB0aGVuDQogICAgY3VycmVudFByZWRpY3Rpb24gPSBkZGENCiAgICBpZiBEaXZpbmVQcmVkTG9hZGVkKCkgYW5kIG5vdCBEUC5pc0F1dGhlZCgpIHRoZW4NCiAgICAgIFNheSgiWW91IGFyZSBub3QgYXV0aGVkIGZvciBEaXZpbmVQcmVkLiBQbGVhc2UgY2hvb3NlIGEgZGlmZmVyZW50IHByZWRpY3Rpb24gb3RoZXJ3aXNlIFcgYW5kIEUgd2lsbCBORVZFUiBjYXN0LiIpDQogICAgZW5kDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBDYXN0UShkZGEpDQogIGlmIGRkYSB+PSBuaWwgYW5kIG5vdCBkZGEuZGVhZCBhbmQgZGRhLnZpc2libGUgYW5kIEdldERpc3RhbmNlU3FyKGRkYSkgPD0gU3BlbGxzLlEucmFuZ2UgKiBTcGVsbHMuUS5yYW5nZSBhbmQgZGRhLnR5cGUgYW5kIChkZGEudHlwZSA9PSBteUhlcm8udHlwZSBvciBkZGEudHlwZSA9PSAib2JqX0FJX01pbmlvbiIpIGFuZCBRcmVhZHkgYW5kIFZhbGlkVGFyZ2V0KGRkYSkgdGhlbg0KICAgIENhc3RTcGVsbChfUSwgZGRhKQ0KICAgIHJldHVybiB0cnVlDQogIGVuZA0KICByZXR1cm4gZmFsc2UNCmVuZA0KZnVuY3Rpb24gQ2FzdFcoZGRhLCBfX2IpDQogIGlmIG5vdCBfX2IgdGhlbg0KICAgIGlmIGRkYSBhbmQgR2V0RGlzdGFuY2VTcXIoZGRhKSA8PSBTcGVsbHMuVy5yYW5nZVNxciB0aGVuDQogICAgICBpZiBkZGEudHlwZSBhbmQgZGRhLnR5cGUgPT0gbXlIZXJvLnR5cGUgdGhlbg0KICAgICAgICBpZiBJc1dSZWFkeSgpIHRoZW4NCiAgICAgICAgICBpZiBsYXN0UUNhc3QudGFyZ2V0IGFuZCBsYXN0UUNhc3QudGFyZ2V0Lm5ldHdvcmtJRCBhbmQgbGFzdFFDYXN0LnRhcmdldC5uZXR3b3JrSUQgPT0gZGRhLm5ldHdvcmtJRCB0aGVuDQogICAgICAgICAgICBsb2NhbCBjX2IgPSBvcy5jbG9jaygpDQogICAgICAgICAgICBsb2NhbCBkX2IgPSBTcGVsbHMuVy5zcGVlZA0KICAgICAgICAgICAgbG9jYWwgX2FiID0gU3BlbGxzLlcuZGVsYXkNCiAgICAgICAgICAgIGxvY2FsIGFhYiA9IEdldERpc3RhbmNlKGRkYSkNCiAgICAgICAgICAgIGxvY2FsIGJhYiA9IGFhYiAvIFNwZWxscy5XLnNwZWVkICsgX2FiDQogICAgICAgICAgICBsb2NhbCBjYWIgPSBjX2IgKyBiYWINCiAgICAgICAgICAgIGlmIGxhc3RRQ2FzdC5lbmRUIGFuZCBjYWIgPCBsYXN0UUNhc3QuZW5kVCB0aGVuDQogICAgICAgICAgICAgIHJldHVybiBmYWxzZQ0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgZW5kDQogICAgICAgICAgaWYgU3BlbGxzLlEucmVhZHkgYW5kIG5vdCBTcGVsbERtZ0NhbGN1bGF0aW9ucygiVyIsIGRkYSkgPj0gZGRhLmhlYWx0aCBhbmQgbm90IFNwZWxscy5FLnJlYWR5IHRoZW4NCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgIGVuZA0KICAgICAgICAgIGxvY2FsIGFfYiwgYl9iID0gR2V0V1ByZWRpY3Rpb24oZGRhKQ0KICAgICAgICAgIGlmIGFfYiBhbmQgbm90IGFfYi55IHRoZW4NCiAgICAgICAgICAgIGFfYi55ID0gMA0KICAgICAgICAgIGVuZA0KICAgICAgICAgIGlmIGFfYiB+PSBuaWwgYW5kIG5vdCBJc1dhbGwoRDNEWFZFQ1RPUjMoYV9iLngsIGFfYi55LCBhX2IueikpIGFuZCAobm90IF9HLkV2YWRlZWVfTG9hZGVkIG9yIG5vdCBfRy5FdmFkZWVlX0lzRGFuZ2Vyb3VzIG9yIG5vdCBfRy5FdmFkZWVlX0lzRGFuZ2Vyb3VzKFBvaW50KGFfYi54LCBhX2IueikpIG9yIFNwZWxsRG1nQ2FsY3VsYXRpb25zKCJXIiwgZGRhKSA+PSBkZGEuaGVhbHRoKSB0aGVuDQogICAgICAgICAgICBpZiBHZXREaXN0YW5jZVNxcihhX2IpID49IFNwZWxscy5XLnJhbmdlU3FyIHRoZW4NCiAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIENhc3RTcGVsbChfVywgYV9iLngsIGFfYi56KQ0KICAgICAgICAgICAgcmV0dXJuIHRydWUNCiAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICBlbHNlaWYgZGRhLnR5cGUgPT0gIm9ial9BSV9NaW5pb24iIHRoZW4NCiAgICAgICAgQ2FzdFNwZWxsKF9XLCBkZGEucG9zLngsIGRkYS5wb3MueikNCiAgICAgICAgcmV0dXJuIHRydWUNCiAgICAgIGVuZA0KICAgIGVuZA0KICBlbHNlaWYgSXNXUmVhZHkoKSBhbmQgKG5vdCBfRy5FdmFkZWVlX0xvYWRlZCBvciBub3QgX0cuRXZhZGVlZV9Jc0Rhbmdlcm91cyBvciBub3QgX0cuRXZhZGVlZV9Jc0Rhbmdlcm91cyhQb2ludChkZGEsIF9fYikpKSBhbmQgR2V0RGlzdGFuY2VTcXIoUG9pbnQoZGRhLCBfX2IpKSA8PSBTcGVsbHMuVy5yYW5nZVNxciBhbmQgbm90IElzV2FsbChEM0RYVkVDVE9SMyhkZGEsIDAsIF9fYikpIHRoZW4NCiAgICBDYXN0U3BlbGwoX1csIGRkYSwgX19iKQ0KICAgIHJldHVybiB0cnVlDQogIGVuZA0KICByZXR1cm4gZmFsc2UNCmVuZA0KZnVuY3Rpb24gR2FwQ2xvc2UoZGRhKQ0KICBpZiBJc1dSZWFkeSgpIGFuZCBkZGEgYW5kIGRkYS50eXBlIGFuZCBkZGEudHlwZSA9PSBteUhlcm8udHlwZSBhbmQgSGFzTWFuYVRvR2FwQ2xvc2UoKSB0aGVuDQogICAgbG9jYWwgX19iID0gVmVjdG9yKG15SGVybykgKyAoVmVjdG9yKGRkYSkgLSBteUhlcm8pOm5vcm1hbGl6ZWQoKSAqIFNwZWxscy5XLnJhbmdlDQogICAgaWYgX19iIGFuZCBub3QgX19iLnkgdGhlbg0KICAgICAgX19iLnkgPSAwDQogICAgZW5kDQogICAgaWYgX19iIGFuZCBub3QgVW5kZXJUdXJyZXQoX19iLCB0cnVlKSBhbmQgbm90IElzV2FsbChEM0RYVkVDVE9SMyhfX2IueCwgX19iLnksIF9fYi56KSkgYW5kIChub3QgX0cuRXZhZGVlZV9Mb2FkZWQgb3Igbm90IF9HLkV2YWRlZWVfSXNEYW5nZXJvdXMgb3Igbm90IF9HLkV2YWRlZWVfSXNEYW5nZXJvdXMoUG9pbnQoX19iLngsIF9fYi56KSkpIGFuZCBHZXREaXN0YW5jZShkZGEsIF9fYikgPD0gU3BlbGxzLlEucmFuZ2UgdGhlbg0KICAgICAgQ2FzdFNwZWxsKF9XLCBfX2IueCwgX19iLnopDQogICAgICByZXR1cm4gdHJ1ZQ0KICAgIGVuZA0KICBlbmQNCiAgcmV0dXJuIGZhbHNlDQplbmQNCmZ1bmN0aW9uIElzV1JlYWR5KCkNCiAgcmV0dXJuIFdyZWFkeSBhbmQgbm90IHdVc2VkKCkNCmVuZA0KZnVuY3Rpb24gSGFzTWFuYVRvR2FwQ2xvc2UoKQ0KICBsb2NhbCBkZGEgPSBteUhlcm86R2V0U3BlbGxEYXRhKF9RKS5sZXZlbCAqIDEwICsgNDANCiAgbG9jYWwgX19iID0gbXlIZXJvOkdldFNwZWxsRGF0YShfVykubGV2ZWwgKiA1ICsgNzUNCiAgbG9jYWwgYV9iID0gODANCiAgcmV0dXJuIFFyZWFkeSBhbmQgZGRhICsgX19iIDwgbXlIZXJvLm1hbmEgb3IgRXJlYWR5IGFuZCBhX2IgKyBfX2IgPCBteUhlcm8ubWFuYQ0KZW5kDQpmdW5jdGlvbiBDYXN0RShkZGEpDQogIGlmIGRkYSBhbmQgbm90IGRkYS5kZWFkIGFuZCBHZXREaXN0YW5jZVNxcihkZGEpIDw9IFNwZWxscy5FLnJhbmdlICogU3BlbGxzLkUucmFuZ2UgYW5kIGRkYS50eXBlIGFuZCAoZGRhLnR5cGUgPT0gbXlIZXJvLnR5cGUgb3IgZGRhLnR5cGUgPT0gIm9ial9BSV9NaW5pb24iKSBhbmQgRXJlYWR5IHRoZW4NCiAgICBsb2NhbCBfX2IgPSBHZXRFUHJlZGljdGlvbihkZGEpDQogICAgaWYgX19iIH49IG5pbCB0aGVuDQogICAgICBDYXN0U3BlbGwoX0UsIF9fYi54LCBfX2IueikNCiAgICAgIHJldHVybiB0cnVlDQogICAgZW5kDQogIGVuZA0KICByZXR1cm4gZmFsc2UNCmVuZA0KZnVuY3Rpb24gd1VzZWQoKQ0KICByZXR1cm4gbXlIZXJvOkdldFNwZWxsRGF0YShfVykubmFtZSBhbmQgbXlIZXJvOkdldFNwZWxsRGF0YShfVykubmFtZSA9PSAibGVibGFuY3NsaWRlcmV0dXJuIg0KZW5kDQpmdW5jdGlvbiB3clVzZWQoKQ0KICByZXR1cm4gbXlIZXJvOkdldFNwZWxsRGF0YShfVykubmFtZSBhbmQgbXlIZXJvOkdldFNwZWxsRGF0YShfUikubmFtZSA9PSAibGVibGFuY3NsaWRlcmV0dXJubSINCmVuZA0KZnVuY3Rpb24gU3BlbGxEbWdDYWxjdWxhdGlvbnMoZGRhLCBfX2IpDQogIGxvY2FsIGFfYiA9IDANCiAgaWYgZGRhID09ICJRIiBhbmQgbXlIZXJvOkdldFNwZWxsRGF0YShfUSkubGV2ZWwgPj0gMSB0aGVuDQogICAgYV9iID0gMjUgKiBteUhlcm86R2V0U3BlbGxEYXRhKF9RKS5sZXZlbCArIDMwICsgMC40ICogbXlIZXJvLmFwDQogIGVsc2VpZiBkZGEgPT0gIlciIGFuZCAxIDw9IG15SGVybzpHZXRTcGVsbERhdGEoX1cpLmxldmVsIHRoZW4NCiAgICBhX2IgPSA0MCAqIG15SGVybzpHZXRTcGVsbERhdGEoX1cpLmxldmVsICsgNDUgKyAwLjYgKiBteUhlcm8uYXANCiAgZWxzZWlmIGRkYSA9PSAiRSIgYW5kIDEgPD0gbXlIZXJvOkdldFNwZWxsRGF0YShfRSkubGV2ZWwgdGhlbg0KICAgIGFfYiA9IDI1ICogbXlIZXJvOkdldFNwZWxsRGF0YShfRSkubGV2ZWwgKyAxNSArIDAuNSAqIG15SGVyby5hcA0KICBlbHNlaWYgZGRhID09ICJSUSIgYW5kIDEgPD0gbXlIZXJvOkdldFNwZWxsRGF0YShfUikubGV2ZWwgdGhlbg0KICAgIGFfYiA9IDEwMCAqIG15SGVybzpHZXRTcGVsbERhdGEoX1IpLmxldmVsICsgMC42NSAqIG15SGVyby5hcA0KICBlbHNlaWYgZGRhID09ICJSVyIgYW5kIDEgPD0gbXlIZXJvOkdldFNwZWxsRGF0YShfUikubGV2ZWwgdGhlbg0KICAgIGFfYiA9IDE1MCAqIG15SGVybzpHZXRTcGVsbERhdGEoX1IpLmxldmVsICsgMC45NzUgKiBteUhlcm8uYXANCiAgZWxzZWlmIGRkYSA9PSAiUkUiIGFuZCAxIDw9IG15SGVybzpHZXRTcGVsbERhdGEoX1IpLmxldmVsIHRoZW4NCiAgICBhX2IgPSAxMDAgKiBteUhlcm86R2V0U3BlbGxEYXRhKF9SKS5sZXZlbCArIDAuNjUgKiBteUhlcm8uYXANCiAgZWxzZWlmIGRkYSA9PSAiUVByb2MiIHRoZW4NCiAgICBhX2IgPSAyNSAqIG15SGVybzpHZXRTcGVsbERhdGEoX1EpLmxldmVsICsgMzAgKyAwLjQgKiBteUhlcm8uYXANCiAgZW5kDQogIGlmIGFfYiA+IDAgdGhlbg0KICAgIGFfYiA9IG15SGVybzpDYWxjTWFnaWNEYW1hZ2UoX19iLCBhX2IpDQogIGVuZA0KICByZXR1cm4gYV9iIGFuZCBhX2Igb3IgMA0KZW5kDQpmdW5jdGlvbiBEcmF3Q2lyY2xlTmV4dEx2bChkZGEsIF9fYiwgYV9iLCBiX2IsIGNfYiwgZF9iLCBfYWIpDQogIGJfYiA9IGJfYiBvciAzMDANCiAgcXVhbGl0eSA9IG1hdGgubWF4KDgsIHJvdW5kKDE4MCAvIG1hdGguZGVnKChtYXRoLmFzaW4oX2FiIC8gKDIgKiBiX2IpKSkpKSkNCiAgcXVhbGl0eSA9IDIgKiBtYXRoLnBpIC8gcXVhbGl0eQ0KICBiX2IgPSBiX2IgKiAwLjkyDQogIGxvY2FsIGFhYiA9IHt9DQogIGZvciB0aGV0YSA9IDAsIDIgKiBtYXRoLnBpICsgcXVhbGl0eSwgcXVhbGl0eSBkbw0KICAgIGxvY2FsIGJhYiA9IFdvcmxkVG9TY3JlZW4oRDNEWFZFQ1RPUjMoZGRhICsgYl9iICogbWF0aC5jb3ModGhldGEpLCBfX2IsIGFfYiAtIGJfYiAqIG1hdGguc2luKHRoZXRhKSkpDQogICAgYWFiWyNhYWIgKyAxXSA9IEQzRFhWRUNUT1IyKGJhYi54LCBiYWIueSkNCiAgZW5kDQogIERyYXdMaW5lczIoYWFiLCBjX2Igb3IgMSwgNDI5NDk2NzI5NSkNCmVuZA0KZnVuY3Rpb24gcm91bmQoZGRhKQ0KICBpZiBkZGEgPj0gMCB0aGVuDQogICAgcmV0dXJuIG1hdGguZmxvb3IoZGRhICsgMC41KQ0KICBlbHNlDQogICAgcmV0dXJuIG1hdGguY2VpbChkZGEgLSAwLjUpDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBEcmF3Q2lyY2xlMihkZGEsIF9fYiwgYV9iLCBiX2IsIGNfYikNCiAgbG9jYWwgZF9iID0gVmVjdG9yKGRkYSwgX19iLCBhX2IpDQogIGxvY2FsIF9hYiA9IFZlY3RvcihjYW1lcmFQb3MueCwgY2FtZXJhUG9zLnksIGNhbWVyYVBvcy56KQ0KICBsb2NhbCBhYWIgPSBkX2IgLSAoZF9iIC0gX2FiKTpub3JtYWxpemVkKCkgKiBiX2INCiAgbG9jYWwgYmFiID0gV29ybGRUb1NjcmVlbihEM0RYVkVDVE9SMyhhYWIueCwgYWFiLnksIGFhYi56KSkNCiAgaWYgT25TY3JlZW4oew0KICAgIHggPSBiYWIueCwNCiAgICB5ID0gYmFiLnkNCiAgfSwgew0KICAgIHggPSBiYWIueCwNCiAgICB5ID0gYmFiLnkNCiAgfSkgdGhlbg0KICAgIERyYXdDaXJjbGVOZXh0THZsKGRkYSwgX19iLCBhX2IsIGJfYiwgMSwgY19iLCBNZW51LmRyYXdpbmdzLmxmYy5DTCkNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIE9uV25kTXNnKGRkYSwgX19iKQ0KICBpZiBkZGEgPT0gV01fTEJVVFRPTkRPV04gYW5kIE1lbnUuY29tYm8uc2VsZWN0ZWRUYXJnZXQgdGhlbg0KICAgIGxvY2FsIGFfYg0KICAgIGZvciBiX2IsIGNfYiBpbiBwYWlycyhHZXRFbmVteUhlcm9lcygpKSBkbw0KICAgICAgaWYgY19iIGFuZCBjX2IudmlzaWJsZSBhbmQgbm90IGNfYi5kZWFkIGFuZCBWYWxpZFRhcmdldChjX2IpIGFuZCBHZXREaXN0YW5jZVNxcihjX2IsIG1vdXNlUG9zKSA8PSA0MDAwMCBhbmQgR2V0RGlzdGFuY2VTcXIoY19iKSA8PSA0MDAwMDAwIHRoZW4NCiAgICAgICAgYV9iID0gY19iDQogICAgICBlbmQNCiAgICBlbmQNCiAgICBpZiBhX2IgYW5kIEdldERpc3RhbmNlU3FyKGFfYiwgbW91c2VQb3MpIDwgNDAwMDAgdGhlbg0KICAgICAgaWYgZm9yY2VkVGFyZ2V0IGFuZCBhX2IubmV0d29ya0lEID09IGZvcmNlZFRhcmdldC5uZXR3b3JrSUQgdGhlbg0KICAgICAgICBmb3JjZWRUYXJnZXQgPSBuaWwNCiAgICAgICAgU2F5KCJEZXNlbGVjdGVkIHRhcmdldDogIiAuLiBhX2IuY2hhck5hbWUpDQogICAgICBlbHNlDQogICAgICAgIGZvcmNlZFRhcmdldCA9IGFfYg0KICAgICAgICBTYXkoIlNlbGVjdGVkIHRhcmdldDogIiAuLiBhX2IuY2hhck5hbWUpDQogICAgICAgIGZvcmNlZFRhcmdldFRpbWUgPSBvcy5jbG9jaygpDQogICAgICBlbmQNCiAgICBlbmQNCiAgZW5kDQplbmQNCmNsYXNzKCJPcmJXYWxrZXIiKQ0KZnVuY3Rpb24gT3JiV2Fsa2VyOl9faW5pdCgpDQogIHNlbGYud2luZFVwVGltZSA9IDANCiAgc2VsZi5hbmltYXRpb25UaW1lID0gMA0KICBzZWxmLkFBID0gb3MuY2xvY2soKQ0KICBzZWxmLnJhbmdlU3FyID0gMjc1NjI1DQogIEFkZFByb2Nlc3NTcGVsbENhbGxiYWNrKGZ1bmN0aW9uKGRkYSwgX19iKQ0KICAgIHNlbGY6T25Qcm9jY2Vzc1NwZWxsKGRkYSwgX19iKQ0KICBlbmQpDQplbmQNCmZ1bmN0aW9uIE9yYldhbGtlcjpPblByb2NjZXNzU3BlbGwoZGRhLCBfX2IpDQogIGlmIGRkYSBhbmQgZGRhLmlzTWUgYW5kIF9fYiBhbmQgX19iLm5hbWUgYW5kIF9fYi5uYW1lOmxvd2VyKCk6ZmluZCgiYmFzaWMiKSB0aGVuDQogICAgc2VsZi5BQSA9IG9zLmNsb2NrKCkNCiAgICBzZWxmLndpbmRVcFRpbWUgPSAxIC8gKG15SGVyby5hdHRhY2tTcGVlZCAqICgxIC8gKF9fYi53aW5kVXBUaW1lICogbXlIZXJvLmF0dGFja1NwZWVkKSkpDQogICAgc2VsZi5hbmltYXRpb25UaW1lID0gMSAvIChteUhlcm8uYXR0YWNrU3BlZWQgKiAoMSAvIChfX2IuYW5pbWF0aW9uVGltZSAqIG15SGVyby5hdHRhY2tTcGVlZCkpKQ0KICBlbmQNCmVuZA0KZnVuY3Rpb24gT3JiV2Fsa2VyOk9yYndhbGsoZGRhKQ0KICBpZiBkZGEgYW5kIGRkYS50eXBlIGFuZCBvcy5jbG9jaygpID4gc2VsZi5BQSArIHNlbGYuYW5pbWF0aW9uVGltZSBhbmQgR2V0RGlzdGFuY2VTcXIoZGRhKSA8PSBzZWxmLnJhbmdlU3FyIHRoZW4NCiAgICBteUhlcm86QXR0YWNrKGRkYSkNCiAgZWxzZWlmIG9zLmNsb2NrKCkgPiBzZWxmLkFBICsgc2VsZi53aW5kVXBUaW1lIHRoZW4NCiAgICBteUhlcm86TW92ZVRvKG1vdXNlUG9zLngsIG1vdXNlUG9zLnopDQogIGVuZA0KZW5kDQphc3NlcnQobG9hZChCYXNlNjREZWNvZGUoIkcweDFZVklBQVFRRUJBZ0FHWk1OQ2hvS0FBQUFBQUFBQUFBQUFRSUtBQUFBQmdCQUFFRkFBQUFkUUFBQkJrQkFBR1VBQUFBS1FBQ0JCa0JBQUdWQUFBQUtRSUNCSHdDQUFBUUFBQUFFQmdBQUFHTnNZWE56QUFRTkFBQUFVMk55YVhCMFUzUmhkSFZ6QUFRSEFBQUFYMTlwYm1sMEFBUUxBQUFBVTJWdVpGVndaR0YwWlFBQ0FBQUFBZ0FBQUFnQUFBQUNBQW90QUFBQWhrQkFBTWFBUUFBR3dVQUFCd0ZCQWtGQkFRQWRnUUFCUnNGQUFFY0J3UUtCZ1FFQVhZRUFBWWJCUUFDSEFVRUR3Y0VCQUoyQkFBSEd3VUFBeHdIQkF3RUNBZ0RkZ1FBQkJzSkFBQWNDUVFSQlFnSUFIWUlBQVJZQkFnTGRBQUFCbllBQUFBcUFBSUFLUUFDRmhnQkRBTUhBQWdDZGdBQUJDb0NBaFFxQXc0YUdBRVFBeDhCQ0FNZkF3d0hkQUlBQW5ZQUFBQXFBZ0llTVFFUUFBWUVFQUoxQWdBR0d3RVFBNVFBQUFKMUFBQUVmQUlBQUZBQUFBQVFGQUFBQWFIZHBaQUFFRFFBQUFFSmhjMlUyTkVWdVkyOWtaUUFFQ1FBQUFIUnZjM1J5YVc1bkFBUURBQUFBYjNNQUJBY0FBQUJuWlhSbGJuWUFCQlVBQUFCUVVrOURSVk5UVDFKZlNVUkZUbFJKUmtsRlVnQUVDUUFBQUZWVFJWSk9RVTFGQUFRTkFBQUFRMDlOVUZWVVJWSk9RVTFGQUFRUUFBQUFVRkpQUTBWVFUwOVNYMHhGVmtWTUFBUVRBQUFBVUZKUFEwVlRVMDlTWDFKRlZrbFRTVTlPQUFRRUFBQUFTMlY1QUFRSEFBQUFjMjlqYTJWMEFBUUlBQUFBY21WeGRXbHlaUUFFQ2dBQUFHZGhiV1ZUZEdGMFpRQUFCQVFBQUFCMFkzQUFCQWNBQUFCaGMzTmxjblFBQkFzQUFBQlRaVzVrVlhCa1lYUmxBQU1BQUFBQUFBRHdQd1FVQUFBQVFXUmtRblZuYzNCc1lYUkRZV3hzWW1GamF3QUJBQUFBQ0FBQUFBZ0FBQUFBQUFNRkFBQUFCUUFBQUF3QVFBQ0JRQUFBSFVDQUFSOEFnQUFDQUFBQUJBc0FBQUJUWlc1a1ZYQmtZWFJsQUFNQUFBQUFBQUFBUUFBQUFBQUJBQUFBQVFBUUFBQUFRRzlpWm5WelkyRjBaV1F1YkhWaEFBVUFBQUFJQUFBQUNBQUFBQWdBQUFBSUFBQUFDQUFBQUFBQUFBQUJBQUFBQlFBQUFITmxiR1lBQVFBQUFBQUFFQUFBQUVCdlltWjFjMk5oZEdWa0xteDFZUUF0QUFBQUF3QUFBQU1BQUFBRUFBQUFCQUFBQUFRQUFBQUVBQUFBQkFBQUFBUUFBQUFFQUFBQUJBQUFBQVVBQUFBRkFBQUFCUUFBQUFVQUFBQUZBQUFBQlFBQUFBVUFBQUFGQUFBQUJnQUFBQVlBQUFBR0FBQUFCZ0FBQUFVQUFBQURBQUFBQXdBQUFBWUFBQUFHQUFBQUJnQUFBQVlBQUFBR0FBQUFCZ0FBQUFZQUFBQUhBQUFBQndBQUFBY0FBQUFIQUFBQUJ3QUFBQWNBQUFBSEFBQUFCd0FBQUFjQUFBQUlBQUFBQ0FBQUFBZ0FBQUFJQUFBQUFnQUFBQVVBQUFCelpXeG1BQUFBQUFBdEFBQUFBZ0FBQUdFQUFBQUFBQzBBQUFBQkFBQUFCUUFBQUY5RlRsWUFDUUFBQUE0QUFBQUNBQTBYQUFBQWh3QkFBSXhBUUFFQmdRQUFRY0VBQUoxQUFBS0hBRUFBakFCQkFRRkJBUUJIZ1VFQWdjRUJBTWNCUWdBQndnRUFRQUtBQUlIQ0FRREdRa0lBeDRMQ0JRSERBZ0FXQVFNQ25VQ0FBWWNBUUFDTUFFTUJuVUFBQVI4QWdBQU5BQUFBQkFRQUFBQjBZM0FBQkFnQUFBQmpiMjV1WldOMEFBUVJBQUFBYzJOeWFYQjBjM1JoZEhWekxtNWxkQUFEQUFBQUFBQUFWRUFFQlFBQUFITmxibVFBQkFzQUFBQkhSVlFnTDNONWJtTXRBQVFFQUFBQVMyVjVBQVFDQUFBQUxRQUVCUUFBQUdoM2FXUUFCQWNBQUFCdGVVaGxjbThBQkFrQUFBQmphR0Z5VG1GdFpRQUVKZ0FBQUNCSVZGUlFMekV1TUEwS1NHOXpkRG9nYzJOeWFYQjBjM1JoZEhWekxtNWxkQTBLRFFvQUJBWUFBQUJqYkc5elpRQUFBQUFBQVFBQUFBQUFFQUFBQUVCdlltWjFjMk5oZEdWa0xteDFZUUFYQUFBQUNnQUFBQW9BQUFBS0FBQUFDZ0FBQUFvQUFBQUxBQUFBQ3dBQUFBc0FBQUFMQUFBQURBQUFBQXdBQUFBTkFBQUFEUUFBQUEwQUFBQU9BQUFBRGdBQUFBNEFBQUFPQUFBQUN3QUFBQTRBQUFBT0FBQUFEZ0FBQUE0QUFBQUNBQUFBQlFBQUFITmxiR1lBQUFBQUFCY0FBQUFDQUFBQVlRQUFBQUFBRndBQUFBRUFBQUFGQUFBQVgwVk9WZ0FCQUFBQUFRQVFBQUFBUUc5aVpuVnpZMkYwWldRdWJIVmhBQW9BQUFBQkFBQUFBUUFBQUFFQUFBQUNBQUFBQ0FBQUFBSUFBQUFKQUFBQURnQUFBQWtBQUFBT0FBQUFBQUFBQUFFQUFBQUZBQUFBWDBWT1ZnQT0iKSwgbmlsLCAiYnQiLCBfRU5WKSkoKQ0KU2NyaXB0U3RhdHVzKCJYS05MTFFMUFJNTiIpDQpjbGFzcygiU3hTY3JpcHRVcGRhdGUiKQ0KZnVuY3Rpb24gU3hTY3JpcHRVcGRhdGU6X19pbml0KGRkYSwgX19iLCBhX2IsIGJfYiwgY19iLCBkX2IsIF9hYiwgYWFiLCBiYWIsIGNhYikNCiAgc2VsZi5Mb2NhbFZlcnNpb24gPSBkZGENCiAgc2VsZi5Ib3N0ID0gYV9iDQogIHNlbGYuVmVyc2lvblBhdGggPSAiL0JvTC9UQ1BVcGRhdGVyL0dldFNjcmlwdCIgLi4gKF9fYiBhbmQgIjUiIG9yICI2IikgLi4gIi5waHA/c2NyaXB0PSIgLi4gc2VsZjpCYXNlNjRFbmNvZGUoc2VsZi5Ib3N0IC4uIGJfYikgLi4gIiZyYW5kPSIgLi4gbWF0aC5yYW5kb20oOTk5OTk5OTkpDQogIHNlbGYuU2NyaXB0UGF0aCA9ICIvQm9ML1RDUFVwZGF0ZXIvR2V0U2NyaXB0IiAuLiAoX19iIGFuZCAiNSIgb3IgIjYiKSAuLiAiLnBocD9zY3JpcHQ9IiAuLiBzZWxmOkJhc2U2NEVuY29kZShzZWxmLkhvc3QgLi4gY19iKSAuLiAiJnJhbmQ9IiAuLiBtYXRoLnJhbmRvbSg5OTk5OTk5OSkNCiAgc2VsZi5TYXZlUGF0aCA9IGRfYg0KICBzZWxmLkNhbGxiYWNrVXBkYXRlID0gX2FiDQogIHNlbGYuQ2FsbGJhY2tOb1VwZGF0ZSA9IGFhYg0KICBzZWxmLkNhbGxiYWNrTmV3VmVyc2lvbiA9IGJhYg0KICBzZWxmLkNhbGxiYWNrRXJyb3IgPSBjYWINCiAgQWRkRHJhd0NhbGxiYWNrKGZ1bmN0aW9uKCkNCiAgICBzZWxmOk9uRHJhdygpDQogIGVuZCkNCiAgc2VsZjpDcmVhdGVTb2NrZXQoc2VsZi5WZXJzaW9uUGF0aCkNCiAgc2VsZi5Eb3dubG9hZFN0YXR1cyA9ICJDb25uZWN0IHRvIFNlcnZlciBmb3IgVmVyc2lvbkluZm8iDQogIEFkZFRpY2tDYWxsYmFjayhmdW5jdGlvbigpDQogICAgc2VsZjpHZXRPbmxpbmVWZXJzaW9uKCkNCiAgZW5kKQ0KZW5kDQpmdW5jdGlvbiBTeFNjcmlwdFVwZGF0ZTpwcmludChkZGEpDQogIHByaW50KCI8Zm9udCBjb2xvcj1cIiNGRkZGRkZcIj4iIC4uIG9zLmNsb2NrKCkgLi4gIjogIiAuLiBkZGEpDQplbmQNCmZ1bmN0aW9uIFN4U2NyaXB0VXBkYXRlOk9uRHJhdygpDQogIGlmIHNlbGYuRG93bmxvYWRTdGF0dXMgfj0gIkRvd25sb2FkaW5nIFNjcmlwdCAoMTAwJSkiIGFuZCBzZWxmLkRvd25sb2FkU3RhdHVzIH49ICJEb3dubG9hZGluZyBWZXJzaW9uSW5mbyAoMTAwJSkiIHRoZW4NCiAgICBEcmF3VGV4dCgiRG93bmxvYWQgU3RhdHVzOiAiIC4uIChzZWxmLkRvd25sb2FkU3RhdHVzIG9yICJVbmtub3duIiksIDUwLCAxMCwgNTAsIEFSR0IoMjU1LCAyNTUsIDI1NSwgMjU1KSkNCiAgZW5kDQplbmQNCmZ1bmN0aW9uIFN4U2NyaXB0VXBkYXRlOkNyZWF0ZVNvY2tldChkZGEpDQogIGlmIG5vdCBzZWxmLkx1YVNvY2tldCB0aGVuDQogICAgc2VsZi5MdWFTb2NrZXQgPSByZXF1aXJlKCJzb2NrZXQiKQ0KICBlbHNlDQogICAgc2VsZi5Tb2NrZXQ6Y2xvc2UoKQ0KICAgIHNlbGYuU29ja2V0ID0gbmlsDQogICAgc2VsZi5TaXplID0gbmlsDQogICAgc2VsZi5SZWN2U3RhcnRlZCA9IGZhbHNlDQogIGVuZA0KICBzZWxmLlNvY2tldCA9IHNlbGYuTHVhU29ja2V0LnRjcCgpDQogIHNlbGYuU29ja2V0OnNldHRpbWVvdXQoMCwgImIiKQ0KICBzZWxmLlNvY2tldDpzZXR0aW1lb3V0KDk5OTk5OTk5LCAidCIpDQogIHNlbGYuU29ja2V0OmNvbm5lY3QoInN4LWJvbC5ldSIsIDgwKQ0KICBzZWxmLlVybCA9IGRkYQ0KICBzZWxmLlN0YXJ0ZWQgPSBmYWxzZQ0KICBzZWxmLkxhc3RQcmludCA9ICIiDQogIHNlbGYuRmlsZSA9ICIiDQplbmQNCmZ1bmN0aW9uIFN4U2NyaXB0VXBkYXRlOkJhc2U2NEVuY29kZShkZGEpDQogIGxvY2FsIF9fYiA9ICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvIg0KICByZXR1cm4gKGRkYTpnc3ViKCIuIiwgZnVuY3Rpb24oYV9iKQ0KICAgIGxvY2FsIGJfYiwgY19iID0gIiIsIGFfYjpieXRlKCkNCiAgICBmb3IgaSA9IDgsIDEsIC0xIGRvDQogICAgICBiX2IgPSBiX2IgLi4gKGNfYiAlIDIgXiBpIC0gY19iICUgMiBeIChpIC0gMSkgPiAwIGFuZCAiMSIgb3IgIjAiKQ0KICAgIGVuZA0KICAgIHJldHVybiBiX2INCiAgZW5kKSAuLiAiMDAwMCIpOmdzdWIoIiVkJWQlZD8lZD8lZD8lZD8iLCBmdW5jdGlvbihhX2IpDQogICAgaWYgI2FfYiA8IDYgdGhlbg0KICAgICAgcmV0dXJuICIiDQogICAgZW5kDQogICAgbG9jYWwgYl9iID0gMA0KICAgIGZvciBpID0gMSwgNiBkbw0KICAgICAgYl9iID0gYl9iICsgKGFfYjpzdWIoaSwgaSkgPT0gIjEiIGFuZCAyIF4gKDYgLSBpKSBvciAwKQ0KICAgIGVuZA0KICAgIHJldHVybiBfX2I6c3ViKGJfYiArIDEsIGJfYiArIDEpDQogIGVuZCkgLi4gKHsNCiAgICAiIiwNCiAgICAiPT0iLA0KICAgICI9Ig0KICB9KVsjZGRhICUgMyArIDFdDQplbmQNCmZ1bmN0aW9uIFN4U2NyaXB0VXBkYXRlOkdldE9ubGluZVZlcnNpb24oKQ0KICBpZiBzZWxmLkdvdFNjcmlwdFZlcnNpb24gdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgc2VsZi5SZWNlaXZlLCBzZWxmLlN0YXR1cywgc2VsZi5TbmlwcGVkID0gc2VsZi5Tb2NrZXQ6cmVjZWl2ZSgxMDI0KQ0KICBpZiBzZWxmLlN0YXR1cyA9PSAidGltZW91dCIgYW5kIG5vdCBzZWxmLlN0YXJ0ZWQgdGhlbg0KICAgIHNlbGYuU3RhcnRlZCA9IHRydWUNCiAgICBzZWxmLlNvY2tldDpzZW5kKCJHRVQgIiAuLiBzZWxmLlVybCAuLiAiIEhUVFAvMS4wXHJcbkhvc3Q6IHN4LWJvbC5ldVxyXG5Vc2VyLUFnZW50OiBoRG93bmxvYWRcclxuXHJcbiIpDQogIGVuZA0KICBzZWxmLkZpbGUgPSBzZWxmLkZpbGUgLi4gKHNlbGYuUmVjZWl2ZSBvciBzZWxmLlNuaXBwZWQpDQogIGlmIHNlbGYuRmlsZTpmaW5kKCI8L3MiIC4uICJpemU+IikgdGhlbg0KICAgIGlmIG5vdCBzZWxmLlNpemUgdGhlbg0KICAgICAgc2VsZi5TaXplID0gdG9udW1iZXIoc2VsZi5GaWxlOnN1YihzZWxmLkZpbGU6ZmluZCgiPHNpIiAuLiAiemU+IikgKyA2LCBzZWxmLkZpbGU6ZmluZCgiPC9zaSIgLi4gInplPiIpIC0gMSkpDQogICAgZW5kDQogICAgaWYgc2VsZi5GaWxlOmZpbmQoIjxzY3IiIC4uICJpcHQ+IikgdGhlbg0KICAgICAgbG9jYWwgZGRhLCBfX2IgPSBzZWxmLkZpbGU6ZmluZCgiPHNjciIgLi4gImlwdD4iKQ0KICAgICAgbG9jYWwgYV9iID0gc2VsZi5GaWxlOmZpbmQoIjwvc2NyIiAuLiAiaXB0PiIpDQogICAgICBhX2IgPSBhX2IgYW5kIGFfYiAtIDENCiAgICAgIGxvY2FsIGJfYiA9IHNlbGYuRmlsZTpzdWIoX19iICsgMSwgYV9iIG9yIC0xKTpsZW4oKQ0KICAgICAgc2VsZi5Eb3dubG9hZFN0YXR1cyA9ICJEb3dubG9hZGluZyBWZXJzaW9uSW5mbyAoIiAuLiBtYXRoLnJvdW5kKDEwMCAvIHNlbGYuU2l6ZSAqIGJfYiwgMikgLi4gIiUpIg0KICAgIGVuZA0KICBlbmQNCiAgaWYgc2VsZi5GaWxlOmZpbmQoIjwvc2NyIiAuLiAiaXB0PiIpIG9yIHNlbGYuU3RhdHVzID09ICJjbG9zZWQiIHRoZW4NCiAgICBsb2NhbCBkZGEsIF9fYiA9IHNlbGYuRmlsZTpmaW5kKCI8c2NyIiAuLiAiaXB0PiIpDQogICAgbG9jYWwgYV9iLCBiX2IgPSBzZWxmLkZpbGU6ZmluZCgiPC9zYyIgLi4gInJpcHQ+IikNCiAgICBpZiBub3QgX19iIG9yIG5vdCBhX2IgdGhlbg0KICAgICAgaWYgc2VsZi5DYWxsYmFja0Vycm9yIGFuZCB0eXBlKHNlbGYuQ2FsbGJhY2tFcnJvcikgPT0gImZ1bmN0aW9uIiB0aGVuDQogICAgICAgIHNlbGYuQ2FsbGJhY2tFcnJvcigpDQogICAgICBlbmQNCiAgICBlbHNlDQogICAgICBzZWxmLk9ubGluZVZlcnNpb24gPSBCYXNlNjREZWNvZGUoc2VsZi5GaWxlOnN1YihfX2IgKyAxLCBhX2IgLSAxKSkNCiAgICAgIHNlbGYuT25saW5lVmVyc2lvbiA9IHRvbnVtYmVyKHNlbGYuT25saW5lVmVyc2lvbikNCiAgICAgIGlmIG5vdCBzZWxmLk9ubGluZVZlcnNpb24gdGhlbg0KICAgICAgICBpZiBzZWxmLkNhbGxiYWNrRXJyb3IgYW5kIHR5cGUoc2VsZi5DYWxsYmFja0Vycm9yKSA9PSAiZnVuY3Rpb24iIHRoZW4NCiAgICAgICAgICBzZWxmLkNhbGxiYWNrRXJyb3IoKQ0KICAgICAgICBlbmQNCiAgICAgIGVsc2VpZiBzZWxmLk9ubGluZVZlcnNpb24gPiBzZWxmLkxvY2FsVmVyc2lvbiB0aGVuDQogICAgICAgIGlmIHNlbGYuQ2FsbGJhY2tOZXdWZXJzaW9uIGFuZCB0eXBlKHNlbGYuQ2FsbGJhY2tOZXdWZXJzaW9uKSA9PSAiZnVuY3Rpb24iIHRoZW4NCiAgICAgICAgICBzZWxmLkNhbGxiYWNrTmV3VmVyc2lvbihzZWxmLk9ubGluZVZlcnNpb24sIHNlbGYuTG9jYWxWZXJzaW9uKQ0KICAgICAgICBlbmQNCiAgICAgICAgc2VsZjpDcmVhdGVTb2NrZXQoc2VsZi5TY3JpcHRQYXRoKQ0KICAgICAgICBzZWxmLkRvd25sb2FkU3RhdHVzID0gIkNvbm5lY3QgdG8gU2VydmVyIGZvciBTY3JpcHREb3dubG9hZCINCiAgICAgICAgQWRkVGlja0NhbGxiYWNrKGZ1bmN0aW9uKCkNCiAgICAgICAgICBzZWxmOkRvd25sb2FkVXBkYXRlKCkNCiAgICAgICAgZW5kKQ0KICAgICAgZWxzZWlmIHNlbGYuQ2FsbGJhY2tOb1VwZGF0ZSBhbmQgdHlwZShzZWxmLkNhbGxiYWNrTm9VcGRhdGUpID09ICJmdW5jdGlvbiIgdGhlbg0KICAgICAgICBzZWxmLkNhbGxiYWNrTm9VcGRhdGUoc2VsZi5Mb2NhbFZlcnNpb24pDQogICAgICBlbmQNCiAgICBlbmQNCiAgICBzZWxmLkdvdFNjcmlwdFZlcnNpb24gPSB0cnVlDQogIGVuZA0KZW5kDQpmdW5jdGlvbiBTeFNjcmlwdFVwZGF0ZTpEb3dubG9hZFVwZGF0ZSgpDQogIGlmIHNlbGYuR290U3hTY3JpcHRVcGRhdGUgdGhlbg0KICAgIHJldHVybg0KICBlbmQNCiAgc2VsZi5SZWNlaXZlLCBzZWxmLlN0YXR1cywgc2VsZi5TbmlwcGVkID0gc2VsZi5Tb2NrZXQ6cmVjZWl2ZSgxMDI0KQ0KICBpZiBzZWxmLlN0YXR1cyA9PSAidGltZW91dCIgYW5kIG5vdCBzZWxmLlN0YXJ0ZWQgdGhlbg0KICAgIHNlbGYuU3RhcnRlZCA9IHRydWUNCiAgICBzZWxmLlNvY2tldDpzZW5kKCJHRVQgIiAuLiBzZWxmLlVybCAuLiAiIEhUVFAvMS4wXHJcbkhvc3Q6IHN4LWJvbC5ldVxyXG5cclxuIikNCiAgZW5kDQogIGlmIChzZWxmLlJlY2VpdmUgb3IgI3NlbGYuU25pcHBlZCA+IDApIGFuZCBub3Qgc2VsZi5SZWN2U3RhcnRlZCB0aGVuDQogICAgc2VsZi5SZWN2U3RhcnRlZCA9IHRydWUNCiAgICBzZWxmLkRvd25sb2FkU3RhdHVzID0gIkRvd25sb2FkaW5nIFNjcmlwdCAoMCUpIg0KICBlbmQNCiAgc2VsZi5GaWxlID0gc2VsZi5GaWxlIC4uIChzZWxmLlJlY2VpdmUgb3Igc2VsZi5TbmlwcGVkKQ0KICBpZiBzZWxmLkZpbGU6ZmluZCgiPC9zaSIgLi4gInplPiIpIHRoZW4NCiAgICBpZiBub3Qgc2VsZi5TaXplIHRoZW4NCiAgICAgIHNlbGYuU2l6ZSA9IHRvbnVtYmVyKHNlbGYuRmlsZTpzdWIoc2VsZi5GaWxlOmZpbmQoIjxzaSIgLi4gInplPiIpICsgNiwgc2VsZi5GaWxlOmZpbmQoIjwvc2kiIC4uICJ6ZT4iKSAtIDEpKQ0KICAgIGVuZA0KICAgIGlmIHNlbGYuRmlsZTpmaW5kKCI8c2NyIiAuLiAiaXB0PiIpIHRoZW4NCiAgICAgIGxvY2FsIGRkYSwgX19iID0gc2VsZi5GaWxlOmZpbmQoIjxzY3IiIC4uICJpcHQ+IikNCiAgICAgIGxvY2FsIGFfYiA9IHNlbGYuRmlsZTpmaW5kKCI8L3NjciIgLi4gImlwdD4iKQ0KICAgICAgYV9iID0gYV9iIGFuZCBhX2IgLSAxDQogICAgICBsb2NhbCBiX2IgPSBzZWxmLkZpbGU6c3ViKF9fYiArIDEsIGFfYiBvciAtMSk6bGVuKCkNCiAgICAgIHNlbGYuRG93bmxvYWRTdGF0dXMgPSAiRG93bmxvYWRpbmcgU2NyaXB0ICgiIC4uIG1hdGgucm91bmQoMTAwIC8gc2VsZi5TaXplICogYl9iLCAyKSAuLiAiJSkiDQogICAgZW5kDQogIGVuZA0KICBpZiBzZWxmLkZpbGU6ZmluZCgiPC9zY3IiIC4uICJpcHQ+Iikgb3Igc2VsZi5TdGF0dXMgPT0gImNsb3NlZCIgdGhlbg0KICAgIGxvY2FsIGRkYSwgX19iID0gc2VsZi5GaWxlOmZpbmQoIjxzYyIgLi4gInJpcHQ+IikNCiAgICBsb2NhbCBhX2IsIGJfYiA9IHNlbGYuRmlsZTpmaW5kKCI8L3NjciIgLi4gImlwdD4iKQ0KICAgIGlmIG5vdCBfX2Igb3Igbm90IGFfYiB0aGVuDQogICAgICBpZiBzZWxmLkNhbGxiYWNrRXJyb3IgYW5kIHR5cGUoc2VsZi5DYWxsYmFja0Vycm9yKSA9PSAiZnVuY3Rpb24iIHRoZW4NCiAgICAgICAgc2VsZi5DYWxsYmFja0Vycm9yKCkNCiAgICAgIGVuZA0KICAgIGVsc2UNCiAgICAgIGxvY2FsIGNfYiA9IHNlbGYuRmlsZTpzdWIoX19iICsgMSwgYV9iIC0gMSkNCiAgICAgIGxvY2FsIGRfYiA9IGNfYjpnc3ViKCJcciIsICIiKQ0KICAgICAgaWYgZF9iOmxlbigpIH49IHNlbGYuU2l6ZSB0aGVuDQogICAgICAgIGlmIHNlbGYuQ2FsbGJhY2tFcnJvciBhbmQgdHlwZShzZWxmLkNhbGxiYWNrRXJyb3IpID09ICJmdW5jdGlvbiIgdGhlbg0KICAgICAgICAgIHNlbGYuQ2FsbGJhY2tFcnJvcigpDQogICAgICAgIGVuZA0KICAgICAgICBzZWxmLkdvdFN4U2NyaXB0VXBkYXRlID0gdHJ1ZQ0KICAgICAgICByZXR1cm4NCiAgICAgIGVuZA0KICAgICAgbG9jYWwgX2FiID0gQmFzZTY0RGVjb2RlKGRfYikNCiAgICAgIGlmIHR5cGUobG9hZChfYWIpKSB+PSAiZnVuY3Rpb24iIHRoZW4NCiAgICAgICAgaWYgc2VsZi5DYWxsYmFja0Vycm9yIGFuZCB0eXBlKHNlbGYuQ2FsbGJhY2tFcnJvcikgPT0gImZ1bmN0aW9uIiB0aGVuDQogICAgICAgICAgc2VsZi5DYWxsYmFja0Vycm9yKCkNCiAgICAgICAgZW5kDQogICAgICBlbHNlDQogICAgICAgIGxvY2FsIGFhYiA9IGlvLm9wZW4oc2VsZi5TYXZlUGF0aCwgIncrYiIpDQogICAgICAgIGFhYjp3cml0ZShfYWIpDQogICAgICAgIGFhYjpjbG9zZSgpDQogICAgICAgIGlmIHNlbGYuQ2FsbGJhY2tVcGRhdGUgYW5kIHR5cGUoc2VsZi5DYWxsYmFja1VwZGF0ZSkgPT0gImZ1bmN0aW9uIiB0aGVuDQogICAgICAgICAgc2VsZi5DYWxsYmFja1VwZGF0ZShzZWxmLk9ubGluZVZlcnNpb24sIHNlbGYuTG9jYWxWZXJzaW9uKQ0KICAgICAgICBlbmQNCiAgICAgIGVuZA0KICAgIGVuZA0KICAgIHNlbGYuR290U3hTY3JpcHRVcGRhdGUgPSB0cnVlDQogIGVuZA0KZW5kDQo="), nil, "bt", _ENV))()

-- Easier to copy
